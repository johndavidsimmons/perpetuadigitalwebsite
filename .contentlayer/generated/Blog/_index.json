[
  {
    "title": "Adding click tracking to shadow DOM web components with Adobe Tags/Launch",
    "date": "2023-04-12T00:00:00.000Z",
    "tags": [
      "adobe launch",
      "click tracking",
      "javascript",
      "web components",
      "adobe tags"
    ],
    "draft": false,
    "summary": "How to add click tracking to modern web components",
    "body": {
      "raw": "\n## The good ole DOM\n\nThe DOM used to be a reliable place. Every element on you page could be found within it.\nThose days are fading, or at least becoming trickier thanks to modern [web components](https://developer.mozilla.org/en-US/docs/Web/Web_Components) and their concept of a [shadow DOM](https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_shadow_DOM).\nNot to be confused with the [shadow realm](https://www.urbandictionary.com/define.php?term=Shadow+Realm). Web components are useful,\nbut present a problem for tag managers like Launch that rely on the regular DOM to trigger rules.\nLets take a look at a web component that exists in a shadow dom:\n\n![red and blue button](https://images.ctfassets.net/on47yk52ubpi/EFtfZyGfMsSXbUhem7Vvo/f16a8adb99ae736bf817cc5d41e3783c/Screenshot_2023-04-09_at_5.57.38_PM.png)\n\n<figure>\n  <figcaption>\n    The red button is a regular element, and the blue button is a web component that is encapsulated\n    in the shadow dom.\n  </figcaption>\n</figure>\n\n![shadow dom html](https://images.ctfassets.net/on47yk52ubpi/7EUzVCDq1zRssQC4cPyng9/dea0adbdcb0d98b095a052fb8699334b/Screenshot_2023-04-09_at_8.37.17_PM.png)\n\n<figure>\n  <figcaption>\n    \"shadow root (open)\" signifies that this element is a web component that lives in the shadow\n    dom. It cannot be accessed via regular document.querySelector\n  </figcaption>\n</figure>\n\nHere is the code for the page above. The blue button is a custom defined HTML element known as a web component\n\n```html\n<!DOCTYPE html>\n<html>\n  <head>\n    <title>Buttons</title>\n    <style>\n      .button {\n        width: 200px;\n        height: 200px;\n        border: none;\n        color: white;\n        font-size: 16px;\n        font-weight: bold;\n        text-align: center;\n        line-height: 100px;\n        cursor: pointer;\n        margin: 10px;\n      }\n\n      .regular {\n        background-color: red;\n      }\n    </style>\n  </head>\n  <body>\n    <button id=\"redButton\" class=\"button regular\">Regular DOM Element</button>\n\n    <script>\n      // This is a web component\n      class ShadowButton extends HTMLElement {\n        constructor() {\n          super()\n          const shadow = this.attachShadow({ mode: 'open' })\n\n          const button = document.createElement('button')\n          button.setAttribute('id', 'blueButton')\n          button.setAttribute('class', 'button shadow')\n          button.setAttribute(\n            'style',\n            'width: 200px; height: 200px; border: none; color: white; font-size: 16px; font-weight: bold; text-align: center; line-height: 100px; cursor: pointer; margin: 10px;background-color:blue'\n          )\n          button.textContent = 'Shadow DOM Element'\n\n          shadow.appendChild(button)\n        }\n      }\n\n      // Register the web component\n      customElements.define('shadow-button', ShadowButton)\n    </script>\n\n    <shadow-button class=\"button shadow\"></shadow-button>\n  </body>\n</html>\n```\n\nEverything renders and looks normal, but the issue occurs when you try to select these elements from the DOM.\n\n![shadow dom null](https://images.ctfassets.net/on47yk52ubpi/5o3ghfRg5zP7dUKeaurWwS/598bfa2ed296802764d11220d6fa5f56/Screenshot_2023-04-09_at_6.01.39_PM.png)\n\n<figure>\n  <figcaption>The blue shadow dom button cannot be found...</figcaption>\n</figure>\n\n---\n\n## Where does this cause problems in Launch?\n\nI usually run across this issue when trying to add click tracking to these web components.\nJust adding a regular Launch click trigger to a rule doesn't work. For example:\n\n![blue button rule](https://images.ctfassets.net/on47yk52ubpi/1nV1Rgvt2cfP15h2DV68Tv/1cafb4916f1b4a7961ce1f7c1d695430/Screenshot_2023-04-12_at_2.50.50_PM.png)\n\n<figure>\n  <figcaption>Web component</figcaption>\n</figure>\n![red button rule](https://images.ctfassets.net/on47yk52ubpi/6FHE1xLqp5FJgujk02uvHV/f6831c504ec1e3a920331f737dbaddc4/Screenshot_2023-04-12_at_2.58.41_PM.png)\n<figure>\n  <figcaption>Regular element</figcaption>\n</figure>\n![button rule gifs](https://images.ctfassets.net/on47yk52ubpi/3XcB8JcbV60AfgVTCd3gC7/aa0abdb36005733122ef43be7222c0bf/buttonfires.gif)\n\n<figure>\n  <figcaption>The blue button rule, she no work :(</figcaption>\n</figure>\n\n---\n\n## Workarounds\n\nSo there isn't really an out of the box solution for this in Launch. Maybe someone should make an extension 🤔\nAnyway, I really only see 2 options:\n\n- Build a direct call event or datalayer push into the code that builds the web component\n- Write custom code in Launch that reaches into the shadow root and adds direct call/datalayer push on the click event\n\n## Integrating into the web component\n\nAlthough web components are special as mentioned above, they are still just regular HTML & JS, and thus, can\nhave event listeners added to them. Because of this, you can bake a direct call or data layer push event right\ninto an event listener. If I wanted to track clicks on the blue button for example:\n\n```javascript\n// ...\nbutton.addEventListener('click', () =>\n  _satellite.track('shadow element click!!!', { extra: 'data' })\n)\nshadow.appendChild(button)\n```\n\n![direct call rule](https://images.ctfassets.net/on47yk52ubpi/3kolQkxUBmc40YnjYkeSdf/da855cad428f61d079de34e518e27183/bluebuttondirectcall.gif)\n\n<figure>\n  <figcaption>I didn't set up a direct call rule, but you get the point, it works</figcaption>\n</figure>\n\n**or**\n\n```javascript\n// ...\nbutton.addEventListener('click', () =>\n  datalayer.push({ event: 'shadow element click', extra: 'data' })\n)\nshadow.appendChild(button)\n```\n\n![data layer push](https://images.ctfassets.net/on47yk52ubpi/16vlVePf6QBBgPJqaGtEHJ/99b13a20d58d30c44af3f1ab76f0a320/datalayerpush.gif)\n\n<figure>\n  <figcaption>\n    I don't have a data layer extension setup on this fake site, but again, you see where I am going\n    with this\n  </figcaption>\n</figure>\n\n## Adding your own event listeners via custom code\n\nThis option is less than ideal given that you need to manually traverse into the shadow dom with specific selectors, but nevertheless,\nit works. In my rule, I'm waiting for the `<shadow-button>` element to exist, then reaching into it and adding my own event\nlistener to the `#blueButton` web component.\n\n![shadow element exists](https://images.ctfassets.net/on47yk52ubpi/2v9pMgy5ZmijqfE1bg0Qih/c5dd26982743329f4fac10dc6354ee99/Screenshot_2023-04-13_at_8.32.44_AM.png)\n\n<figure>\n  <figcaption>\n    Launch rule that fires when the element containing the web component exists\n  </figcaption>\n</figure>\n\n![shadow button custom code](https://images.ctfassets.net/on47yk52ubpi/4PKJiYLofEaw9PIg7Lcwe0/3c51703b11f924788c8ae0043cf94ec6/Screenshot_2023-04-13_at_9.25.20_AM.png)\n\n<figure>\n  <figcaption>Manually adding an event listener to a web component with custom code</figcaption>\n</figure>\n\n![shadow custom code gif](https://images.ctfassets.net/on47yk52ubpi/4KNW7Qg9JdPqH3pShG3khD/5b96b1f9084205ad2b5eaf86d55c4a38/customcodeshadow.gif)\n\n<figure>\n  <figcaption>Click events tracking is now possible.</figcaption>\n</figure>\n\n## Wrap up\n\nSo that is how you can add tracking to a web component element in the shadow dom. In this case, I added click\ntracking via event listeners, but if you should be able to write any kind of activity tracking needed provided\nyou do it in custom code. If anyone has a better way to do this, please reach out!\n",
      "code": "var Component=(()=>{var p=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{for(var c in s)l(a,c,{get:s[c],enumerable:!0})},i=(a,s,c,e)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let t of h(s))!u.call(a,t)&&t!==c&&l(a,t,{get:()=>s[t],enumerable:!(e=d(s,t))||e.enumerable});return a};var g=(a,s,c)=>(c=a!=null?p(m(a)):{},i(s||!a||!a.__esModule?l(c,\"default\",{value:a,enumerable:!0}):c,a)),b=a=>i(l({},\"__esModule\",{value:!0}),a);var r=N((_,o)=>{o.exports=_jsx_runtime});var v={};k(v,{default:()=>w,frontmatter:()=>f});var n=g(r()),f={title:\"Adding click tracking to shadow DOM web components with Adobe Tags/Launch\",date:\"2023-04-12\",tags:[\"adobe launch\",\"click tracking\",\"javascript\",\"web components\",\"adobe tags\"],draft:!1,summary:\"How to add click tracking to modern web components\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(c,{})})):c();function c(){let e=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",img:\"img\",pre:\"pre\",code:\"code\",hr:\"hr\",ul:\"ul\",li:\"li\",strong:\"strong\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.h2,{id:\"the-good-ole-dom\",children:[(0,n.jsx)(e.a,{href:\"#the-good-ole-dom\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The good ole DOM\"]}),(0,n.jsxs)(e.p,{children:[\"The DOM used to be a reliable place. Every element on you page could be found within it. Those days are fading, or at least becoming trickier thanks to modern \",(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/Web_Components\",children:\"web components\"}),\" and their concept of a \",(0,n.jsx)(e.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_shadow_DOM\",children:\"shadow DOM\"}),\". Not to be confused with the \",(0,n.jsx)(e.a,{href:\"https://www.urbandictionary.com/define.php?term=Shadow+Realm\",children:\"shadow realm\"}),\". Web components are useful, but present a problem for tag managers like Launch that rely on the regular DOM to trigger rules. Lets take a look at a web component that exists in a shadow dom:\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"red and blue button\",src:\"https://images.ctfassets.net/on47yk52ubpi/EFtfZyGfMsSXbUhem7Vvo/f16a8adb99ae736bf817cc5d41e3783c/Screenshot_2023-04-09_at_5.57.38_PM.png\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:(0,n.jsx)(e.p,{children:\"The red button is a regular element, and the blue button is a web component that is encapsulated in the shadow dom.\"})})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"shadow dom html\",src:\"https://images.ctfassets.net/on47yk52ubpi/7EUzVCDq1zRssQC4cPyng9/dea0adbdcb0d98b095a052fb8699334b/Screenshot_2023-04-09_at_8.37.17_PM.png\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:(0,n.jsx)(e.p,{children:'\"shadow root (open)\" signifies that this element is a web component that lives in the shadow dom. It cannot be accessed via regular document.querySelector'})})}),(0,n.jsx)(e.p,{children:\"Here is the code for the page above. The blue button is a custom defined HTML element known as a web component\"}),(0,n.jsx)(e.pre,{className:\"language-html\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-html\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token doctype\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<!\"}),(0,n.jsx)(e.span,{className:\"token doctype-tag\",children:\"DOCTYPE\"}),\" \",(0,n.jsx)(e.span,{className:\"token name\",children:\"html\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"html\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"head\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"title\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"Buttons\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"title\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"style\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsx)(e.span,{className:\"token language-css\",children:`\n`})})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token selector\",children:(0,n.jsx)(e.span,{className:\"token class\",children:\".button\"})}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"width\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token unit\",children:\"px\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"height\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"200\"}),(0,n.jsx)(e.span,{className:\"token unit\",children:\"px\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"border\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" none\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"color\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token color\",children:\"white\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"font-size\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"16\"}),(0,n.jsx)(e.span,{className:\"token unit\",children:\"px\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"font-weight\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" bold\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"text-align\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" center\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"line-height\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"100\"}),(0,n.jsx)(e.span,{className:\"token unit\",children:\"px\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"cursor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" pointer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"margin\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"10\"}),(0,n.jsx)(e.span,{className:\"token unit\",children:\"px\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsx)(e.span,{className:\"token language-css\",children:`\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token selector\",children:(0,n.jsx)(e.span,{className:\"token class\",children:\".regular\"})}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token property\",children:\"background-color\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token color\",children:\"red\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsxs)(e.span,{className:\"token language-css\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token style\",children:(0,n.jsx)(e.span,{className:\"token language-css\",children:\"    \"})}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"style\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"head\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"body\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"button\"]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"id\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"redButton\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"class\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"button regular\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),\"Regular DOM Element\",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"button\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"script\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsx)(e.span,{className:\"token language-javascript\",children:`\n`})})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// This is a web component\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"class\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"ShadowButton\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"extends\"}),\" \",(0,n.jsx)(e.span,{className:\"token class-name\",children:\"HTMLElement\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token function\",children:\"constructor\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"super\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" shadow \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"this\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"attachShadow\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" mode\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'open'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsx)(e.span,{className:\"token language-javascript\",children:`\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"const\"}),\" button \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token dom variable\",children:\"document\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"createElement\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'button'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"          button\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"setAttribute\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'blueButton'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"          button\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"setAttribute\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'class'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'button shadow'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"          button\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"setAttribute\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'style'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"            \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'width: 200px; height: 200px; border: none; color: white; font-size: 16px; font-weight: bold; text-align: center; line-height: 100px; cursor: pointer; margin: 10px;background-color:blue'\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"          \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"          button\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token property-access\",children:\"textContent\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'Shadow DOM Element'\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsx)(e.span,{className:\"token language-javascript\",children:`\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"          shadow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"appendChild\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"button\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsx)(e.span,{className:\"token language-javascript\",children:`\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"      \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"// Register the web component\"}),`\n`]})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsxs)(e.span,{className:\"token language-javascript\",children:[\"      customElements\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"define\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'shadow-button'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token maybe-class-name\",children:\"ShadowButton\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token script\",children:(0,n.jsx)(e.span,{className:\"token language-javascript\",children:\"    \"})}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"script\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"<\"}),\"shadow-button\"]}),\" \",(0,n.jsx)(e.span,{className:\"token attr-name\",children:\"class\"}),(0,n.jsxs)(e.span,{className:\"token attr-value\",children:[(0,n.jsx)(e.span,{className:\"token punctuation attr-equals\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'}),\"button shadow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"shadow-button\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  \",(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"body\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsxs)(e.span,{className:\"token tag\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"</\"}),\"html\"]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\">\"})]}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"Everything renders and looks normal, but the issue occurs when you try to select these elements from the DOM.\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"shadow dom null\",src:\"https://images.ctfassets.net/on47yk52ubpi/5o3ghfRg5zP7dUKeaurWwS/598bfa2ed296802764d11220d6fa5f56/Screenshot_2023-04-09_at_6.01.39_PM.png\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:\"The blue shadow dom button cannot be found...\"})}),(0,n.jsx)(e.hr,{}),(0,n.jsxs)(e.h2,{id:\"where-does-this-cause-problems-in-launch\",children:[(0,n.jsx)(e.a,{href:\"#where-does-this-cause-problems-in-launch\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Where does this cause problems in Launch?\"]}),(0,n.jsx)(e.p,{children:\"I usually run across this issue when trying to add click tracking to these web components. Just adding a regular Launch click trigger to a rule doesn't work. For example:\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"blue button rule\",src:\"https://images.ctfassets.net/on47yk52ubpi/1nV1Rgvt2cfP15h2DV68Tv/1cafb4916f1b4a7961ce1f7c1d695430/Screenshot_2023-04-12_at_2.50.50_PM.png\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:\"Web component\"})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"red button rule\",src:\"https://images.ctfassets.net/on47yk52ubpi/6FHE1xLqp5FJgujk02uvHV/f6831c504ec1e3a920331f737dbaddc4/Screenshot_2023-04-12_at_2.58.41_PM.png\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:\"Regular element\"})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"button rule gifs\",src:\"https://images.ctfassets.net/on47yk52ubpi/3XcB8JcbV60AfgVTCd3gC7/aa0abdb36005733122ef43be7222c0bf/buttonfires.gif\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:\"The blue button rule, she no work :(\"})}),(0,n.jsx)(e.hr,{}),(0,n.jsxs)(e.h2,{id:\"workarounds\",children:[(0,n.jsx)(e.a,{href:\"#workarounds\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Workarounds\"]}),(0,n.jsx)(e.p,{children:\"So there isn't really an out of the box solution for this in Launch. Maybe someone should make an extension \\u{1F914} Anyway, I really only see 2 options:\"}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"Build a direct call event or datalayer push into the code that builds the web component\"}),(0,n.jsx)(e.li,{children:\"Write custom code in Launch that reaches into the shadow root and adds direct call/datalayer push on the click event\"})]}),(0,n.jsxs)(e.h2,{id:\"integrating-into-the-web-component\",children:[(0,n.jsx)(e.a,{href:\"#integrating-into-the-web-component\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Integrating into the web component\"]}),(0,n.jsx)(e.p,{children:\"Although web components are special as mentioned above, they are still just regular HTML & JS, and thus, can have event listeners added to them. Because of this, you can bake a direct call or data layer push event right into an event listener. If I wanted to track clicks on the blue button for example:\"}),(0,n.jsx)(e.pre,{className:\"language-javascript\",children:(0,n.jsxs)(e.code,{className:\"language-javascript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// ...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"button\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"addEventListener\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'click'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=>\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  _satellite\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"track\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'shadow element click!!!'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" extra\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'data'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"shadow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"appendChild\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"button\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"direct call rule\",src:\"https://images.ctfassets.net/on47yk52ubpi/3kolQkxUBmc40YnjYkeSdf/da855cad428f61d079de34e518e27183/bluebuttondirectcall.gif\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:\"I didn't set up a direct call rule, but you get the point, it works\"})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"or\"})}),(0,n.jsx)(e.pre,{className:\"language-javascript\",children:(0,n.jsxs)(e.code,{className:\"language-javascript code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"// ...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"button\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"addEventListener\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'click'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator arrow\",children:\"=>\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"  datalayer\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"push\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\" event\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'shadow element click'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" extra\",(0,n.jsx)(e.span,{className:\"token operator\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'data'\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"shadow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),(0,n.jsx)(e.span,{className:\"token function property-access method\",children:\"appendChild\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"button\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"data layer push\",src:\"https://images.ctfassets.net/on47yk52ubpi/16vlVePf6QBBgPJqaGtEHJ/99b13a20d58d30c44af3f1ab76f0a320/datalayerpush.gif\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:(0,n.jsx)(e.p,{children:\"I don't have a data layer extension setup on this fake site, but again, you see where I am going with this\"})})}),(0,n.jsxs)(e.h2,{id:\"adding-your-own-event-listeners-via-custom-code\",children:[(0,n.jsx)(e.a,{href:\"#adding-your-own-event-listeners-via-custom-code\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Adding your own event listeners via custom code\"]}),(0,n.jsxs)(e.p,{children:[\"This option is less than ideal given that you need to manually traverse into the shadow dom with specific selectors, but nevertheless, it works. In my rule, I'm waiting for the \",(0,n.jsx)(e.code,{children:\"<shadow-button>\"}),\" element to exist, then reaching into it and adding my own event listener to the \",(0,n.jsx)(e.code,{children:\"#blueButton\"}),\" web component.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"shadow element exists\",src:\"https://images.ctfassets.net/on47yk52ubpi/2v9pMgy5ZmijqfE1bg0Qih/c5dd26982743329f4fac10dc6354ee99/Screenshot_2023-04-13_at_8.32.44_AM.png\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:(0,n.jsx)(e.p,{children:\"Launch rule that fires when the element containing the web component exists\"})})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"shadow button custom code\",src:\"https://images.ctfassets.net/on47yk52ubpi/4PKJiYLofEaw9PIg7Lcwe0/3c51703b11f924788c8ae0043cf94ec6/Screenshot_2023-04-13_at_9.25.20_AM.png\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:\"Manually adding an event listener to a web component with custom code\"})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"shadow custom code gif\",src:\"https://images.ctfassets.net/on47yk52ubpi/4KNW7Qg9JdPqH3pShG3khD/5b96b1f9084205ad2b5eaf86d55c4a38/customcodeshadow.gif\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:\"Click events tracking is now possible.\"})}),(0,n.jsxs)(e.h2,{id:\"wrap-up\",children:[(0,n.jsx)(e.a,{href:\"#wrap-up\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Wrap up\"]}),(0,n.jsx)(e.p,{children:\"So that is how you can add tracking to a web component element in the shadow dom. In this case, I added click tracking via event listeners, but if you should be able to write any kind of activity tracking needed provided you do it in custom code. If anyone has a better way to do this, please reach out!\"})]})}}var w=y;return b(v);})();\n;return Component;"
    },
    "_id": "blog/adding-click-tracking-to-shadow-dom-elements.mdx",
    "_raw": {
      "sourceFilePath": "blog/adding-click-tracking-to-shadow-dom-elements.mdx",
      "sourceFileName": "adding-click-tracking-to-shadow-dom-elements.mdx",
      "sourceFileDir": "blog",
      "contentType": "mdx",
      "flattenedPath": "blog/adding-click-tracking-to-shadow-dom-elements"
    },
    "type": "Blog",
    "readingTime": {
      "text": "4 min read",
      "minutes": 3.87,
      "time": 232200,
      "words": 774
    },
    "slug": "adding-click-tracking-to-shadow-dom-elements",
    "toc": [
      {
        "value": "The good ole DOM",
        "url": "#the-good-ole-dom",
        "depth": 2
      },
      {
        "value": "Where does this cause problems in Launch?",
        "url": "#where-does-this-cause-problems-in-launch",
        "depth": 2
      },
      {
        "value": "Workarounds",
        "url": "#workarounds",
        "depth": 2
      },
      {
        "value": "Integrating into the web component",
        "url": "#integrating-into-the-web-component",
        "depth": 2
      },
      {
        "value": "Adding your own event listeners via custom code",
        "url": "#adding-your-own-event-listeners-via-custom-code",
        "depth": 2
      },
      {
        "value": "Wrap up",
        "url": "#wrap-up",
        "depth": 2
      }
    ]
  },
  {
    "title": "Adobe Analytics alerts and Microsoft Teams",
    "date": "2023-02-03T00:00:00.000Z",
    "tags": [
      "adobe analytics",
      "microsoft teams",
      "alerts"
    ],
    "draft": false,
    "summary": "A quick way to send Adobe Analytics Alerts to Microsoft Teams Rooms",
    "body": {
      "raw": "\n## Corporate Chat apps and you\n\nHere is a quick one for you all. I, like many IT professionals, am forced to use Microsoft Teams. \nOccasionally, I get a survey from Microsoft asking me how much I like Teams. To which I think to myself, \n“I have no choice in the matter”. That’s life though. We must make the best of the hand we are dealt, even \nif that hand includes sometimes letting a corporate chat app stress you out. Anyway, here’s how I use Teams rooms to save my inbox from Adobe Analytics alerts.\n\n\n## Sending Adobe Analytics Alerts as to Teams rooms\n\nDid you know you can turn anything in workspace into an email alert? Did you also know that you can send a\n message to any Microsoft Teams channel via email? Do you see where I am going here?\n\nTo get the email address of any Teams channel (are they channels or rooms? eh who cares?) hover over it \nand click on the 3 dots that come up to the right of the name. You will see an option that says Get Email Address. \nThis will give you an email address for the channel. Emails you send here will show up as teams messages.\n\n![get email address](https://images.ctfassets.net/on47yk52ubpi/7ydcij9Xs1DdOEynblXfzn/e8e80e75ffbb0a3351129e7523f6afb1/Screen_Shot_2023-01-25_at_4.40.31_PM.png)\n\nCopy the email address. You’ll need it in a second.\n\nOver in Adobe Analytics, create an [Alert](https://experienceleague.adobe.com/docs/analytics/analyze/reports-analytics/alerts.html?lang=en). Ideas for alerts usually come to me during the trance like flow-state I \nenter whilst weaving a narrative of numbers with the loom of Workspace. When this inspiration strikes, I like to right \nclick on row in workspace and click *Create alert from selection* to bring up the alert builder with some stuff prefilled.\n\n![create alert from selection](https://images.ctfassets.net/on47yk52ubpi/7tJ8ZOEJW6LRnZjlXUJyeC/1b3209f7702d452ecf6c6406b8be161b/Screen_Shot_2023-01-25_at_4.47.00_PM.png)\n\nIn the alert builder, put the email address from Teams as a recipient. To do some quick testing, you can build \nsomething that is guaranteed to trigger immediately.\n\n![team address goes here](https://images.ctfassets.net/on47yk52ubpi/1yrTt5jJxQ2yTEhIoS2s4X/31860fd64ae6de290bdb15aef0259f07/Screen_Shot_2023-01-25_at_4.53.43_PM.png)\n\n![alert email in teams room](https://images.ctfassets.net/on47yk52ubpi/3Ku7sbHmpWWhZkraQdtkYQ/f6b514ad3c1facfea4412f6d4fc4a31b/Screen_Shot_2023-01-25_at_5.00.10_PM.png)\n\nNow when this alert occurs, I get this Teams message and 1 less email. This has the added \nbenefit of being able to notify large groups of people at once without having to add individual recipients! \nLess email for everyone!",
      "code": "var Component=(()=>{var h=Object.create;var i=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var u=(t,s)=>()=>(s||t((s={exports:{}}).exports,s),s.exports),g=(t,s)=>{for(var n in s)i(t,n,{get:s[n],enumerable:!0})},r=(t,s,n,a)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let o of m(s))!f.call(t,o)&&o!==n&&i(t,o,{get:()=>s[o],enumerable:!(a=d(s,o))||a.enumerable});return t};var y=(t,s,n)=>(n=t!=null?h(p(t)):{},r(s||!t||!t.__esModule?i(n,\"default\",{value:t,enumerable:!0}):n,t)),b=t=>r(i({},\"__esModule\",{value:!0}),t);var c=u((I,l)=>{l.exports=_jsx_runtime});var T={};g(T,{default:()=>w,frontmatter:()=>k});var e=y(c()),k={title:\"Adobe Analytics alerts and Microsoft Teams\",date:\"2023-02-03\",tags:[\"adobe analytics\",\"microsoft teams\",\"alerts\"],draft:!1,summary:\"A quick way to send Adobe Analytics Alerts to Microsoft Teams Rooms\"};function _(t={}){let{wrapper:s}=t.components||{};return s?(0,e.jsx)(s,Object.assign({},t,{children:(0,e.jsx)(n,{})})):n();function n(){let a=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",img:\"img\",em:\"em\"},t.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(a.h2,{id:\"corporate-chat-apps-and-you\",children:[(0,e.jsx)(a.a,{href:\"#corporate-chat-apps-and-you\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Corporate Chat apps and you\"]}),(0,e.jsx)(a.p,{children:\"Here is a quick one for you all. I, like many IT professionals, am forced to use Microsoft Teams. Occasionally, I get a survey from Microsoft asking me how much I like Teams. To which I think to myself, \\u201CI have no choice in the matter\\u201D. That\\u2019s life though. We must make the best of the hand we are dealt, even if that hand includes sometimes letting a corporate chat app stress you out. Anyway, here\\u2019s how I use Teams rooms to save my inbox from Adobe Analytics alerts.\"}),(0,e.jsxs)(a.h2,{id:\"sending-adobe-analytics-alerts-as-to-teams-rooms\",children:[(0,e.jsx)(a.a,{href:\"#sending-adobe-analytics-alerts-as-to-teams-rooms\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(a.span,{className:\"icon icon-link\"})}),\"Sending Adobe Analytics Alerts as to Teams rooms\"]}),(0,e.jsx)(a.p,{children:\"Did you know you can turn anything in workspace into an email alert? Did you also know that you can send a message to any Microsoft Teams channel via email? Do you see where I am going here?\"}),(0,e.jsx)(a.p,{children:\"To get the email address of any Teams channel (are they channels or rooms? eh who cares?) hover over it and click on the 3 dots that come up to the right of the name. You will see an option that says Get Email Address. This will give you an email address for the channel. Emails you send here will show up as teams messages.\"}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.img,{alt:\"get email address\",src:\"https://images.ctfassets.net/on47yk52ubpi/7ydcij9Xs1DdOEynblXfzn/e8e80e75ffbb0a3351129e7523f6afb1/Screen_Shot_2023-01-25_at_4.40.31_PM.png\"})}),(0,e.jsx)(a.p,{children:\"Copy the email address. You\\u2019ll need it in a second.\"}),(0,e.jsxs)(a.p,{children:[\"Over in Adobe Analytics, create an \",(0,e.jsx)(a.a,{href:\"https://experienceleague.adobe.com/docs/analytics/analyze/reports-analytics/alerts.html?lang=en\",children:\"Alert\"}),\". Ideas for alerts usually come to me during the trance like flow-state I enter whilst weaving a narrative of numbers with the loom of Workspace. When this inspiration strikes, I like to right click on row in workspace and click \",(0,e.jsx)(a.em,{children:\"Create alert from selection\"}),\" to bring up the alert builder with some stuff prefilled.\"]}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.img,{alt:\"create alert from selection\",src:\"https://images.ctfassets.net/on47yk52ubpi/7tJ8ZOEJW6LRnZjlXUJyeC/1b3209f7702d452ecf6c6406b8be161b/Screen_Shot_2023-01-25_at_4.47.00_PM.png\"})}),(0,e.jsx)(a.p,{children:\"In the alert builder, put the email address from Teams as a recipient. To do some quick testing, you can build something that is guaranteed to trigger immediately.\"}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.img,{alt:\"team address goes here\",src:\"https://images.ctfassets.net/on47yk52ubpi/1yrTt5jJxQ2yTEhIoS2s4X/31860fd64ae6de290bdb15aef0259f07/Screen_Shot_2023-01-25_at_4.53.43_PM.png\"})}),(0,e.jsx)(a.p,{children:(0,e.jsx)(a.img,{alt:\"alert email in teams room\",src:\"https://images.ctfassets.net/on47yk52ubpi/3Ku7sbHmpWWhZkraQdtkYQ/f6b514ad3c1facfea4412f6d4fc4a31b/Screen_Shot_2023-01-25_at_5.00.10_PM.png\"})}),(0,e.jsx)(a.p,{children:\"Now when this alert occurs, I get this Teams message and 1 less email. This has the added benefit of being able to notify large groups of people at once without having to add individual recipients! Less email for everyone!\"})]})}}var w=_;return b(T);})();\n;return Component;"
    },
    "_id": "blog/adobe-analytics-alerts-in-microsoft-teams.mdx",
    "_raw": {
      "sourceFilePath": "blog/adobe-analytics-alerts-in-microsoft-teams.mdx",
      "sourceFileName": "adobe-analytics-alerts-in-microsoft-teams.mdx",
      "sourceFileDir": "blog",
      "contentType": "mdx",
      "flattenedPath": "blog/adobe-analytics-alerts-in-microsoft-teams"
    },
    "type": "Blog",
    "readingTime": {
      "text": "2 min read",
      "minutes": 1.81,
      "time": 108600,
      "words": 362
    },
    "slug": "adobe-analytics-alerts-in-microsoft-teams",
    "toc": [
      {
        "value": "Corporate Chat apps and you",
        "url": "#corporate-chat-apps-and-you",
        "depth": 2
      },
      {
        "value": "Sending Adobe Analytics Alerts as to Teams rooms",
        "url": "#sending-adobe-analytics-alerts-as-to-teams-rooms",
        "depth": 2
      }
    ]
  },
  {
    "title": "Building an Adobe Analytics Metrics & Dimensions definitions page with the Adobe Analytics API",
    "date": "2022-12-07T00:00:00.000Z",
    "tags": [
      "adobe analytics",
      "markdown",
      "api",
      "automation"
    ],
    "draft": false,
    "summary": "How to make metric and dimension definitions more easily available",
    "body": {
      "raw": "\nA lot of people in my organization need to know what Adobe metrics and dimensions mean.\nThey should not have to know how to go into the Report Suites Admin section to get this information.\nData Warehouse and other such raw data consumers don’t get nicely named events and dimensions like _User\nLogin_ and _Article Name_; they get _event304_ and _eVar6_. I used the Adobe Analytics API to build a simple,\nunauthenticated (no Adobe login required) page where people can quickly and easily look up what all these data points mean.\n\n**Here is an example of what I built in my organization (with fake data of course):**\n\nhttps://johndavidsimmons.github.io/adobevargrid/adobevargrid\n\n**Here is a link to the code on Github:**\n\nhttps://github.com/johndavidsimmons/adobevargrid\n\n<br></br>\n\n![demo gif](https://images.ctfassets.net/on47yk52ubpi/1TrQCpsMRF7RET07TOdkvP/7ffe8bfcc1df39b08687c1b0ee406fe4/1_ui_iwDDm_LB7EuApCl9u8w.gif)\n\n---\n\n## Preamble\n\nFirst things first, before I can do anything with the Adobe Analytics API (or any Adobe API),\nI need to setup a new project in the developer console. This process will generate the necessary keys\nI need to make API calls. If you have never done it before, check out the tutorials here: https://developer.adobe.com/developer-console/\n\nI did my last Adobe API project in Node, so I’ll do this one in Python. I will also award myself bonus\npoints for not using the [Adobe Analytics Python library](https://github.com/pitchmuc/adobe-analytics-api-2.0). I am going to skip over some of the basic Python\nsetup stuff like virtual environments and installing packages. If you are interested in getting started with Python,\nI suggest checking out [realpython.com](https://www.realpython.com).\n\n## The beginning of the end…\n\nFor this project its actually easier to start at the end and work backwards.\nNamely, what do I want to this site to look like and where do I want do host it?\nThe looks are not so important, but the ease of automation and security are paramount.\nI want this page to update automatically and I only want it available to my organization’s users (aka people on the company VPN).\n\nEnter [Github Pages](https://pages.github.com/). Github pages are the perfect place to host analytics documentation because they\nlet you host static content written in [Markdown](https://www.markdownguide.org/) or plain HTML. Also, since you likely have an enterprise github account,\nthey have the added benefit of sitting behind your corporate VPN and are thus only available to your fellow VPN users.\nAnother great thing about Github pages is that you can tie their deployment to branch updates.\nThis is crucial to the automation process. More on that later.\n\n## Authenticating\n\nBefore I can actually communicate with Adobe Analytics via the API, I need to authenticate.\nThis done by exchanging the API credentials I created in the developer console for a [JSON Web Token](https://jwt.io/introduction).\nAdobe’s documentation on JWT exchange can be found here: https://developer.adobe.com/analytics-apis/docs/2.0/guides/jwt/.\n\n_I am borrowing a lot from the Python example in their documentation._\n\nBy exchanging my API credentials for a JWT token, I will in turn receive an access token which I can then use to make Adobe Analytics API calls.\n\n```python\ndef get_jwt(scope):\n    \"\"\"Encodes AA API creds into a JWT token\"\"\"\n    payload:dict = {\n        \"exp\": datetime.datetime.utcnow() + datetime.timedelta(seconds=30), # 30 second expiration for JWT\n        \"iss\": org_id,\n        \"sub\": tech_acct_id,\n        f\"https://{ims_host}/s/{scope}\": True,\n        \"aud\": f\"https://{ims_host}/c/{client_id}\"\n    }\n\n    # Encode the payload & sign with private key\n    return jwt.encode(payload, str.encode(private_key.replace(\"\\\\n\",\"\\n\")), algorithm=\"RS256\")\n\ndef get_access_token(jwt_token):\n    \"\"\"Requests and access token from Adobe for use in API calls\"\"\"\n    access_payload:dict = {\n        \"client_id\": client_id,\n        \"client_secret\": client_secret,\n        \"jwt_token\": jwt_token\n    }\n\n    # Send the JWT in exchange for an access token\n    # I have disabled verification here due to firewall complications\n    r = requests.post(\n        ims_exchange, data=access_payload, verify=False\n    )\n    # this is the token I need to make AA API calls\n    return r.json()[\"access_token\"]\n```\n\n## Gathering Data\n\nNow that I can authenticate, I can ask Adobe to give me information about the metrics and dimensions for a specific report suite.\nProps and Evars can be found in the [dimensions method](https://adobedocs.github.io/analytics-2.0-apis/#/Dimensions) and Events can be found in the [Metrics Method](https://adobedocs.github.io/analytics-2.0-apis/#/Metrics/getMetrics).\nThese methods both send a lot of data. I my case I only need the basics so I am filtering extraneous things like\nOOTB metrics, product events, entry/exit props, etc. I am also filtering out unused metrics and dimensions.\nTherefore, if I see an event, prop, or evar number not in my list, then it is available for use!\n\n```python\njwt_token = get_jwt(aa_scope)\naccess_token = get_access_token(jwt_token)\n\nheaders = {\n    \"accept\": \"application/json\",\n    \"x-proxy-global-company-id\": global_company_id,\n    \"x-api-key\": client_id,\n    \"Authorization\": f\"Bearer {access_token}\"\n}\n\nr = requests.get(f\"https://analytics.adobe.io/api/{global_company_id}/dimensions?rsid={rsid}\", headers=headers)\ndimensions = r.json()\nprops = filter(lambda dimension: dimension.get('extraTitleInfo') is not None and \"prop\" in dimension.get('extraTitleInfo'), dimensions)\nfiltered_props = [prop for prop in props if \"entry\" not in prop['id'] and \"exit\" not in prop['id']]\nevars = filter(lambda dimension: dimension.get('extraTitleInfo') is not None and \"evar\" in dimension.get('extraTitleInfo'), dimensions)\n\n# order props in numerical order\ndef order_nums(dimension):\n    id = dimension.get('id')\n    regex = r\"\\d+\"\n    return int(re.findall(regex,id).pop())\n\nfiltered_props.sort(key=order_nums)\n\n# for prop in filtered_props:\n    # print(prop)\n\n    # returns:\n    # {'id': 'variables/prop1', 'title': 'pagename', 'name': 'pagename', 'type': 'string', .....\n    # {'id': 'variables/prop2', 'title': 'username', 'name': 'username', 'type': 'string', .....\n    # {'id': 'variables/prop3', 'title': 'url', 'name': 'url', 'type': 'string', .....\n    # etc etc\n    # similar output for evars\n\nm = requests.get(f\"https://analytics.adobe.io/api/{global_company_id}/metrics?rsid={rsid}\", headers=headers)\nmetrics = m.json()\nevents = list(filter(lambda event: event.get(\"extraTitleInfo\") is not None and \"event\" in event.get(\"extraTitleInfo\"), metrics))\nevents.sort(key=order_nums)\n\n# for event in events:\n    # print(event)\n\n    # returns:\n    # {'id': 'metrics/event1', 'title': 'Pageview', 'name': 'Pageview', 'type': 'int', 'extraTitleInfo': 'event1',....\n    # {'id': 'metrics/event2', 'title': 'Login', 'name': 'Login', 'type': 'int', 'extraTitleInfo': 'event2', ....\n    # {'id': 'metrics/event3', 'title': 'Click', 'name': 'Click', 'type': 'int', 'extraTitleInfo': 'event3', ....\n    # etc etc\n```\n\n---\n\n## Building Markdown\n\nMarkdown is great because it allows you to build HTML elements with a simplified syntax.\nHowever, you can also mix and match standard HTML elements should the need arise.\nPython is great because you can programmatically build markdown files.\nWhat I am going to do here is essentially build a giant string of markdown step by step with all my\ndata then save the entire string to a file. An important thing to remember is that Markdown takes whitespace\ninto account between elements; hence my use of [multi-line strings](https://www.w3schools.com/python/gloss_python_multi_line_strings.asp). If things come out looking funky,\nmake sure your spacing is correct. First lets start with a head section. _I will address the functionality of the search bar later_\n\n```python\nlast_update = datetime.datetime.now() - datetime.timedelta(hours=4) # adjust for utc time of automation server\n\noutput = f\"\"\"\n# Adobe Analytics Events and Dimensions\n<br>\n*Last Updated: {last_update.strftime(\"%x - %X\")}*\n<div id=\"variablesearch\">\n    <input name=\"search\" placeholder=\"Search\" value=\"\">\n</div>\n\n## Report Suite: {rsid}\n<hr>\"\"\"\n```\n\n![building markdown](https://images.ctfassets.net/on47yk52ubpi/7qsCfG6vPziOarRpCbeJfP/e2be1c671491cf79bb23cc3912b2565a/1_JKDc94U-szKMF_Za6mTsWg.webp)\n\n<figure>\n  <figcaption>Generated Markdown</figcaption>\n</figure>\n\nSince I already have all the data I need from the API, all thats left is to make it presentable.\nI’ll use Markdown tables for this. The gist is: setup the heading for the table, loop through my Adobe data to create\ntable rows, add some spacing for the next table, repeat. There will be 3 tables: props, evars, and events.\nRemember that I am creating a giant string of markdown, so when adding the tables I am adding to the output\nstring I already created in the heading section.\n\n```python\noutput += \"\"\"\n### Props\n| Number | Name | Description |\n|----------|----------|----------|\"\"\"\n\nfor p in filtered_props:\n    description = p.get('description')\n    # descriptions come with weird formatting sometimes...\n    if description:\n        description = description.strip().replace(\"\\r\", \" \").replace(\"\\n\", \" \")\n    id = p.get('id').replace(\"variables/\", \"\")\n    name = p.get('name')\n    output += f\"\\n|{id} | {name} | {description}\"\n\n# remember to add spacing between elements in markdown\noutput += \"\\n\"\noutput += \"\"\"\n\n### Evars\n\n| Number | Name | Description |\n|----------|----------|----------|\"\"\"\n\nfor e in evars:\n    description = e.get('description')\n    if description:\n        description = description.strip().replace(\"\\r\", \" \").replace(\"\\n\", \" \")\n    id = e.get('id').replace(\"variables/\", \"\")\n    name = e.get('name')\n    output += f\"\\n|{id}|{name}|{description}|\"\n\noutput += \"\\n\"\noutput += \"\"\"\n\n### Events\n\n| Number | Name | Description |\n|----------|----------|----------|\"\"\"\n\nfor e in list(events):\n    description = e.get('description')\n    if description:\n        description = description.strip().replace(\"\\r\", \" \").replace(\"\\n\", \" \")\n    id = e.get('id').replace(\"metrics/\", \"\")\n    name = e.get('name')\n    output += f\"\\n|{id}|{name}|{description}|\"\n```\n\n![static outuput](https://images.ctfassets.net/on47yk52ubpi/6gC7J65yYtbxEomc2WaAy0/d97d530ec78976cc5f3d3c4c09026b6c/1_tY45-kPLBT7BiiOUyPRd1g.webp)\n\n<figure>\n  <figcaption>\n    These are all fake, but this is the exact output format I want. This is also truncated for\n    brevity. A real report suite will likely have hundreds of rows.\n  </figcaption>\n</figure>\n\n---\n\n## Style & Search\n\nWhen there are hundreds of rows the table needs some color to break it up.\nYou can add styling to the output in plain HTML since markdown is interpreted by the\nbrowser as HTML (the markdown tables become regular HTML tables with columns, rows, etc.).\nI’ll color every other row just to make it so this thing isn’t a wall of text.\n\n```python\n# CSS\noutput += \"\"\"\n<style>\n    tr:nth-child(even) {\n        background-color:#ECECEC !important;\n    }\n</style>\n\"\"\"\n```\n\n![style rows](https://images.ctfassets.net/on47yk52ubpi/42v50YAkTlqh55yOmAOe74/dabe39bd9f2b714e4badd039ba8f9daf/1_xsB1269m6BRlp6F4YqYNDg.webp)\n\n<figure>\n  <figcaption>\n    You can apply any style to Markdown just as you would regular HTML elements\n  </figcaption>\n</figure>\n\nTo make this table _searchable_ (and actually useful) I need to add a little JS.\nOnce I have it working as expected, I can append it to my markdown string, just like every other element,\nto have it added to the final output file. Again, since markdown converts into regular HTML you can write javascript\nto manipulate it. Here, when someone types in the search box, the table will begin filtering for those characters.\nIf there is match in the number, name, or description, it will show only those rows.\nThis is why my search bar element has an HTML id of _variablesearch_.\n\n'Now when someone asks me _“Hey what does event57 mean?”_ I can say _“Go check the Adobe Variable grid!”_\n\n```python\n# Javascript\noutput += \"\"\"\n<script>\n    document\n      .querySelector('#variablesearch input')\n      .addEventListener('keyup', (event) => {\n        let query = event.target.value.toLowerCase();\n        let tds = Array.from(document.querySelectorAll('td'));\n        let filtered_tds = tds.filter((td) =>\n          td.innerText.toLowerCase().includes(query)\n        );\n        tds.forEach(\n          (element) => (element.parentElement.style.display = 'none')\n        );\n        filtered_tds.forEach((element) => {\n          element.parentElement.style.display = '';\n        });\n      });\n</script>\n\"\"\"\n```\n\n![demo gif](https://images.ctfassets.net/on47yk52ubpi/1TrQCpsMRF7RET07TOdkvP/7ffe8bfcc1df39b08687c1b0ee406fe4/1_ui_iwDDm_LB7EuApCl9u8w.gif)\n\n<figure>\n  <figcaption>Now I can search all my events and dimensions by name and description!</figcaption>\n</figure>\n\n## Saving the string as a file\n\nNow that I have all the markdown and HTML code I need in a single string,\nI need to save that string as a file. If this file doesn’t exist, it will be created.\nIf it does exist, it will be overwritten with the newest data.\n\n```python\nwith open('adobevargrid.md', 'w') as f:\n    f.write(output)\n```\n\n---\n\n## Automation\n\nThe page is “done” technically, but I don’t want to have to update it manually every time I\n(or any of the other admins in my Adobe Organization) make a change to our metrics and dimensions.\nI would like this page to be as accurate and up to date as possible. Because Github pages will deploy the\nlatest version of my Markdown file (_adobevargrid.md_) as a page whenever I push a change, I\ncan keep this page up to date by programmatically running the running the script (_app.py_ which generates _adobevargrid.md_)\nand programmatically pushing the latest file to Github.\n\nThere are a couple different options here depending on how comfortable you are with the command line\nand/or if your organization has integrated build tools into Github pushes such as [CircleCI](https://circleci.com/).\nKeeping with today’s theme, lets do it in Python using the [GitPython Library](https://gitpython.readthedocs.io/en/stable/).\n_Note that Github credentials must be setup prior to using this code!_\n\n```python\nimport os\nfrom git import Repo\n\n# gh.py\n# YOU MUST HAVE .git FILE CONFIGURED CORRECTLY\ndir = os.getcwd()\nrepo = Repo(dir)\nrepo.git.add(update=True)\nrepo.index.commit(\"update vargrid\")\norigin = repo.remote(name='origin')\norigin.push()\n```\n\nSo now I have a script that pulls the latest event and dimension data, builds it into a presentable file,\nand a script that automatically pushes that new file to Github to host it on a Github page. The last step is making it run every day.\n\nI will do this as a [cron job](https://www.youtube.com/watch?v=v952m13p-b4) on a virtual linux machine from Linode.\nYou could also do this as an AWS Lambda and trigger it daily with AWS EventBridge,\nbut [deploying Python environments with dependencies to AWS Lambda is kind of a pain](https://docs.aws.amazon.com/lambda/latest/dg/python-package.html). Here are the steps:\n\n- Create a virtual machine in Linode and install Git, Python, Virtualenv, etc\n- Clone my repo onto the virtual machine and navigate to the directory\n- Transfer my environment variables (API keys) to the virtual machine either by entering them directly or using a .env file\n- Create a virtualenv and install the dependencies from requirements.txt\n- Run app.py once to confirm it works\n- Run gh.py once to ensure it works\n- Navigate to my VM’s crontab file and add the following line to the end:\n\n```bash\n# etc\n# etc\n# m h dom mon dow\n0 8 * * * cd /adobevargrid && . venv/bin/activate && python app.py && python gh.py\n```\n\nNow every day at 8am my virtual machine will pull the latest metrics and events definitions directly from Adobe,\nbuild a new markdown page out of them, and automatically push that change to Github.\nWhen Github receives this change, it will transform that markdown into a viewable page via Github Pages.\n\nSee the an example of the final output here:\n\nhttps://johndavidsimmons.github.io/adobevargrid/adobevargrid\n",
      "code": "var Component=(()=>{var d=Object.create;var c=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{for(var t in s)c(a,t,{get:s[t],enumerable:!0})},l=(a,s,t,e)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let i of h(s))!u.call(a,i)&&i!==t&&c(a,i,{get:()=>s[i],enumerable:!(e=p(s,i))||e.enumerable});return a};var g=(a,s,t)=>(t=a!=null?d(m(a)):{},l(s||!a||!a.__esModule?c(t,\"default\",{value:a,enumerable:!0}):t,a)),b=a=>l(c({},\"__esModule\",{value:!0}),a);var r=N((A,o)=>{o.exports=_jsx_runtime});var v={};k(v,{default:()=>w,frontmatter:()=>y});var n=g(r()),y={title:\"Building an Adobe Analytics Metrics & Dimensions definitions page with the Adobe Analytics API\",date:\"2022-12-07\",tags:[\"adobe analytics\",\"markdown\",\"api\",\"automation\"],draft:!1,summary:\"How to make metric and dimension definitions more easily available\"};function f(a={}){let{wrapper:s}=a.components||{};return s?(0,n.jsx)(s,Object.assign({},a,{children:(0,n.jsx)(t,{})})):t();function t(){let e=Object.assign({p:\"p\",em:\"em\",strong:\"strong\",a:\"a\",img:\"img\",hr:\"hr\",h2:\"h2\",span:\"span\",pre:\"pre\",code:\"code\",ul:\"ul\",li:\"li\"},a.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(e.p,{children:[\"A lot of people in my organization need to know what Adobe metrics and dimensions mean. They should not have to know how to go into the Report Suites Admin section to get this information. Data Warehouse and other such raw data consumers don\\u2019t get nicely named events and dimensions like \",(0,n.jsx)(e.em,{children:\"User Login\"}),\" and \",(0,n.jsx)(e.em,{children:\"Article Name\"}),\"; they get \",(0,n.jsx)(e.em,{children:\"event304\"}),\" and \",(0,n.jsx)(e.em,{children:\"eVar6\"}),\". I used the Adobe Analytics API to build a simple, unauthenticated (no Adobe login required) page where people can quickly and easily look up what all these data points mean.\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Here is an example of what I built in my organization (with fake data of course):\"})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://johndavidsimmons.github.io/adobevargrid/adobevargrid\",children:\"https://johndavidsimmons.github.io/adobevargrid/adobevargrid\"})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Here is a link to the code on Github:\"})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://github.com/johndavidsimmons/adobevargrid\",children:\"https://github.com/johndavidsimmons/adobevargrid\"})}),(0,n.jsx)(\"br\",{}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"demo gif\",src:\"https://images.ctfassets.net/on47yk52ubpi/1TrQCpsMRF7RET07TOdkvP/7ffe8bfcc1df39b08687c1b0ee406fe4/1_ui_iwDDm_LB7EuApCl9u8w.gif\"})}),(0,n.jsx)(e.hr,{}),(0,n.jsxs)(e.h2,{id:\"preamble\",children:[(0,n.jsx)(e.a,{href:\"#preamble\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Preamble\"]}),(0,n.jsxs)(e.p,{children:[\"First things first, before I can do anything with the Adobe Analytics API (or any Adobe API), I need to setup a new project in the developer console. This process will generate the necessary keys I need to make API calls. If you have never done it before, check out the tutorials here: \",(0,n.jsx)(e.a,{href:\"https://developer.adobe.com/developer-console/\",children:\"https://developer.adobe.com/developer-console/\"})]}),(0,n.jsxs)(e.p,{children:[\"I did my last Adobe API project in Node, so I\\u2019ll do this one in Python. I will also award myself bonus points for not using the \",(0,n.jsx)(e.a,{href:\"https://github.com/pitchmuc/adobe-analytics-api-2.0\",children:\"Adobe Analytics Python library\"}),\". I am going to skip over some of the basic Python setup stuff like virtual environments and installing packages. If you are interested in getting started with Python, I suggest checking out \",(0,n.jsx)(e.a,{href:\"https://www.realpython.com\",children:\"realpython.com\"}),\".\"]}),(0,n.jsxs)(e.h2,{id:\"the-beginning-of-the-end\",children:[(0,n.jsx)(e.a,{href:\"#the-beginning-of-the-end\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"The beginning of the end\\u2026\"]}),(0,n.jsx)(e.p,{children:\"For this project its actually easier to start at the end and work backwards. Namely, what do I want to this site to look like and where do I want do host it? The looks are not so important, but the ease of automation and security are paramount. I want this page to update automatically and I only want it available to my organization\\u2019s users (aka people on the company VPN).\"}),(0,n.jsxs)(e.p,{children:[\"Enter \",(0,n.jsx)(e.a,{href:\"https://pages.github.com/\",children:\"Github Pages\"}),\". Github pages are the perfect place to host analytics documentation because they let you host static content written in \",(0,n.jsx)(e.a,{href:\"https://www.markdownguide.org/\",children:\"Markdown\"}),\" or plain HTML. Also, since you likely have an enterprise github account, they have the added benefit of sitting behind your corporate VPN and are thus only available to your fellow VPN users. Another great thing about Github pages is that you can tie their deployment to branch updates. This is crucial to the automation process. More on that later.\"]}),(0,n.jsxs)(e.h2,{id:\"authenticating\",children:[(0,n.jsx)(e.a,{href:\"#authenticating\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Authenticating\"]}),(0,n.jsxs)(e.p,{children:[\"Before I can actually communicate with Adobe Analytics via the API, I need to authenticate. This done by exchanging the API credentials I created in the developer console for a \",(0,n.jsx)(e.a,{href:\"https://jwt.io/introduction\",children:\"JSON Web Token\"}),\". Adobe\\u2019s documentation on JWT exchange can be found here: \",(0,n.jsx)(e.a,{href:\"https://developer.adobe.com/analytics-apis/docs/2.0/guides/jwt/\",children:\"https://developer.adobe.com/analytics-apis/docs/2.0/guides/jwt/\"}),\".\"]}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.em,{children:\"I am borrowing a lot from the Python example in their documentation.\"})}),(0,n.jsx)(e.p,{children:\"By exchanging my API credentials for a JWT token, I will in turn receive an access token which I can then use to make Adobe Analytics API calls.\"}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"get_jwt\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"scope\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Encodes AA API creds into a JWT token\"\"\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    payload\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"dict\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"exp\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" datetime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"datetime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"utcnow\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+\"}),\" datetime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"timedelta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"seconds\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"30\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# 30 second expiration for JWT\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"iss\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" org_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"sub\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" tech_acct_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"https://'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"ims_host\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"/s/\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"scope\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"aud\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"https://'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"ims_host\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"/c/\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"client_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Encode the payload & sign with private key\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" jwt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"payload\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"str\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"encode\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"private_key\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" algorithm\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"RS256\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"get_access_token\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"jwt_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:'\"\"\"Requests and access token from Adobe for use in API calls\"\"\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    access_payload\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"dict\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"client_id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" client_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"client_secret\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" client_secret\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"jwt_token\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),` jwt_token\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Send the JWT in exchange for an access token\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# I have disabled verification here due to firewall complications\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"post\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        ims_exchange\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" data\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"access_payload\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" verify\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"False\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# this is the token I need to make AA API calls\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"access_token\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]})]})}),(0,n.jsxs)(e.h2,{id:\"gathering-data\",children:[(0,n.jsx)(e.a,{href:\"#gathering-data\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Gathering Data\"]}),(0,n.jsxs)(e.p,{children:[\"Now that I can authenticate, I can ask Adobe to give me information about the metrics and dimensions for a specific report suite. Props and Evars can be found in the \",(0,n.jsx)(e.a,{href:\"https://adobedocs.github.io/analytics-2.0-apis/#/Dimensions\",children:\"dimensions method\"}),\" and Events can be found in the \",(0,n.jsx)(e.a,{href:\"https://adobedocs.github.io/analytics-2.0-apis/#/Metrics/getMetrics\",children:\"Metrics Method\"}),\". These methods both send a lot of data. I my case I only need the basics so I am filtering extraneous things like OOTB metrics, product events, entry/exit props, etc. I am also filtering out unused metrics and dimensions. Therefore, if I see an event, prop, or evar number not in my list, then it is available for use!\"]}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"jwt_token \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" get_jwt\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"aa_scope\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"access_token \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" get_access_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"jwt_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"headers \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"accept\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"application/json\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"x-proxy-global-company-id\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" global_company_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"x-api-key\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" client_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"Authorization\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"Bearer '}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"access_token\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"r \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"https://analytics.adobe.io/api/'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"global_company_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"/dimensions?rsid=\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"rsid\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" headers\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"headers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"dimensions \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" r\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"props \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"filter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"lambda\"}),\" dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'extraTitleInfo'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"None\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"and\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"prop\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'extraTitleInfo'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dimensions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"filtered_props \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),\"prop \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" prop \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" props \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"entry\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" prop\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"and\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"exit\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" prop\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"[\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"evars \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"filter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"lambda\"}),\" dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'extraTitleInfo'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"None\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"and\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"evar\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'extraTitleInfo'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" dimensions\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# order props in numerical order\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,n.jsx)(e.span,{className:\"token function\",children:\"order_nums\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"id\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" dimension\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    regex \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'r\"\\\\d+\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"return\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"int\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"re\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"findall\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"regex\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"pop\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"filtered_props\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"sort\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"order_nums\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# for prop in filtered_props:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# print(prop)\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# returns:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# {'id': 'variables/prop1', 'title': 'pagename', 'name': 'pagename', 'type': 'string', .....\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# {'id': 'variables/prop2', 'title': 'username', 'name': 'username', 'type': 'string', .....\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# {'id': 'variables/prop3', 'title': 'url', 'name': 'url', 'type': 'string', .....\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# etc etc\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# similar output for evars\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"m \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"https://analytics.adobe.io/api/'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"global_company_id\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"/metrics?rsid=\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"rsid\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" headers\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"headers\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"metrics \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" m\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"json\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"events \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"list\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"filter\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token keyword\",children:\"lambda\"}),\" event\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),\" event\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"extraTitleInfo\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"is\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"not\"}),\" \",(0,n.jsx)(e.span,{className:\"token boolean\",children:\"None\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"and\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"event\"'}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" event\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"extraTitleInfo\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" metrics\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"events\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"sort\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"key\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\"order_nums\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# for event in events:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# print(event)\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# returns:\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# {'id': 'metrics/event1', 'title': 'Pageview', 'name': 'Pageview', 'type': 'int', 'extraTitleInfo': 'event1',....\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# {'id': 'metrics/event2', 'title': 'Login', 'name': 'Login', 'type': 'int', 'extraTitleInfo': 'event2', ....\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# {'id': 'metrics/event3', 'title': 'Click', 'name': 'Click', 'type': 'int', 'extraTitleInfo': 'event3', ....\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# etc etc\"}),`\n`]})]})}),(0,n.jsx)(e.hr,{}),(0,n.jsxs)(e.h2,{id:\"building-markdown\",children:[(0,n.jsx)(e.a,{href:\"#building-markdown\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Building Markdown\"]}),(0,n.jsxs)(e.p,{children:[\"Markdown is great because it allows you to build HTML elements with a simplified syntax. However, you can also mix and match standard HTML elements should the need arise. Python is great because you can programmatically build markdown files. What I am going to do here is essentially build a giant string of markdown step by step with all my data then save the entire string to a file. An important thing to remember is that Markdown takes whitespace into account between elements; hence my use of \",(0,n.jsx)(e.a,{href:\"https://www.w3schools.com/python/gloss_python_multi_line_strings.asp\",children:\"multi-line strings\"}),\". If things come out looking funky, make sure your spacing is correct. First lets start with a head section. \",(0,n.jsx)(e.em,{children:\"I will address the functionality of the search bar later\"})]}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"last_update \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" datetime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"datetime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"now\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"-\"}),\" datetime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"timedelta\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"hours\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token number\",children:\"4\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# adjust for utc time of automation server\"}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string-interpolation\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`f\"\"\"\n`})})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string-interpolation\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`# Adobe Analytics Events and Dimensions\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string-interpolation\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`<br>\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:\"*Last Updated: \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"last_update\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"strftime\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"%x - %X\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:`*\n`})]})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string-interpolation\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`<div id=\"variablesearch\">\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string-interpolation\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`    <input name=\"search\" placeholder=\"Search\" value=\"\">\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string-interpolation\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`</div>\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string-interpolation\",children:(0,n.jsx)(e.span,{className:\"token string\",children:`\n`})})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:\"## Report Suite: \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"rsid\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:`\n`})]})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string-interpolation\",children:(0,n.jsx)(e.span,{className:\"token string\",children:'<hr>\"\"\"'})}),`\n`]})]})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"building markdown\",src:\"https://images.ctfassets.net/on47yk52ubpi/7qsCfG6vPziOarRpCbeJfP/e2be1c671491cf79bb23cc3912b2565a/1_JKDc94U-szKMF_Za6mTsWg.webp\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:\"Generated Markdown\"})}),(0,n.jsx)(e.p,{children:\"Since I already have all the data I need from the API, all thats left is to make it presentable. I\\u2019ll use Markdown tables for this. The gist is: setup the heading for the table, loop through my Adobe data to create table rows, add some spacing for the next table, repeat. There will be 3 tables: props, evars, and events. Remember that I am creating a giant string of markdown, so when adding the tables I am adding to the output string I already created in the heading section.\"}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`### Props\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`| Number | Name | Description |\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:'|----------|----------|----------|\"\"\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" p \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" filtered_props\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    description \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" p\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'description'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token comment\",children:\"# descriptions come with weird formatting sometimes...\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" description\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        description \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" description\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"strip\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\r\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\" \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\" \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"id\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" p\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"variables/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" p\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"\\\\n|'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" | \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\" | \"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"description\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"'})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# remember to add spacing between elements in markdown\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\n\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`### Evars\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`| Number | Name | Description |\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:'|----------|----------|----------|\"\"\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" e \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" evars\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    description \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'description'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" description\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        description \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" description\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"strip\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\r\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\" \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\" \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"id\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"variables/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"\\\\n|'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"|\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"|\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"description\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'|\"'})]}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\n\"'}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`### Events\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`| Number | Name | Description |\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:'|----------|----------|----------|\"\"\"'}),`\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"for\"}),\" e \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"in\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"list\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"events\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    description \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'description'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"if\"}),\" description\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"        description \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" description\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"strip\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\r\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\" \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"\\\\n\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\" \"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"id\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'id'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"replace\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"metrics/\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:'\"\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    name \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" e\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'name'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsxs)(e.span,{className:\"token string-interpolation\",children:[(0,n.jsx)(e.span,{className:\"token string\",children:'f\"\\\\n|'}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"id\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"|\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"name\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:\"|\"}),(0,n.jsxs)(e.span,{className:\"token interpolation\",children:[(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"{\"}),\"description\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"}\"})]}),(0,n.jsx)(e.span,{className:\"token string\",children:'|\"'})]}),`\n`]})]})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"static outuput\",src:\"https://images.ctfassets.net/on47yk52ubpi/6gC7J65yYtbxEomc2WaAy0/d97d530ec78976cc5f3d3c4c09026b6c/1_tY45-kPLBT7BiiOUyPRd1g.webp\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:(0,n.jsx)(e.p,{children:\"These are all fake, but this is the exact output format I want. This is also truncated for brevity. A real report suite will likely have hundreds of rows.\"})})}),(0,n.jsx)(e.hr,{}),(0,n.jsxs)(e.h2,{id:\"style--search\",children:[(0,n.jsx)(e.a,{href:\"#style--search\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Style & Search\"]}),(0,n.jsx)(e.p,{children:\"When there are hundreds of rows the table needs some color to break it up. You can add styling to the output in plain HTML since markdown is interpreted by the browser as HTML (the markdown tables become regular HTML tables with columns, rows, etc.). I\\u2019ll color every other row just to make it so this thing isn\\u2019t a wall of text.\"}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# CSS\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`<style>\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`    tr:nth-child(even) {\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`        background-color:#ECECEC !important;\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`    }\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`</style>\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:'\"\"\"'}),`\n`]})]})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"style rows\",src:\"https://images.ctfassets.net/on47yk52ubpi/42v50YAkTlqh55yOmAOe74/dabe39bd9f2b714e4badd039ba8f9daf/1_xsB1269m6BRlp6F4YqYNDg.webp\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:(0,n.jsx)(e.p,{children:\"You can apply any style to Markdown just as you would regular HTML elements\"})})}),(0,n.jsxs)(e.p,{children:[\"To make this table \",(0,n.jsx)(e.em,{children:\"searchable\"}),\" (and actually useful) I need to add a little JS. Once I have it working as expected, I can append it to my markdown string, just like every other element, to have it added to the final output file. Again, since markdown converts into regular HTML you can write javascript to manipulate it. Here, when someone types in the search box, the table will begin filtering for those characters. If there is match in the number, name, or description, it will show only those rows. This is why my search bar element has an HTML id of \",(0,n.jsx)(e.em,{children:\"variablesearch\"}),\".\"]}),(0,n.jsxs)(e.p,{children:[\"'Now when someone asks me \",(0,n.jsx)(e.em,{children:\"\\u201CHey what does event57 mean?\\u201D\"}),\" I can say \",(0,n.jsx)(e.em,{children:\"\\u201CGo check the Adobe Variable grid!\\u201D\"})]}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# Javascript\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"output \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"+=\"}),\" \",(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`\"\"\"\n`})]}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`<script>\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`    document\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`      .querySelector('#variablesearch input')\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`      .addEventListener('keyup', (event) => {\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`        let query = event.target.value.toLowerCase();\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`        let tds = Array.from(document.querySelectorAll('td'));\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`        let filtered_tds = tds.filter((td) =>\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`          td.innerText.toLowerCase().includes(query)\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`        );\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`        tds.forEach(\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`          (element) => (element.parentElement.style.display = 'none')\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`        );\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`        filtered_tds.forEach((element) => {\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`          element.parentElement.style.display = '';\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`        });\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`      });\n`})}),(0,n.jsx)(e.span,{className:\"code-line\",children:(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:`<\\/script>\n`})}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token string triple-quoted-string\",children:'\"\"\"'}),`\n`]})]})}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{alt:\"demo gif\",src:\"https://images.ctfassets.net/on47yk52ubpi/1TrQCpsMRF7RET07TOdkvP/7ffe8bfcc1df39b08687c1b0ee406fe4/1_ui_iwDDm_LB7EuApCl9u8w.gif\"})}),(0,n.jsx)(\"figure\",{children:(0,n.jsx)(\"figcaption\",{children:\"Now I can search all my events and dimensions by name and description!\"})}),(0,n.jsxs)(e.h2,{id:\"saving-the-string-as-a-file\",children:[(0,n.jsx)(e.a,{href:\"#saving-the-string-as-a-file\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Saving the string as a file\"]}),(0,n.jsx)(e.p,{children:\"Now that I have all the markdown and HTML code I need in a single string, I need to save that string as a file. If this file doesn\\u2019t exist, it will be created. If it does exist, it will be overwritten with the newest data.\"}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"with\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin\",children:\"open\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'adobevargrid.md'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,n.jsx)(e.span,{className:\"token string\",children:\"'w'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"as\"}),\" f\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"    f\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"write\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"output\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.hr,{}),(0,n.jsxs)(e.h2,{id:\"automation\",children:[(0,n.jsx)(e.a,{href:\"#automation\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,n.jsx)(e.span,{className:\"icon icon-link\"})}),\"Automation\"]}),(0,n.jsxs)(e.p,{children:[\"The page is \\u201Cdone\\u201D technically, but I don\\u2019t want to have to update it manually every time I (or any of the other admins in my Adobe Organization) make a change to our metrics and dimensions. I would like this page to be as accurate and up to date as possible. Because Github pages will deploy the latest version of my Markdown file (\",(0,n.jsx)(e.em,{children:\"adobevargrid.md\"}),\") as a page whenever I push a change, I can keep this page up to date by programmatically running the running the script (\",(0,n.jsx)(e.em,{children:\"app.py\"}),\" which generates \",(0,n.jsx)(e.em,{children:\"adobevargrid.md\"}),\") and programmatically pushing the latest file to Github.\"]}),(0,n.jsxs)(e.p,{children:[\"There are a couple different options here depending on how comfortable you are with the command line and/or if your organization has integrated build tools into Github pushes such as \",(0,n.jsx)(e.a,{href:\"https://circleci.com/\",children:\"CircleCI\"}),\". Keeping with today\\u2019s theme, lets do it in Python using the \",(0,n.jsx)(e.a,{href:\"https://gitpython.readthedocs.io/en/stable/\",children:\"GitPython Library\"}),\". \",(0,n.jsx)(e.em,{children:\"Note that Github credentials must be setup prior to using this code!\"})]}),(0,n.jsx)(e.pre,{className:\"language-python\",children:(0,n.jsxs)(e.code,{className:\"language-python code-highlight\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` os\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token keyword\",children:\"from\"}),\" git \",(0,n.jsx)(e.span,{className:\"token keyword\",children:\"import\"}),` Repo\n`]}),(0,n.jsx)(e.span,{className:\"code-line\",children:`\n`}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# gh.py\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# YOU MUST HAVE .git FILE CONFIGURED CORRECTLY\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token builtin\",children:\"dir\"}),\" \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" os\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"getcwd\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"repo \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" Repo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token builtin\",children:\"dir\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"repo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"git\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"add\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"update\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token boolean\",children:\"True\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"repo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"index\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"commit\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token string\",children:'\"update vargrid\"'}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"origin \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),\" repo\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"remote\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),\"name\",(0,n.jsx)(e.span,{className:\"token operator\",children:\"=\"}),(0,n.jsx)(e.span,{className:\"token string\",children:\"'origin'\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[\"origin\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\".\"}),\"push\",(0,n.jsx)(e.span,{className:\"token punctuation\",children:\"(\"}),(0,n.jsx)(e.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,n.jsx)(e.p,{children:\"So now I have a script that pulls the latest event and dimension data, builds it into a presentable file, and a script that automatically pushes that new file to Github to host it on a Github page. The last step is making it run every day.\"}),(0,n.jsxs)(e.p,{children:[\"I will do this as a \",(0,n.jsx)(e.a,{href:\"https://www.youtube.com/watch?v=v952m13p-b4\",children:\"cron job\"}),\" on a virtual linux machine from Linode. You could also do this as an AWS Lambda and trigger it daily with AWS EventBridge, but \",(0,n.jsx)(e.a,{href:\"https://docs.aws.amazon.com/lambda/latest/dg/python-package.html\",children:\"deploying Python environments with dependencies to AWS Lambda is kind of a pain\"}),\". Here are the steps:\"]}),(0,n.jsxs)(e.ul,{children:[(0,n.jsx)(e.li,{children:\"Create a virtual machine in Linode and install Git, Python, Virtualenv, etc\"}),(0,n.jsx)(e.li,{children:\"Clone my repo onto the virtual machine and navigate to the directory\"}),(0,n.jsx)(e.li,{children:\"Transfer my environment variables (API keys) to the virtual machine either by entering them directly or using a .env file\"}),(0,n.jsx)(e.li,{children:\"Create a virtualenv and install the dependencies from requirements.txt\"}),(0,n.jsx)(e.li,{children:\"Run app.py once to confirm it works\"}),(0,n.jsx)(e.li,{children:\"Run gh.py once to ensure it works\"}),(0,n.jsx)(e.li,{children:\"Navigate to my VM\\u2019s crontab file and add the following line to the end:\"})]}),(0,n.jsx)(e.pre,{className:\"language-bash\",children:(0,n.jsxs)(e.code,{className:\"code-highlight language-bash\",children:[(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# etc\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# etc\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token comment\",children:\"# m h dom mon dow\"}),`\n`]}),(0,n.jsxs)(e.span,{className:\"code-line\",children:[(0,n.jsx)(e.span,{className:\"token number\",children:\"0\"}),\" \",(0,n.jsx)(e.span,{className:\"token number\",children:\"8\"}),\" * * * \",(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\"cd\"}),\" /adobevargrid \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&&\"}),\" \",(0,n.jsx)(e.span,{className:\"token builtin class-name\",children:\".\"}),\" venv/bin/activate \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&&\"}),\" python app.py \",(0,n.jsx)(e.span,{className:\"token operator\",children:\"&&\"}),` python gh.py\n`]})]})}),(0,n.jsx)(e.p,{children:\"Now every day at 8am my virtual machine will pull the latest metrics and events definitions directly from Adobe, build a new markdown page out of them, and automatically push that change to Github. When Github receives this change, it will transform that markdown into a viewable page via Github Pages.\"}),(0,n.jsx)(e.p,{children:\"See the an example of the final output here:\"}),(0,n.jsx)(e.p,{children:(0,n.jsx)(e.a,{href:\"https://johndavidsimmons.github.io/adobevargrid/adobevargrid\",children:\"https://johndavidsimmons.github.io/adobevargrid/adobevargrid\"})})]})}}var w=f;return b(v);})();\n;return Component;"
    },
    "_id": "blog/building-an-adobe-analytics-metrics-and-dimensions-definitions-page-with-the-adobe-analytics-api.mdx",
    "_raw": {
      "sourceFilePath": "blog/building-an-adobe-analytics-metrics-and-dimensions-definitions-page-with-the-adobe-analytics-api.mdx",
      "sourceFileName": "building-an-adobe-analytics-metrics-and-dimensions-definitions-page-with-the-adobe-analytics-api.mdx",
      "sourceFileDir": "blog",
      "contentType": "mdx",
      "flattenedPath": "blog/building-an-adobe-analytics-metrics-and-dimensions-definitions-page-with-the-adobe-analytics-api"
    },
    "type": "Blog",
    "readingTime": {
      "text": "11 min read",
      "minutes": 10.78,
      "time": 646800,
      "words": 2156
    },
    "slug": "building-an-adobe-analytics-metrics-and-dimensions-definitions-page-with-the-adobe-analytics-api",
    "toc": [
      {
        "value": "Preamble",
        "url": "#preamble",
        "depth": 2
      },
      {
        "value": "The beginning of the end…",
        "url": "#the-beginning-of-the-end",
        "depth": 2
      },
      {
        "value": "Authenticating",
        "url": "#authenticating",
        "depth": 2
      },
      {
        "value": "Gathering Data",
        "url": "#gathering-data",
        "depth": 2
      },
      {
        "value": "Building Markdown",
        "url": "#building-markdown",
        "depth": 2
      },
      {
        "value": "Style & Search",
        "url": "#style--search",
        "depth": 2
      },
      {
        "value": "Saving the string as a file",
        "url": "#saving-the-string-as-a-file",
        "depth": 2
      },
      {
        "value": "Automation",
        "url": "#automation",
        "depth": 2
      }
    ]
  },
  {
    "title": "Automatically adding query parameters to Amplitude Events with Adobe Launch & Amplitude plugins",
    "date": "2023-03-22T00:00:00.000Z",
    "tags": [
      "adobe launch",
      "amplitude",
      "query parameters"
    ],
    "draft": false,
    "summary": "How to use Amplitude plugin functions to automatically collect data",
    "body": {
      "raw": "\n## Praise for the Amplitude Launch Extension\n\nI’ve been working on a few Amplitude deployments via Launch (aka data collection tags) lately and I am a huge fan of the \nAmplitude V2 extension. It does everything the [Amplitude Browser SDK](https://www.docs.developers.amplitude.com/data/sdks/typescript-browser/)does and the documentation links in it are all correct. \nThere are even code samples within the custom code sections! This fact alone saved me a ton of time when setting up my \ndeployment and writing the following plugin.\n\n\n![amplitude extension](https://images.ctfassets.net/on47yk52ubpi/81zB2SvWTPFJQkpbAHz1l/791c5af64382aafcd0a7f27945817c25/1_Qf2Lt8erW8Dm8GwaBzUC8Q.webp)\n<figure>\n<figcaption>Props (No Adobe pun intended) to whoever made this. My only request is being able to have different API keys based on Launch environment similar to the Acronym Gtag extension.</figcaption>\n</figure>\n\nTracking an event with the Amplitude extension is pretty straight-forward. After selecting you conditions & criteria in a rule, \nyou can add the *Track Event* action to send *events* and *event properties* to Amplitude.\n\n\n![amplitude track event](https://images.ctfassets.net/on47yk52ubpi/KydH5D4n8eEVJrR4F2Poy/41d8964c45fb202a043b9522f8dae86b/1_oSrSiMky9Cfaasuj3QK2Fw.webp)\n<figure>\n<figcaption>Tracking a fake event and sending along some UTM data</figcaption>\n</figure>\n\nAs you can see above, with any event you can manually add properties you want to send along with it. \nThat’s all fine and good, but I know I’m going to need to send any and all UTMs with every Amplitude event. \nEnter [Amplitude Plugins.](https://www.docs.developers.amplitude.com/data/sdks/typescript-browser/#plugins)\n\n*Note: I know Amplitude grabs UTMs automatically for attribution. However, I like seeing them on my events also. \nYou could also use the same plugin code I use here to automatically grab any param(s) you need and have them \nautomatically added every event.*\n\n## Writing and Adding Amplitude Plugins in Launch\n\nFor the time being, I am putting my Amplitude Plugins in the same rule where I *Initialize* Amplitude. \nI like the idea of having all the setup type stuff in the same rule. \nAlso, I don’t know specifically plugins should go. Either way, this seems to work 😁\n\n![launch rule amplitude](https://images.ctfassets.net/on47yk52ubpi/1XputFNi1DghlLnmkF64hB/9c343e5838db273e3e4a761edfc843a1/1_LDgRWveBjthMrfIv0R2txg.webp)\n<figure>\n<figcaption>I add the plugin prior to initialization to ensure it is added to all events</figcaption>\n</figure>\n\nInside the Add Plugin Action, click *Plugin Code*, and you’ll be treated to a nice commented out code \nexample and link to documentation. Very helpful!\n\n![amplitude launch add plugin](https://images.ctfassets.net/on47yk52ubpi/5dLSG39hxI0hI6ABaMSjIf/d602610e5aaf36c91ad672a73eec3fd1/1_nGRFbv3U1bMNfw39MpStWg.webp)\n<figure>\n<figcaption>The little indicator lights turn green when there is code in there!</figcaption>\n</figure>\n\n![amplitude sample code](https://images.ctfassets.net/on47yk52ubpi/1mTwlsW3DBb9jh3LR0p6ZJ/4f8561a674b379e55d18274f85fb6e4a/1__bzmJJNp-ijddojxpuh_NA.webp)\n<figure>\n<figcaption>Example plugin code gives you an idea of how things work!</figcaption>\n</figure>\n\n![amplitude plugin code launch](https://images.ctfassets.net/on47yk52ubpi/1utwVdiVrILYCDZnv6M2LY/70c6a7726a99c6169eacce31a0a80fdb/1_ret6ePCS2265jrbaCBpG0w.webp)\n<figure>\n<figcaption>My plugin for automatically collecting UTM parameters</figcaption>\n</figure>\n\nHere is what’s going on line by line\n\n2. give the plugin a name :)\n\n3. Specify the type of plugin it is. This one is an enrichment plugin.\n\n4. The setup function takes the Amplitude config, but since I don’t need to manipulate that I’m just doing a debug log and returning.\n\n8. The execute function takes the Amplitude event as a parameter. It will look at every event that passes through Amplitude. If I needed to limit this plugin to only effect certain kinds of events (i.e. only pageviews and not logins, etc.) I could do that inside the function on the next line.\n\n9. Grab all the query parameters of the current URL\n\n10. Of the existing query parameters, filter out the non-UTM ones, and create and object of the ones that contain utm in their key\n\n```javascript\n// www.example.com?utm_content=ABC&foo=bar&utm_campaign=XYZ\n\nconst params = new URLSearchParams(window.location.search)\n// Array.from(params) = [[\"utm_content\", \"abc\"], [\"foo\", \"bar\"], [\"utm_campaign\", \"XYZ\"]]\n\n// remove non utms and create object\nconst utms = Object.fromEntries(Array.from(params).filter( ([key]) => key.includes(\"utm\")))\n// utms = { utm_content: \"ABC\", utm_campaign: \"XYZ\" }\n```\n\n11. Combines any existing properties the event has with the UTM ones. If I didn’t do this, and just assigned the utm object as the event properties, it would overwrite everything that was already in there and I don’t want that. I do get a warning from Launch here for using the spread operator. I don’t know how much of an issue that will be, but its something I will keep my eye on.\n\n12. Return the event\n\n![amplitude console logs](https://images.ctfassets.net/on47yk52ubpi/23brJur5BvMkD4ZOR4cc9x/2c7add549970fffee760c58ff6941424/1_cqiyjuy91GeG6oEsA5AwJg.webp)\n<figure>\n<figcaption>Logs from adding the plugin</figcaption>\n</figure>\n\n## In Action\n\nYou can see what Amplitude is doing using the [Amplitude Event Explorer Chrome Extension](https://chrome.google.com/webstore/detail/amplitude-event-explorer/acehfjhnmhbmgkedjmjlobpgdicnhkbp) (Firefox version please!)\n\nIn this case you can see when I track *myfakevent* event, the utm parameters are added, \nbut the foo parameter is not! The other data from *myfakeevent* is also being passed because \nI am merging the existing event data with the utm data in the plugin code.\n\n![amplitude debugger](https://images.ctfassets.net/on47yk52ubpi/4woz742PpUgz5tQ1ID8Lfj/6145dffada563300d14d3a7fbe778616/1_fELTrwJP_OD6XTyMLoRjew.webp)\n<figure>\n<figcaption>The JS console represents what the track event Launch action does.</figcaption>\n</figure>\n\nI am loving the plugin functionality so far and look forward to using it to make my life easier. \nAlso, based on some of the _satellite logs that the extension spits out, I suspect the Launch extension itself \nis heavily integrated with Amplitude plugins. \nIf anyone from Amplitude reads this, can you confirm or deny?",
      "code": "var Component=(()=>{var d=Object.create;var c=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var g=(t,a)=>()=>(a||t((a={exports:{}}).exports,a),a.exports),f=(t,a)=>{for(var i in a)c(t,i,{get:a[i],enumerable:!0})},l=(t,a,i,n)=>{if(a&&typeof a==\"object\"||typeof a==\"function\")for(let s of p(a))!u.call(t,s)&&s!==i&&c(t,s,{get:()=>a[s],enumerable:!(n=h(a,s))||n.enumerable});return t};var k=(t,a,i)=>(i=t!=null?d(m(t)):{},l(a||!t||!t.__esModule?c(i,\"default\",{value:t,enumerable:!0}):i,t)),y=t=>l(c({},\"__esModule\",{value:!0}),t);var r=g((I,o)=>{o.exports=_jsx_runtime});var v={};f(v,{default:()=>N,frontmatter:()=>w});var e=k(r()),w={title:\"Automatically adding query parameters to Amplitude Events with Adobe Launch & Amplitude plugins\",date:\"2023-03-22\",tags:[\"adobe launch\",\"amplitude\",\"query parameters\"],draft:!1,summary:\"How to use Amplitude plugin functions to automatically collect data\"};function b(t={}){let{wrapper:a}=t.components||{};return a?(0,e.jsx)(a,Object.assign({},t,{children:(0,e.jsx)(i,{})})):i();function i(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",img:\"img\",em:\"em\",ol:\"ol\",li:\"li\",pre:\"pre\",code:\"code\"},t.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"praise-for-the-amplitude-launch-extension\",children:[(0,e.jsx)(n.a,{href:\"#praise-for-the-amplitude-launch-extension\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Praise for the Amplitude Launch Extension\"]}),(0,e.jsxs)(n.p,{children:[\"I\\u2019ve been working on a few Amplitude deployments via Launch (aka data collection tags) lately and I am a huge fan of the Amplitude V2 extension. It does everything the \",(0,e.jsx)(n.a,{href:\"https://www.docs.developers.amplitude.com/data/sdks/typescript-browser/\",children:\"Amplitude Browser SDK\"}),\"does and the documentation links in it are all correct. There are even code samples within the custom code sections! This fact alone saved me a ton of time when setting up my deployment and writing the following plugin.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"amplitude extension\",src:\"https://images.ctfassets.net/on47yk52ubpi/81zB2SvWTPFJQkpbAHz1l/791c5af64382aafcd0a7f27945817c25/1_Qf2Lt8erW8Dm8GwaBzUC8Q.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Props (No Adobe pun intended) to whoever made this. My only request is being able to have different API keys based on Launch environment similar to the Acronym Gtag extension.\"})}),(0,e.jsxs)(n.p,{children:[\"Tracking an event with the Amplitude extension is pretty straight-forward. After selecting you conditions & criteria in a rule, you can add the \",(0,e.jsx)(n.em,{children:\"Track Event\"}),\" action to send \",(0,e.jsx)(n.em,{children:\"events\"}),\" and \",(0,e.jsx)(n.em,{children:\"event properties\"}),\" to Amplitude.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"amplitude track event\",src:\"https://images.ctfassets.net/on47yk52ubpi/KydH5D4n8eEVJrR4F2Poy/41d8964c45fb202a043b9522f8dae86b/1_oSrSiMky9Cfaasuj3QK2Fw.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Tracking a fake event and sending along some UTM data\"})}),(0,e.jsxs)(n.p,{children:[\"As you can see above, with any event you can manually add properties you want to send along with it. That\\u2019s all fine and good, but I know I\\u2019m going to need to send any and all UTMs with every Amplitude event. Enter \",(0,e.jsx)(n.a,{href:\"https://www.docs.developers.amplitude.com/data/sdks/typescript-browser/#plugins\",children:\"Amplitude Plugins.\"})]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:\"Note: I know Amplitude grabs UTMs automatically for attribution. However, I like seeing them on my events also. You could also use the same plugin code I use here to automatically grab any param(s) you need and have them automatically added every event.\"})}),(0,e.jsxs)(n.h2,{id:\"writing-and-adding-amplitude-plugins-in-launch\",children:[(0,e.jsx)(n.a,{href:\"#writing-and-adding-amplitude-plugins-in-launch\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Writing and Adding Amplitude Plugins in Launch\"]}),(0,e.jsxs)(n.p,{children:[\"For the time being, I am putting my Amplitude Plugins in the same rule where I \",(0,e.jsx)(n.em,{children:\"Initialize\"}),\" Amplitude. I like the idea of having all the setup type stuff in the same rule. Also, I don\\u2019t know specifically plugins should go. Either way, this seems to work \\u{1F601}\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"launch rule amplitude\",src:\"https://images.ctfassets.net/on47yk52ubpi/1XputFNi1DghlLnmkF64hB/9c343e5838db273e3e4a761edfc843a1/1_LDgRWveBjthMrfIv0R2txg.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"I add the plugin prior to initialization to ensure it is added to all events\"})}),(0,e.jsxs)(n.p,{children:[\"Inside the Add Plugin Action, click \",(0,e.jsx)(n.em,{children:\"Plugin Code\"}),\", and you\\u2019ll be treated to a nice commented out code example and link to documentation. Very helpful!\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"amplitude launch add plugin\",src:\"https://images.ctfassets.net/on47yk52ubpi/5dLSG39hxI0hI6ABaMSjIf/d602610e5aaf36c91ad672a73eec3fd1/1_nGRFbv3U1bMNfw39MpStWg.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"The little indicator lights turn green when there is code in there!\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"amplitude sample code\",src:\"https://images.ctfassets.net/on47yk52ubpi/1mTwlsW3DBb9jh3LR0p6ZJ/4f8561a674b379e55d18274f85fb6e4a/1__bzmJJNp-ijddojxpuh_NA.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Example plugin code gives you an idea of how things work!\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"amplitude plugin code launch\",src:\"https://images.ctfassets.net/on47yk52ubpi/1utwVdiVrILYCDZnv6M2LY/70c6a7726a99c6169eacce31a0a80fdb/1_ret6ePCS2265jrbaCBpG0w.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"My plugin for automatically collecting UTM parameters\"})}),(0,e.jsx)(n.p,{children:\"Here is what\\u2019s going on line by line\"}),(0,e.jsxs)(n.ol,{start:\"2\",children:[(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"give the plugin a name :)\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"Specify the type of plugin it is. This one is an enrichment plugin.\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"The setup function takes the Amplitude config, but since I don\\u2019t need to manipulate that I\\u2019m just doing a debug log and returning.\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"The execute function takes the Amplitude event as a parameter. It will look at every event that passes through Amplitude. If I needed to limit this plugin to only effect certain kinds of events (i.e. only pageviews and not logins, etc.) I could do that inside the function on the next line.\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"Grab all the query parameters of the current URL\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"Of the existing query parameters, filter out the non-UTM ones, and create and object of the ones that contain utm in their key\"})})]}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// www.example.com?utm_content=ABC&foo=bar&utm_campaign=XYZ\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" params \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"URLSearchParams\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"window\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"location\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"search\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:'// Array.from(params) = [[\"utm_content\", \"abc\"], [\"foo\", \"bar\"], [\"utm_campaign\", \"XYZ\"]]'}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// remove non utms and create object\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" utms \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name known-class-name\",children:\"Object\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"fromEntries\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name known-class-name\",children:\"Array\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token keyword module\",children:\"from\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"params\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"filter\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token parameter\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator arrow\",children:\"=>\"}),\" key\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"includes\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"utm\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:'// utms = { utm_content: \"ABC\", utm_campaign: \"XYZ\" }'}),`\n`]})]})}),(0,e.jsxs)(n.ol,{start:\"11\",children:[(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"Combines any existing properties the event has with the UTM ones. If I didn\\u2019t do this, and just assigned the utm object as the event properties, it would overwrite everything that was already in there and I don\\u2019t want that. I do get a warning from Launch here for using the spread operator. I don\\u2019t know how much of an issue that will be, but its something I will keep my eye on.\"})}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.p,{children:\"Return the event\"})})]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"amplitude console logs\",src:\"https://images.ctfassets.net/on47yk52ubpi/23brJur5BvMkD4ZOR4cc9x/2c7add549970fffee760c58ff6941424/1_cqiyjuy91GeG6oEsA5AwJg.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Logs from adding the plugin\"})}),(0,e.jsxs)(n.h2,{id:\"in-action\",children:[(0,e.jsx)(n.a,{href:\"#in-action\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"In Action\"]}),(0,e.jsxs)(n.p,{children:[\"You can see what Amplitude is doing using the \",(0,e.jsx)(n.a,{href:\"https://chrome.google.com/webstore/detail/amplitude-event-explorer/acehfjhnmhbmgkedjmjlobpgdicnhkbp\",children:\"Amplitude Event Explorer Chrome Extension\"}),\" (Firefox version please!)\"]}),(0,e.jsxs)(n.p,{children:[\"In this case you can see when I track \",(0,e.jsx)(n.em,{children:\"myfakevent\"}),\" event, the utm parameters are added, but the foo parameter is not! The other data from \",(0,e.jsx)(n.em,{children:\"myfakeevent\"}),\" is also being passed because I am merging the existing event data with the utm data in the plugin code.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"amplitude debugger\",src:\"https://images.ctfassets.net/on47yk52ubpi/4woz742PpUgz5tQ1ID8Lfj/6145dffada563300d14d3a7fbe778616/1_fELTrwJP_OD6XTyMLoRjew.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"The JS console represents what the track event Launch action does.\"})}),(0,e.jsx)(n.p,{children:\"I am loving the plugin functionality so far and look forward to using it to make my life easier. Also, based on some of the _satellite logs that the extension spits out, I suspect the Launch extension itself is heavily integrated with Amplitude plugins. If anyone from Amplitude reads this, can you confirm or deny?\"})]})}}var N=b;return y(v);})();\n;return Component;"
    },
    "_id": "blog/collecting-query-parameters-with-amplitude-in-adobe-launch.mdx",
    "_raw": {
      "sourceFilePath": "blog/collecting-query-parameters-with-amplitude-in-adobe-launch.mdx",
      "sourceFileName": "collecting-query-parameters-with-amplitude-in-adobe-launch.mdx",
      "sourceFileDir": "blog",
      "contentType": "mdx",
      "flattenedPath": "blog/collecting-query-parameters-with-amplitude-in-adobe-launch"
    },
    "type": "Blog",
    "readingTime": {
      "text": "5 min read",
      "minutes": 4.015,
      "time": 240900,
      "words": 803
    },
    "slug": "collecting-query-parameters-with-amplitude-in-adobe-launch",
    "toc": [
      {
        "value": "Praise for the Amplitude Launch Extension",
        "url": "#praise-for-the-amplitude-launch-extension",
        "depth": 2
      },
      {
        "value": "Writing and Adding Amplitude Plugins in Launch",
        "url": "#writing-and-adding-amplitude-plugins-in-launch",
        "depth": 2
      },
      {
        "value": "In Action",
        "url": "#in-action",
        "depth": 2
      }
    ]
  },
  {
    "title": "Programmatically interacting with an Adobe Target Activity based on the movement of Mercury",
    "date": "2022-12-01T00:00:00.000Z",
    "tags": [
      "adobe target",
      "automation",
      "api",
      "testing"
    ],
    "draft": false,
    "summary": "How to enable/disable a Target test based on an API",
    "body": {
      "raw": "\n## 17th Century Marketing\n\n![mercury](https://images.ctfassets.net/on47yk52ubpi/2qps9JbE6GR1Qbe3zSM3nD/6e51e1d7536978880a215babe59a1267/0_JZ1V0NtFXgCHaWc0.jpg)\n\n<figure>\n  <figcaption>That cursed planet</figcaption>\n</figure>\n\nI want offer special sales on products in my webstore _only_ when [Mercury is in retrograde](https://www.almanac.com/content/mercury-retrograde-dates).\nThis happens just a few times a year for about a week at a time.\nIt is known to cause online shoppers to be especially susceptible to hot deals, amongst other planetary based maladies…\n\n![wizard](https://images.ctfassets.net/on47yk52ubpi/4URGdrgbwcAec4txke1uCo/d65554985491d7d83a1389b2fb53fb57/1_T5t52u_lvDX5VIhrV6a6NA.webp)\n\n<figure>\n  <figcaption>Online shopper purchasing shoes while Mercury is in retrograde</figcaption>\n</figure>\n\nSince I use Adobe Target to display my sales banners, I will just need look through my telescope each\nnight and see if Mercury is in retrograde. If it is, I will go into Target, build my sale content,\nand activate the Activity. I will also need to turn off the Activity when Mercury is _no longer_ in retrograde.\nEither way, I am going outside every night.\n\nSince I don’t even know what Mercury looks like nor do I own a telescope,\nI think I should automate this process. How can I _activate_ my Activity automatically when\nMercury is in retrograde and _deactivate_ it automatically when Mercury is _no longer_ in retrograde?\n\n![my awsome webstore](https://images.ctfassets.net/on47yk52ubpi/1t5axaJdkAJeuzVvVsO8Wm/9f978215d64de0aebf22145fe9f5d288/1_644XDvp_STJQuaJD2TDT5A.webp)\n\n<figure>\n  <figcaption>My awesome webstore</figcaption>\n</figure>\n\nLet’s start by building an XT Activity in Target with a banner displaying some eye catching content:\n\n![target activity](https://images.ctfassets.net/on47yk52ubpi/3e6rhpnxg0baJCY0dTxv8F/0f88d7fdae7f57ae683a40a6028ea0fb/1_fAcwnBx3McWHXNjz0vkQeA.webp)\n\n<figure>\n  <figcaption>An enticing red banner will surely boost my sales.</figcaption>\n</figure>\n\n![live activity](https://images.ctfassets.net/on47yk52ubpi/2OcmfOQryTRfEuzwIdmwJ4/2a4e36829bdfb1369cd93116851f8b9b/1_RDfjqGVRR6cQkH16WMsyIw.webp)\n\n<figure>\n  <figcaption>The sale banner is active, but I don’t know the status of Mercury!</figcaption>\n</figure>\n\n![banner on site](https://images.ctfassets.net/on47yk52ubpi/6X5HhE5go0QBy5LQLduXSd/69da4f88b514c09b2cd3f135420ac155/1_aiX8JyTA5y8P79-aYnEYvQ.webp)\n\n<figure>\n  <figcaption>\n    When people visit myawesomewebstore.com during while Mercury is in retrograde they will be\n    presented with this amazing banner\n  </figcaption>\n</figure>\n\n---\n\nBecause it is 2022 (aka the future) there is API\nfor tracking the movement of Mercury. I can automate turning this activity on and off using this API:\n\n`https://mercuryretrogradeapi.com/`\n\n![merciry api](https://images.ctfassets.net/on47yk52ubpi/2bobDMHJTCRWSYgNKZ1Qvf/bca2791232301130221f80b60d5904a0/1_C4rBV4w9FnEommSJb5_cow.webp)\n\n<figure>\n  <figcaption>The future is crazy</figcaption>\n</figure>\n\n---\n\nBefore writing any automation code, the first thing to do is hop over to the Adobe Developer Console\nand start a new project that has access to the Target API. If you have never done that before I won’t bore\nyou with it here. Information how to setup API projects is here: https://developer.adobe.com/developer-console/\n\nOnce I have my API keys I can now interact with Target via its API.\nNormally, I would do this in Python, but Adobe has some excellent Node JS\nlibraries that unfortunately you have to dig to find. Seriously, look around on NPM. Here is what I will be using:\n\n- [Target AIO Node JS library](https://www.npmjs.com/package/@adobe/aio-lib-target) - _interact with Target activities_\n- [Adobe Authentication library](https://www.npmjs.com/package/@adobe/jwt-auth) - _Authenticate with Adobe to make API calls_\n- [Axios](https://www.npmjs.com/package/axios) - _Call the Retrograde API_\n- [dotenv](https://www.npmjs.com/package/dotenv) - _read a .env file with environment variables (API creds)_\n\n```javascript\nconst auth = require('@adobe/jwt-auth')\nconst axios = require('axios')\nconst dotenv = require('dotenv')\nconst targetSDK = require('@adobe/aio-lib-target')\n\n// get my env variables\ndotenv.config()\n\n// Adobe API Config vars\nconst config = {\n  clientId: process.env.clientId,\n  clientSecret: process.env.clientSecret,\n  technicalAccountId: process.env.technicalAccountId,\n  orgId: process.env.orgId,\n  metaScopes: ['ent_marketing_sdk'],\n  privateKey: process.env.privateKey.replace(/\\\\n/g, '\\n'), // make the PK readable as a string\n}\n```\n\n_Note: I am storing my private key in an environment variable here so I don’t have to read it from a file_\n\nIn my code I need a function to tell me if Mercury is or is not in retrograde by calling the Mercury API.\nI will use this function to control whether the activity should be activated or deactivated.\n\n```javascript\n// returns boolean\nconst isRetrograde = async () => {\n  const response = await axios.get(`https://mercuryretrogradeapi.com/`)\n  return response.data.is_retrograde\n}\n```\n\nNow all I need is the method from the Target SDK for updating Activity States.\nNote that I have removed my actual activity in the example code, but you can find that ID on the Activity Overview page:\n\n![activity overview](https://images.ctfassets.net/on47yk52ubpi/4pT3bmiRqrRenAQMQh8GH5/63dc022246db633855d2ae2fb3ad04a3/1_AubM8SaszQPWLk6Pe_3Mgg.webp)\n\n```javascript\nasync function updateActivity() {\n  let activateTest = await isRetrograde()\n  let { access_token } = await auth(config)\n  const targetClient = await targetSDK.init(\n    process.env.companyID,\n    process.env.clientId,\n    access_token\n  )\n\n  const options = {\n    headers: {\n      'content-type': 'application/vnd.adobe.target.v1+json',\n      Accept: 'application/vnd.adobe.target.v1+json',\n    },\n  }\n  // - approved : corresponds to Live in Target UI.\n  // - deactivated : corresponds to Inactive in Target UI.\n  // - saved : corresponds to Inactive in Target UI.\n  const updateActivityState = await targetClient.setActivityState(\n    123456,\n    activateTest ? 'approved' : 'saved',\n    options\n  )\n\n  //   //get offer by id activity\n  const activity = await targetClient.getABActivityById(123456)\n  console.log(activity)\n  return\n}\n\n// call to change activity state\nupdateActivity()\n```\n\nHere is the whole file I’ll call _mercury.js_\n\n```javascript\nconst auth = require('@adobe/jwt-auth')\nconst axios = require('axios')\nconst dotenv = require('dotenv')\nconst targetSDK = require('@adobe/aio-lib-target')\n\n// get my env variables\ndotenv.config()\n\n// Adobe API Config vars\nconst config = {\n  clientId: process.env.clientId,\n  clientSecret: process.env.clientSecret,\n  technicalAccountId: process.env.technicalAccountId,\n  orgId: process.env.orgId,\n  metaScopes: ['ent_marketing_sdk'],\n  privateKey: process.env.privateKey.replace(/\\\\n/g, '\\n'), // make the PK readable as a string\n}\n\n// returns boolean\nconst isRetrograde = async () => {\n  const response = await axios.get(`https://mercuryretrogradeapi.com/`)\n  const { is_retrograde } = response.data\n  return is_retrograde\n}\n\nasync function updateActivity() {\n  let activateTest = await isRetrograde()\n  let { access_token } = await auth(config)\n  const targetClient = await targetSDK.init(\n    process.env.companyID,\n    process.env.clientId,\n    access_token\n  )\n\n  const options = {\n    headers: {\n      'content-type': 'application/vnd.adobe.target.v1+json',\n      Accept: 'application/vnd.adobe.target.v1+json',\n    },\n  }\n  // - approved : corresponds to Live in Target UI.\n  // - deactivated : corresponds to Inactive in Target UI.\n  // - saved : corresponds to Inactive in Target UI.\n  const updateActivityState = await targetClient.setActivityState(\n    12345,\n    activateTest ? 'approved' : 'saved',\n    options\n  )\n\n  //   //get offer by id activity\n  const activity = await targetClient.getABActivityById(12345)\n  console.log(activity)\n  return\n}\n\nupdateActivity()\n```\n\nA few things to note in the code above:\n\nFirst, the _setActivityState_ method in the SDK needs some special media-type headers specified in the options.\nThe SDK doesn’t have this built into the methods nor does it specify anything in the method definitions, but it is required.\nIf you get [415 errors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/415#:~:text=The%20HTTP%20415%20Unsupported%20Media,of%20inspecting%20the%20data%20directly.)\nwith any methods, double check the headers from this document: https://developers.adobetarget.com/api/\n\nThe second parameter in _setActivityState_ is a ternary operator based on what the Retrograde API gives back.\nIf Mercury is in retrograde (true from the API) the activity will be set to _approved_. If retrograde is false, the activity will be _deactivated_.\nThese statuses are kind of vague, and don’t reflect the terminology in the Target UI which is annoying. The definitions in the comments are taken directly from the docs.\nI am not sure what the difference between _saved_ and _deactivated_ is exactly. Anyway, you get the point. Let’s get to the fun part…\n\n---\n\n## Automation\n\nThere’s a couple options here to automate this. You could use an AWS Lambda,\nbut then you have to learn about deploying a node project in lambda and how to schedule cron jobs through AWS Event Bridge.\nThese tasks are actually trickier than they sound if you’ve never done it before. Rather than give Amazon more money,\ninstead, I’ll give Akamai some money and use a Linode virtual machine.Then I can use it to run lots of different cron jobs.\nIf you have never used Linode before, check out their [Youtube channel](https://www.youtube.com/@linode).\nI can either spin up a new virtual machine preloaded with NodeJS or spin up a blank one and install Node manually. I will choose the former.\n\nAfter creating my virtual machine and verifying [I can connect to it via SSH](https://www.linode.com/docs/guides/networking/ssh/),\nI transfer my _mercury.js_ file and _package.json_ file [via SCP](https://www.ssh.com/academy/ssh/scp#basic-usage).\nRegarding environment variables, I can transfer my .env also, or set them directly on the virtual machine.\nYour choice. Once the files are transferred, I can navigate to their directory and run _npm i_ to install all packages I will need.\nI’ll also run _mercury.js_ a couple times to make sure everything works:\n\n```bash\n# transfer files via scp from source machine to VM\n# scp <source> <username@destination>\nscp mercury.js root@192.168.0.1:/home/mercury/mercury.js\n\n# scp other files...\n\n#SSH into my virtual machine. (Not the real IP address :) )\nssh root@192.168.0.1\n\n# move to mercury directory and install node libraries\ncd mercury && npm i\n\n# run the file to make sure it works!\nnode mercury.js\n```\n\nOnce I have verified that everything works I can now instruct my virtual machine to run this as often as I want.\nI think daily will suffice as Mercury doesn’t move that fast. To do this I just need to edit my virtual machine’s\ncrontab file. Cron jobs are a way to tell a Linux computer to execute a specific task at a specific time.\n[Please see this excellent video from Linode about writing cron jobs.](https://youtu.be/v952m13p-b4)\n\nIn the end, my _crontab_ file will have this at the bottom:\n\n```bash\n# etc\n# etc\n# m h dom mon dow\n0 8 * * * cd /somepath/mercury && node mercury.js\n```\n\nBasically this says “_every day at 8am, run mercury.js_”. Every day, this command will run and mercury.js will\nactivate/deactivate my activity based on what the mercury API says. Once I save my _crontab_ file,\nI have effectively created an Adobe Target Activity that is conditionally active based on the movement of a planet! The future is crazy.\n\n![active test](https://images.ctfassets.net/on47yk52ubpi/3o4BxcVYr5MAkyxCZKnVyO/3b24d1e0ba2a2c5710a255f65bbaa22b/1_DvRL0HerPI6zK1fxgHp0Tw.webp)\n\n_A quick note: the target UI doesn’t always update immediately to reflect API changes, but you can verify that the activity is activated via the Changelog section. The UI changes will show up after a few minutes._\n\nNow this example is _trivial_, some might even call it stupid (_how dare you!_), but the set up is real.\nWhat if you run all types of date specific Target activities? Black Friday, Cyber Monday, Super Bowl,\nPresident’s Day, Flag Day, John’s birthday, and so on. I could have all sorts of Target Activities that\nprogrammatically turn on and off based on the date. With some initial setup, I could plan out a whole year of sales banners in a few hours!\n",
      "code": "var Component=(()=>{var d=Object.create;var l=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{for(var c in s)l(a,c,{get:s[c],enumerable:!0})},i=(a,s,c,n)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let t of h(s))!u.call(a,t)&&t!==c&&l(a,t,{get:()=>s[t],enumerable:!(n=p(s,t))||n.enumerable});return a};var y=(a,s,c)=>(c=a!=null?d(m(a)):{},i(s||!a||!a.__esModule?l(c,\"default\",{value:a,enumerable:!0}):c,a)),g=a=>i(l({},\"__esModule\",{value:!0}),a);var r=N((A,o)=>{o.exports=_jsx_runtime});var b={};k(b,{default:()=>w,frontmatter:()=>f});var e=y(r()),f={title:\"Programmatically interacting with an Adobe Target Activity based on the movement of Mercury\",date:\"2022-12-01\",tags:[\"adobe target\",\"automation\",\"api\",\"testing\"],draft:!1,summary:\"How to enable/disable a Target test based on an API\"};function v(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",img:\"img\",em:\"em\",hr:\"hr\",code:\"code\",ul:\"ul\",li:\"li\",pre:\"pre\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"17th-century-marketing\",children:[(0,e.jsx)(n.a,{href:\"#17th-century-marketing\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"17th Century Marketing\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"mercury\",src:\"https://images.ctfassets.net/on47yk52ubpi/2qps9JbE6GR1Qbe3zSM3nD/6e51e1d7536978880a215babe59a1267/0_JZ1V0NtFXgCHaWc0.jpg\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"That cursed planet\"})}),(0,e.jsxs)(n.p,{children:[\"I want offer special sales on products in my webstore \",(0,e.jsx)(n.em,{children:\"only\"}),\" when \",(0,e.jsx)(n.a,{href:\"https://www.almanac.com/content/mercury-retrograde-dates\",children:\"Mercury is in retrograde\"}),\". This happens just a few times a year for about a week at a time. It is known to cause online shoppers to be especially susceptible to hot deals, amongst other planetary based maladies\\u2026\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"wizard\",src:\"https://images.ctfassets.net/on47yk52ubpi/4URGdrgbwcAec4txke1uCo/d65554985491d7d83a1389b2fb53fb57/1_T5t52u_lvDX5VIhrV6a6NA.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Online shopper purchasing shoes while Mercury is in retrograde\"})}),(0,e.jsxs)(n.p,{children:[\"Since I use Adobe Target to display my sales banners, I will just need look through my telescope each night and see if Mercury is in retrograde. If it is, I will go into Target, build my sale content, and activate the Activity. I will also need to turn off the Activity when Mercury is \",(0,e.jsx)(n.em,{children:\"no longer\"}),\" in retrograde. Either way, I am going outside every night.\"]}),(0,e.jsxs)(n.p,{children:[\"Since I don\\u2019t even know what Mercury looks like nor do I own a telescope, I think I should automate this process. How can I \",(0,e.jsx)(n.em,{children:\"activate\"}),\" my Activity automatically when Mercury is in retrograde and \",(0,e.jsx)(n.em,{children:\"deactivate\"}),\" it automatically when Mercury is \",(0,e.jsx)(n.em,{children:\"no longer\"}),\" in retrograde?\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"my awsome webstore\",src:\"https://images.ctfassets.net/on47yk52ubpi/1t5axaJdkAJeuzVvVsO8Wm/9f978215d64de0aebf22145fe9f5d288/1_644XDvp_STJQuaJD2TDT5A.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"My awesome webstore\"})}),(0,e.jsx)(n.p,{children:\"Let\\u2019s start by building an XT Activity in Target with a banner displaying some eye catching content:\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"target activity\",src:\"https://images.ctfassets.net/on47yk52ubpi/3e6rhpnxg0baJCY0dTxv8F/0f88d7fdae7f57ae683a40a6028ea0fb/1_fAcwnBx3McWHXNjz0vkQeA.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"An enticing red banner will surely boost my sales.\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"live activity\",src:\"https://images.ctfassets.net/on47yk52ubpi/2OcmfOQryTRfEuzwIdmwJ4/2a4e36829bdfb1369cd93116851f8b9b/1_RDfjqGVRR6cQkH16WMsyIw.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"The sale banner is active, but I don\\u2019t know the status of Mercury!\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"banner on site\",src:\"https://images.ctfassets.net/on47yk52ubpi/6X5HhE5go0QBy5LQLduXSd/69da4f88b514c09b2cd3f135420ac155/1_aiX8JyTA5y8P79-aYnEYvQ.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:(0,e.jsx)(n.p,{children:\"When people visit myawesomewebstore.com during while Mercury is in retrograde they will be presented with this amazing banner\"})})}),(0,e.jsx)(n.hr,{}),(0,e.jsx)(n.p,{children:\"Because it is 2022 (aka the future) there is API for tracking the movement of Mercury. I can automate turning this activity on and off using this API:\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"https://mercuryretrogradeapi.com/\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"merciry api\",src:\"https://images.ctfassets.net/on47yk52ubpi/2bobDMHJTCRWSYgNKZ1Qvf/bca2791232301130221f80b60d5904a0/1_C4rBV4w9FnEommSJb5_cow.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"The future is crazy\"})}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.p,{children:[\"Before writing any automation code, the first thing to do is hop over to the Adobe Developer Console and start a new project that has access to the Target API. If you have never done that before I won\\u2019t bore you with it here. Information how to setup API projects is here: \",(0,e.jsx)(n.a,{href:\"https://developer.adobe.com/developer-console/\",children:\"https://developer.adobe.com/developer-console/\"})]}),(0,e.jsx)(n.p,{children:\"Once I have my API keys I can now interact with Target via its API. Normally, I would do this in Python, but Adobe has some excellent Node JS libraries that unfortunately you have to dig to find. Seriously, look around on NPM. Here is what I will be using:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://www.npmjs.com/package/@adobe/aio-lib-target\",children:\"Target AIO Node JS library\"}),\" - \",(0,e.jsx)(n.em,{children:\"interact with Target activities\"})]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://www.npmjs.com/package/@adobe/jwt-auth\",children:\"Adobe Authentication library\"}),\" - \",(0,e.jsx)(n.em,{children:\"Authenticate with Adobe to make API calls\"})]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://www.npmjs.com/package/axios\",children:\"Axios\"}),\" - \",(0,e.jsx)(n.em,{children:\"Call the Retrograde API\"})]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.a,{href:\"https://www.npmjs.com/package/dotenv\",children:\"dotenv\"}),\" - \",(0,e.jsx)(n.em,{children:\"read a .env file with environment variables (API creds)\"})]})]}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" auth \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/jwt-auth'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" axios \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'axios'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" dotenv \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'dotenv'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" targetSDK \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/aio-lib-target'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// get my env variables\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dotenv\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Adobe API Config vars\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  clientId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  clientSecret\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientSecret\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  technicalAccountId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"technicalAccountId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  orgId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"orgId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  metaScopes\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'ent_marketing_sdk'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  privateKey\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"privateKey\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"replace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token regex\",children:[(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsxs)(n.span,{className:\"token language-regex regex-source\",children:[(0,e.jsx)(n.span,{className:\"token escape special-escape\",children:\"\\\\\\\\\"}),\"n\"]}),(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'\\\\n'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// make the PK readable as a string\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:\"Note: I am storing my private key in an environment variable here so I don\\u2019t have to read it from a file\"})}),(0,e.jsx)(n.p,{children:\"In my code I need a function to tell me if Mercury is or is not in retrograde by calling the Mercury API. I will use this function to control whether the activity should be activated or deactivated.\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// returns boolean\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-variable\",children:\"isRetrograde\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator arrow\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" response \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" axios\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token template-string\",children:[(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"https://mercuryretrogradeapi.com/\"}),(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"is_retrograde\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"Now all I need is the method from the Target SDK for updating Activity States. Note that I have removed my actual activity in the example code, but you can find that ID on the Activity Overview page:\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"activity overview\",src:\"https://images.ctfassets.net/on47yk52ubpi/4pT3bmiRqrRenAQMQh8GH5/63dc022246db633855d2ae2fb3ad04a3/1_AubM8SaszQPWLk6Pe_3Mgg.webp\"})}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"updateActivity\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" activateTest \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"isRetrograde\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" access_token \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"auth\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" targetClient \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetSDK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"companyID\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    access_token\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" options \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    headers\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'content-type'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/vnd.adobe.target.v1+json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Accept\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/vnd.adobe.target.v1+json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// - approved : corresponds to Live in Target UI.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// - deactivated : corresponds to Inactive in Target UI.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// - saved : corresponds to Inactive in Target UI.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" updateActivityState \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"setActivityState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token number\",children:\"123456\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    activateTest \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"?\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'approved'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'saved'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    options\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//   //get offer by id activity\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" activity \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"getABActivityById\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"123456\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token class-name console\",children:\"console\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"log\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"activity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// call to change activity state\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"updateActivity\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Here is the whole file I\\u2019ll call \",(0,e.jsx)(n.em,{children:\"mercury.js\"})]}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" auth \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/jwt-auth'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" axios \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'axios'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" dotenv \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'dotenv'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" targetSDK \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/aio-lib-target'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// get my env variables\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dotenv\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Adobe API Config vars\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  clientId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  clientSecret\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientSecret\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  technicalAccountId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"technicalAccountId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  orgId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"orgId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  metaScopes\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'ent_marketing_sdk'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  privateKey\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"privateKey\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"replace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token regex\",children:[(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsxs)(n.span,{className:\"token language-regex regex-source\",children:[(0,e.jsx)(n.span,{className:\"token escape special-escape\",children:\"\\\\\\\\\"}),\"n\"]}),(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'\\\\n'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// make the PK readable as a string\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// returns boolean\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token function function-variable\",children:\"isRetrograde\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator arrow\",children:\"=>\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" response \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" axios\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"get\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token template-string\",children:[(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"https://mercuryretrogradeapi.com/\"}),(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" is_retrograde \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"data\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),` is_retrograde\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"updateActivity\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" activateTest \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"isRetrograde\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" access_token \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"auth\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" targetClient \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetSDK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"companyID\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    access_token\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" options \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    headers\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'content-type'\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/vnd.adobe.target.v1+json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token maybe-class-name\",children:\"Accept\"}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/vnd.adobe.target.v1+json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// - approved : corresponds to Live in Target UI.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// - deactivated : corresponds to Inactive in Target UI.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// - saved : corresponds to Inactive in Target UI.\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" updateActivityState \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"setActivityState\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token number\",children:\"12345\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    activateTest \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"?\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'approved'\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'saved'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`    options\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//   //get offer by id activity\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" activity \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"getABActivityById\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"12345\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token class-name console\",children:\"console\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"log\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"activity\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"updateActivity\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"A few things to note in the code above:\"}),(0,e.jsxs)(n.p,{children:[\"First, the \",(0,e.jsx)(n.em,{children:\"setActivityState\"}),\" method in the SDK needs some special media-type headers specified in the options. The SDK doesn\\u2019t have this built into the methods nor does it specify anything in the method definitions, but it is required. If you get \",(0,e.jsx)(n.a,{href:\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/415#:~:text=The%20HTTP%20415%20Unsupported%20Media,of%20inspecting%20the%20data%20directly.\",children:\"415 errors\"}),\" with any methods, double check the headers from this document: \",(0,e.jsx)(n.a,{href:\"https://developers.adobetarget.com/api/\",children:\"https://developers.adobetarget.com/api/\"})]}),(0,e.jsxs)(n.p,{children:[\"The second parameter in \",(0,e.jsx)(n.em,{children:\"setActivityState\"}),\" is a ternary operator based on what the Retrograde API gives back. If Mercury is in retrograde (true from the API) the activity will be set to \",(0,e.jsx)(n.em,{children:\"approved\"}),\". If retrograde is false, the activity will be \",(0,e.jsx)(n.em,{children:\"deactivated\"}),\". These statuses are kind of vague, and don\\u2019t reflect the terminology in the Target UI which is annoying. The definitions in the comments are taken directly from the docs. I am not sure what the difference between \",(0,e.jsx)(n.em,{children:\"saved\"}),\" and \",(0,e.jsx)(n.em,{children:\"deactivated\"}),\" is exactly. Anyway, you get the point. Let\\u2019s get to the fun part\\u2026\"]}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.h2,{id:\"automation\",children:[(0,e.jsx)(n.a,{href:\"#automation\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Automation\"]}),(0,e.jsxs)(n.p,{children:[\"There\\u2019s a couple options here to automate this. You could use an AWS Lambda, but then you have to learn about deploying a node project in lambda and how to schedule cron jobs through AWS Event Bridge. These tasks are actually trickier than they sound if you\\u2019ve never done it before. Rather than give Amazon more money, instead, I\\u2019ll give Akamai some money and use a Linode virtual machine.Then I can use it to run lots of different cron jobs. If you have never used Linode before, check out their \",(0,e.jsx)(n.a,{href:\"https://www.youtube.com/@linode\",children:\"Youtube channel\"}),\". I can either spin up a new virtual machine preloaded with NodeJS or spin up a blank one and install Node manually. I will choose the former.\"]}),(0,e.jsxs)(n.p,{children:[\"After creating my virtual machine and verifying \",(0,e.jsx)(n.a,{href:\"https://www.linode.com/docs/guides/networking/ssh/\",children:\"I can connect to it via SSH\"}),\", I transfer my \",(0,e.jsx)(n.em,{children:\"mercury.js\"}),\" file and \",(0,e.jsx)(n.em,{children:\"package.json\"}),\" file \",(0,e.jsx)(n.a,{href:\"https://www.ssh.com/academy/ssh/scp#basic-usage\",children:\"via SCP\"}),\". Regarding environment variables, I can transfer my .env also, or set them directly on the virtual machine. Your choice. Once the files are transferred, I can navigate to their directory and run \",(0,e.jsx)(n.em,{children:\"npm i\"}),\" to install all packages I will need. I\\u2019ll also run \",(0,e.jsx)(n.em,{children:\"mercury.js\"}),\" a couple times to make sure everything works:\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# transfer files via scp from source machine to VM\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# scp <source> <username@destination>\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"scp\"}),` mercury.js root@192.168.0.1:/home/mercury/mercury.js\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# scp other files...\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"#SSH into my virtual machine. (Not the real IP address :) )\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"ssh\"}),` root@192.168.0.1\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# move to mercury directory and install node libraries\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"cd\"}),\" mercury \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&&\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"npm\"}),` i\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# run the file to make sure it works!\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`node mercury.js\n`})]})}),(0,e.jsxs)(n.p,{children:[\"Once I have verified that everything works I can now instruct my virtual machine to run this as often as I want. I think daily will suffice as Mercury doesn\\u2019t move that fast. To do this I just need to edit my virtual machine\\u2019s crontab file. Cron jobs are a way to tell a Linux computer to execute a specific task at a specific time. \",(0,e.jsx)(n.a,{href:\"https://youtu.be/v952m13p-b4\",children:\"Please see this excellent video from Linode about writing cron jobs.\"})]}),(0,e.jsxs)(n.p,{children:[\"In the end, my \",(0,e.jsx)(n.em,{children:\"crontab\"}),\" file will have this at the bottom:\"]}),(0,e.jsx)(n.pre,{className:\"language-bash\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-bash\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# etc\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# etc\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# m h dom mon dow\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"8\"}),\" * * * \",(0,e.jsx)(n.span,{className:\"token class-name builtin\",children:\"cd\"}),\" /somepath/mercury \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"&&\"}),` node mercury.js\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"Basically this says \\u201C\",(0,e.jsx)(n.em,{children:\"every day at 8am, run mercury.js\"}),\"\\u201D. Every day, this command will run and mercury.js will activate/deactivate my activity based on what the mercury API says. Once I save my \",(0,e.jsx)(n.em,{children:\"crontab\"}),\" file, I have effectively created an Adobe Target Activity that is conditionally active based on the movement of a planet! The future is crazy.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"active test\",src:\"https://images.ctfassets.net/on47yk52ubpi/3o4BxcVYr5MAkyxCZKnVyO/3b24d1e0ba2a2c5710a255f65bbaa22b/1_DvRL0HerPI6zK1fxgHp0Tw.webp\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.em,{children:\"A quick note: the target UI doesn\\u2019t always update immediately to reflect API changes, but you can verify that the activity is activated via the Changelog section. The UI changes will show up after a few minutes.\"})}),(0,e.jsxs)(n.p,{children:[\"Now this example is \",(0,e.jsx)(n.em,{children:\"trivial\"}),\", some might even call it stupid (\",(0,e.jsx)(n.em,{children:\"how dare you!\"}),\"), but the set up is real. What if you run all types of date specific Target activities? Black Friday, Cyber Monday, Super Bowl, President\\u2019s Day, Flag Day, John\\u2019s birthday, and so on. I could have all sorts of Target Activities that programmatically turn on and off based on the date. With some initial setup, I could plan out a whole year of sales banners in a few hours!\"]})]})}}var w=v;return g(b);})();\n;return Component;"
    },
    "_id": "blog/interacting-with-an-adobe-target-activity-based-on-the-movement-of-mercury.mdx",
    "_raw": {
      "sourceFilePath": "blog/interacting-with-an-adobe-target-activity-based-on-the-movement-of-mercury.mdx",
      "sourceFileName": "interacting-with-an-adobe-target-activity-based-on-the-movement-of-mercury.mdx",
      "sourceFileDir": "blog",
      "contentType": "mdx",
      "flattenedPath": "blog/interacting-with-an-adobe-target-activity-based-on-the-movement-of-mercury"
    },
    "type": "Blog",
    "readingTime": {
      "text": "9 min read",
      "minutes": 8.075,
      "time": 484500,
      "words": 1615
    },
    "slug": "interacting-with-an-adobe-target-activity-based-on-the-movement-of-mercury",
    "toc": [
      {
        "value": "17th Century Marketing",
        "url": "#17th-century-marketing",
        "depth": 2
      },
      {
        "value": "Automation",
        "url": "#automation",
        "depth": 2
      }
    ]
  },
  {
    "title": "Syncing Adobe Launch/Tags with Github - Part 1: Setup",
    "date": "2023-04-18T00:00:00.000Z",
    "tags": [
      "adobe launch",
      "adobe tags",
      "javascript",
      "github",
      "automation"
    ],
    "draft": false,
    "summary": "How to use Github to build, sync, & deploy custom code directly to Adobe Launch/Tags - Part 1",
    "body": {
      "raw": "\n## Down the rabbit hole\n\nI originally just wanted to sync one github file with one data element and bake some real\nversion control into my more complex custom code data elements. Well, I did that, but I also accidentially\nmade it possible to universally sync a single github file with multiple data elements across just as many properties.\n\nSo why would you want to do this? Well, you might manage dozens of properties and hate having to make the\nsame change in multiple places. Maybe you have some complicated code that augments a 3rd party library\nwith web data (think sending marketing data along with chat sessions), I'm sure if you manage more than one\nproperty or work with a lot of custom code, you've though about setting this up from time to time. I fall into both of those categories.\nPlus, its just a cool integration that I figured _someone_ would do eventually, so why not me? A note before we get into it:\n\n**For the time being, everything here should be considered proof of concept!\nI am not a licensed financial advisor! Your mileage may vary! Proceed with caution!**\n\n![penguin crossing](https://images.ctfassets.net/on47yk52ubpi/eFoE7wCE4YD7oypDX0YK7/e94e6ec19b3261ada71a8667e17b406e/caution_sign.jpg)\n\n<figure>\n  <figcaption>Does anyone know where this is?!</figcaption>\n</figure>\n\n## So how exactly does it work?\n\nMore hooks than a bait shop, more callbacks than a...teenager with a busted voicemail? I don't know, I couldn't think of anything...\nHere is what happens:\n\n- There is an initial setup of the data elements in Launch and files in Github. These things must first exist before we can sync them.\n- A Github push webhook sends a push event to an AWS API gateway. I'll call this **Github Webhook Gateway**\n- **Github Webhook Gateway** does some checks and says, _\"yep this data needs to sync with Launch\"_ and invokes a lambda called **Extract Github Data**\n- **Extract Github Data** pulls the actual file content from Github and formats it for the [Reactor API](https://experienceleague.adobe.com/docs/experience-platform/tags/api/overview.html).\n- Once the new file content is ready to be sent to Launch, **Extract Github Data** triggers another lambda called **Build Launch Development Library**\n- **Build Launch Development Library** takes the changes, incorporates them into a library, and builds a library.\n- Separately defined [Launch callback hooks](https://experienceleague.adobe.com/docs/experience-platform/tags/api/endpoints/callbacks.html?lang=en) listen for libraries built via Github changes and automatically publish them through dev > staging > prod.\n  <br></br>\n  <br></br>\n  <div style={{ border: '1px solid black' }}>\n    ![aws\n    diagram](https://images.ctfassets.net/on47yk52ubpi/1veno3QJdFZRF6ra2trhmR/7ab63da00a6c3d16174b49ddd5b75ae3/2d_launch_github_sync_diagram_cropped.png)\n  </div>\n\n<figure>\n  <figcaption>Once the initial setup is done, this is the flow!</figcaption>\n</figure>\n\n---\n\n## Launch Setup\n\nBefore I can automatically sync data elements with Github files, those data elements need to _exist_ in their respective Launch properties _first_.\nThis is necessary because I need to incorporate their data element ID(s) into Github. You can get the data element ID from the URL when working on a data element.\n\nPro tip for those going further:\nthere's a lot of Launch component IDs used in this project: data elements, libraries, environments, etc. The first 2 letters of the ID indicate\nwhat type of ID it is, so when looking at the URL of a data element, the property ID of that data element will start with `PR...`, the\ndata element ID will start with `DE...`, etc.\n\n![DATA ELEMENT URL](https://images.ctfassets.net/on47yk52ubpi/6IowiCe5E01eRu7thTD1aj/5255612b327f66c4f625eeb1b44a613d/DATAELEMENTURL.png)\n\n<figure>\n  <figcaption>You can find your data element IDs in the URL when editing them</figcaption>\n</figure>\n\n## Github File Setup\n\nHere is the folder structure for my repo. I would consider this my master property settings. Its just data elements for now, but\nin the future there's no reason rules and other components can't also be included:\n\n```bash\n-repo\n    - dataelements\n        - dataelement1.js\n        - dataelement2.js\n        - etc etc\n    - rules\n        - rule files here...\n```\n\n[Sample Launch Property Repo](https://github.com/perpetua-digital/launch-property)\n\nEach Github file has the data element ID(s) it should sync with as a comment on the first line. The lambda extracts these IDs and uses them in the API calls that update the data elements in Launch.\nI'm not too worried about committing these IDs since, in practice, this will be a private repo _and_ a minified Launch library strips comments out of custom code anyway. Github push\nwebhooks are also authenticated via a [Github Personal Access token](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token).\n\n```javascript\n// DE123456789... DE987654321...\n// [GITHUB] url\n// The github file should be exactly what should be in the custom code data element\nreturn `${window.location.protocol}//${window.location.host}${window.location.pathname}`\n```\n\n## The future...\n\nI am at a bit of a crossroads as to how I want to get this out to the people. Here's my options:\n\n1. Make all source code public and basically make this an open source project. I would use this blog to explain how each part works.\n   It _is_ complex and I don't think the average Launch/Tags user would take the time to set it up. Plus, implementing requires enterprise tools like AWS that some people might not be comfortable working in...\n2. Keep the code behind the scenes and build this out into a full fledged app with [App Builder](https://business.adobe.com/products/experience-manager/developer-app-builder.html). Easier to implement for\n   people, but won't be free. This would be a ton of work for me and I do still have a day job.\n\nShoot me a message or comment what you think I should do!\n\n## Demo video\n\nThis is the same video I previously posted on LinkedIn, but now you know why I have the data element ID\nin a comment _and_ notice that it doesn't come out as part of the data element on a website.\n\n<ReactPlayer url=\"https://www.youtube.com/watch?v=ppZrylP4Mn0\" />\n",
      "code": "var Component=(()=>{var h=Object.create;var s=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var b=(n,a)=>()=>(a||n((a={exports:{}}).exports,a),a.exports),g=(n,a)=>{for(var i in a)s(n,i,{get:a[i],enumerable:!0})},c=(n,a,i,t)=>{if(a&&typeof a==\"object\"||typeof a==\"function\")for(let o of p(a))!m.call(n,o)&&o!==i&&s(n,o,{get:()=>a[o],enumerable:!(t=d(a,o))||t.enumerable});return n};var f=(n,a,i)=>(i=n!=null?h(u(n)):{},c(a||!n||!n.__esModule?s(i,\"default\",{value:n,enumerable:!0}):i,n)),w=n=>c(s({},\"__esModule\",{value:!0}),n);var r=b((D,l)=>{l.exports=_jsx_runtime});var v={};g(v,{default:()=>N,frontmatter:()=>y});var e=f(r()),y={title:\"Syncing Adobe Launch/Tags with Github - Part 1: Setup\",date:\"2023-04-18\",tags:[\"adobe launch\",\"adobe tags\",\"javascript\",\"github\",\"automation\"],draft:!1,summary:\"How to use Github to build, sync, & deploy custom code directly to Adobe Launch/Tags - Part 1\"};function k(n={}){let{wrapper:a}=n.components||{};return a?(0,e.jsx)(a,Object.assign({},n,{children:(0,e.jsx)(i,{})})):i();function i(){let t=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",em:\"em\",strong:\"strong\",img:\"img\",ul:\"ul\",li:\"li\",hr:\"hr\",code:\"code\",pre:\"pre\",ol:\"ol\"},n.components),{ReactPlayer:o}=t;return o||I(\"ReactPlayer\",!0,\"115:1-115:66\"),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(t.h2,{id:\"down-the-rabbit-hole\",children:[(0,e.jsx)(t.a,{href:\"#down-the-rabbit-hole\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"Down the rabbit hole\"]}),(0,e.jsx)(t.p,{children:\"I originally just wanted to sync one github file with one data element and bake some real version control into my more complex custom code data elements. Well, I did that, but I also accidentially made it possible to universally sync a single github file with multiple data elements across just as many properties.\"}),(0,e.jsxs)(t.p,{children:[\"So why would you want to do this? Well, you might manage dozens of properties and hate having to make the same change in multiple places. Maybe you have some complicated code that augments a 3rd party library with web data (think sending marketing data along with chat sessions), I'm sure if you manage more than one property or work with a lot of custom code, you've though about setting this up from time to time. I fall into both of those categories. Plus, its just a cool integration that I figured \",(0,e.jsx)(t.em,{children:\"someone\"}),\" would do eventually, so why not me? A note before we get into it:\"]}),(0,e.jsx)(t.p,{children:(0,e.jsx)(t.strong,{children:\"For the time being, everything here should be considered proof of concept! I am not a licensed financial advisor! Your mileage may vary! Proceed with caution!\"})}),(0,e.jsx)(t.p,{children:(0,e.jsx)(t.img,{alt:\"penguin crossing\",src:\"https://images.ctfassets.net/on47yk52ubpi/eFoE7wCE4YD7oypDX0YK7/e94e6ec19b3261ada71a8667e17b406e/caution_sign.jpg\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Does anyone know where this is?!\"})}),(0,e.jsxs)(t.h2,{id:\"so-how-exactly-does-it-work\",children:[(0,e.jsx)(t.a,{href:\"#so-how-exactly-does-it-work\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"So how exactly does it work?\"]}),(0,e.jsx)(t.p,{children:\"More hooks than a bait shop, more callbacks than a...teenager with a busted voicemail? I don't know, I couldn't think of anything... Here is what happens:\"}),(0,e.jsxs)(t.ul,{children:[(0,e.jsx)(t.li,{children:\"There is an initial setup of the data elements in Launch and files in Github. These things must first exist before we can sync them.\"}),(0,e.jsxs)(t.li,{children:[\"A Github push webhook sends a push event to an AWS API gateway. I'll call this \",(0,e.jsx)(t.strong,{children:\"Github Webhook Gateway\"})]}),(0,e.jsxs)(t.li,{children:[(0,e.jsx)(t.strong,{children:\"Github Webhook Gateway\"}),\" does some checks and says, \",(0,e.jsx)(t.em,{children:'\"yep this data needs to sync with Launch\"'}),\" and invokes a lambda called \",(0,e.jsx)(t.strong,{children:\"Extract Github Data\"})]}),(0,e.jsxs)(t.li,{children:[(0,e.jsx)(t.strong,{children:\"Extract Github Data\"}),\" pulls the actual file content from Github and formats it for the \",(0,e.jsx)(t.a,{href:\"https://experienceleague.adobe.com/docs/experience-platform/tags/api/overview.html\",children:\"Reactor API\"}),\".\"]}),(0,e.jsxs)(t.li,{children:[\"Once the new file content is ready to be sent to Launch, \",(0,e.jsx)(t.strong,{children:\"Extract Github Data\"}),\" triggers another lambda called \",(0,e.jsx)(t.strong,{children:\"Build Launch Development Library\"})]}),(0,e.jsxs)(t.li,{children:[(0,e.jsx)(t.strong,{children:\"Build Launch Development Library\"}),\" takes the changes, incorporates them into a library, and builds a library.\"]}),(0,e.jsxs)(t.li,{children:[\"Separately defined \",(0,e.jsx)(t.a,{href:\"https://experienceleague.adobe.com/docs/experience-platform/tags/api/endpoints/callbacks.html?lang=en\",children:\"Launch callback hooks\"}),\" listen for libraries built via Github changes and automatically publish them through dev > staging > prod.\",\" \",(0,e.jsx)(\"br\",{}),(0,e.jsx)(\"br\",{}),(0,e.jsx)(\"div\",{style:{border:\"1px solid black\"},children:(0,e.jsx)(t.p,{children:(0,e.jsx)(t.img,{alt:`aws\ndiagram`,src:\"https://images.ctfassets.net/on47yk52ubpi/1veno3QJdFZRF6ra2trhmR/7ab63da00a6c3d16174b49ddd5b75ae3/2d_launch_github_sync_diagram_cropped.png\"})})})]})]}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Once the initial setup is done, this is the flow!\"})}),(0,e.jsx)(t.hr,{}),(0,e.jsxs)(t.h2,{id:\"launch-setup\",children:[(0,e.jsx)(t.a,{href:\"#launch-setup\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"Launch Setup\"]}),(0,e.jsxs)(t.p,{children:[\"Before I can automatically sync data elements with Github files, those data elements need to \",(0,e.jsx)(t.em,{children:\"exist\"}),\" in their respective Launch properties \",(0,e.jsx)(t.em,{children:\"first\"}),\". This is necessary because I need to incorporate their data element ID(s) into Github. You can get the data element ID from the URL when working on a data element.\"]}),(0,e.jsxs)(t.p,{children:[\"Pro tip for those going further: there's a lot of Launch component IDs used in this project: data elements, libraries, environments, etc. The first 2 letters of the ID indicate what type of ID it is, so when looking at the URL of a data element, the property ID of that data element will start with \",(0,e.jsx)(t.code,{children:\"PR...\"}),\", the data element ID will start with \",(0,e.jsx)(t.code,{children:\"DE...\"}),\", etc.\"]}),(0,e.jsx)(t.p,{children:(0,e.jsx)(t.img,{alt:\"DATA ELEMENT URL\",src:\"https://images.ctfassets.net/on47yk52ubpi/6IowiCe5E01eRu7thTD1aj/5255612b327f66c4f625eeb1b44a613d/DATAELEMENTURL.png\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"You can find your data element IDs in the URL when editing them\"})}),(0,e.jsxs)(t.h2,{id:\"github-file-setup\",children:[(0,e.jsx)(t.a,{href:\"#github-file-setup\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"Github File Setup\"]}),(0,e.jsx)(t.p,{children:\"Here is the folder structure for my repo. I would consider this my master property settings. Its just data elements for now, but in the future there's no reason rules and other components can't also be included:\"}),(0,e.jsx)(t.pre,{className:\"language-bash\",children:(0,e.jsxs)(t.code,{className:\"code-highlight language-bash\",children:[(0,e.jsx)(t.span,{className:\"code-line\",children:`-repo\n`}),(0,e.jsx)(t.span,{className:\"code-line\",children:`    - dataelements\n`}),(0,e.jsx)(t.span,{className:\"code-line\",children:`        - dataelement1.js\n`}),(0,e.jsx)(t.span,{className:\"code-line\",children:`        - dataelement2.js\n`}),(0,e.jsx)(t.span,{className:\"code-line\",children:`        - etc etc\n`}),(0,e.jsx)(t.span,{className:\"code-line\",children:`    - rules\n`}),(0,e.jsxs)(t.span,{className:\"code-line\",children:[\"        - rule files here\",(0,e.jsx)(t.span,{className:\"token punctuation\",children:\"..\"}),`.\n`]})]})}),(0,e.jsx)(t.p,{children:(0,e.jsx)(t.a,{href:\"https://github.com/perpetua-digital/launch-property\",children:\"Sample Launch Property Repo\"})}),(0,e.jsxs)(t.p,{children:[\"Each Github file has the data element ID(s) it should sync with as a comment on the first line. The lambda extracts these IDs and uses them in the API calls that update the data elements in Launch. I'm not too worried about committing these IDs since, in practice, this will be a private repo \",(0,e.jsx)(t.em,{children:\"and\"}),\" a minified Launch library strips comments out of custom code anyway. Github push webhooks are also authenticated via a \",(0,e.jsx)(t.a,{href:\"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token\",children:\"Github Personal Access token\"}),\".\"]}),(0,e.jsx)(t.pre,{className:\"language-javascript\",children:(0,e.jsxs)(t.code,{className:\"code-highlight language-javascript\",children:[(0,e.jsxs)(t.span,{className:\"code-line\",children:[(0,e.jsx)(t.span,{className:\"token comment\",children:\"// DE123456789... DE987654321...\"}),`\n`]}),(0,e.jsxs)(t.span,{className:\"code-line\",children:[(0,e.jsx)(t.span,{className:\"token comment\",children:\"// [GITHUB] url\"}),`\n`]}),(0,e.jsxs)(t.span,{className:\"code-line\",children:[(0,e.jsx)(t.span,{className:\"token comment\",children:\"// The github file should be exactly what should be in the custom code data element\"}),`\n`]}),(0,e.jsxs)(t.span,{className:\"code-line\",children:[(0,e.jsx)(t.span,{className:\"token control-flow keyword\",children:\"return\"}),\" \",(0,e.jsxs)(t.span,{className:\"token template-string\",children:[(0,e.jsx)(t.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,e.jsxs)(t.span,{className:\"token interpolation\",children:[(0,e.jsx)(t.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),(0,e.jsx)(t.span,{className:\"token dom variable\",children:\"window\"}),(0,e.jsx)(t.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(t.span,{className:\"token property-access\",children:\"location\"}),(0,e.jsx)(t.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(t.span,{className:\"token property-access\",children:\"protocol\"}),(0,e.jsx)(t.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,e.jsx)(t.span,{className:\"token string\",children:\"//\"}),(0,e.jsxs)(t.span,{className:\"token interpolation\",children:[(0,e.jsx)(t.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),(0,e.jsx)(t.span,{className:\"token dom variable\",children:\"window\"}),(0,e.jsx)(t.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(t.span,{className:\"token property-access\",children:\"location\"}),(0,e.jsx)(t.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(t.span,{className:\"token property-access\",children:\"host\"}),(0,e.jsx)(t.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,e.jsxs)(t.span,{className:\"token interpolation\",children:[(0,e.jsx)(t.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),(0,e.jsx)(t.span,{className:\"token dom variable\",children:\"window\"}),(0,e.jsx)(t.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(t.span,{className:\"token property-access\",children:\"location\"}),(0,e.jsx)(t.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(t.span,{className:\"token property-access\",children:\"pathname\"}),(0,e.jsx)(t.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,e.jsx)(t.span,{className:\"token string template-punctuation\",children:\"`\"})]}),`\n`]})]})}),(0,e.jsxs)(t.h2,{id:\"the-future\",children:[(0,e.jsx)(t.a,{href:\"#the-future\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"The future...\"]}),(0,e.jsx)(t.p,{children:\"I am at a bit of a crossroads as to how I want to get this out to the people. Here's my options:\"}),(0,e.jsxs)(t.ol,{children:[(0,e.jsxs)(t.li,{children:[\"Make all source code public and basically make this an open source project. I would use this blog to explain how each part works. It \",(0,e.jsx)(t.em,{children:\"is\"}),\" complex and I don't think the average Launch/Tags user would take the time to set it up. Plus, implementing requires enterprise tools like AWS that some people might not be comfortable working in...\"]}),(0,e.jsxs)(t.li,{children:[\"Keep the code behind the scenes and build this out into a full fledged app with \",(0,e.jsx)(t.a,{href:\"https://business.adobe.com/products/experience-manager/developer-app-builder.html\",children:\"App Builder\"}),\". Easier to implement for people, but won't be free. This would be a ton of work for me and I do still have a day job.\"]})]}),(0,e.jsx)(t.p,{children:\"Shoot me a message or comment what you think I should do!\"}),(0,e.jsxs)(t.h2,{id:\"demo-video\",children:[(0,e.jsx)(t.a,{href:\"#demo-video\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(t.span,{className:\"icon icon-link\"})}),\"Demo video\"]}),(0,e.jsxs)(t.p,{children:[\"This is the same video I previously posted on LinkedIn, but now you know why I have the data element ID in a comment \",(0,e.jsx)(t.em,{children:\"and\"}),\" notice that it doesn't come out as part of the data element on a website.\"]}),(0,e.jsx)(o,{url:\"https://www.youtube.com/watch?v=ppZrylP4Mn0\"})]})}}var N=k;function I(n,a,i){throw new Error(\"Expected \"+(a?\"component\":\"object\")+\" `\"+n+\"` to be defined: you likely forgot to import, pass, or provide it.\"+(i?\"\\nIt\\u2019s referenced in your code at `\"+i+\"` in `/Users/john/Desktop/code/perpetuadigitalwebsite/_mdx_bundler_entry_point-64b5b6e9-3ede-4622-a989-5e757111e7fc.mdx`\":\"\"))}return w(v);})();\n;return Component;"
    },
    "_id": "blog/launch-github-sync-part-1.mdx",
    "_raw": {
      "sourceFilePath": "blog/launch-github-sync-part-1.mdx",
      "sourceFileName": "launch-github-sync-part-1.mdx",
      "sourceFileDir": "blog",
      "contentType": "mdx",
      "flattenedPath": "blog/launch-github-sync-part-1"
    },
    "type": "Blog",
    "readingTime": {
      "text": "5 min read",
      "minutes": 4.545,
      "time": 272700,
      "words": 909
    },
    "slug": "launch-github-sync-part-1",
    "toc": [
      {
        "value": "Down the rabbit hole",
        "url": "#down-the-rabbit-hole",
        "depth": 2
      },
      {
        "value": "So how exactly does it work?",
        "url": "#so-how-exactly-does-it-work",
        "depth": 2
      },
      {
        "value": "Launch Setup",
        "url": "#launch-setup",
        "depth": 2
      },
      {
        "value": "Github File Setup",
        "url": "#github-file-setup",
        "depth": 2
      },
      {
        "value": "The future...",
        "url": "#the-future",
        "depth": 2
      },
      {
        "value": "Demo video",
        "url": "#demo-video",
        "depth": 2
      }
    ]
  },
  {
    "title": "Using data from Adobe Analytics in Adobe Target Offers",
    "date": "2022-12-16T00:00:00.000Z",
    "tags": [
      "adobe analytics",
      "adobe target",
      "testing"
    ],
    "draft": false,
    "summary": "How to use data pulled from Adobe Analytics in an Adobe Target offer.",
    "body": {
      "raw": "\n## Do social proof CTAs actually work?\n\nI’m sure everyone has seen those popups on online stores that say something like \n*“15 people are viewing this product right now!”* or *“105 other people from Michigan bought this yesterday!”*. \nI actually looked around for one in the wild to include a screenshot, but of course, when I need one, \nI can’t find one. Anyway, I’m going to build one of those in Target that uses **real data** pulled from Adobe Analytics.\n\n![popupexample](https://images.ctfassets.net/on47yk52ubpi/LX2R2PAXrJFZyJDVmeppD/48d92270accf82b3eb77bf992fcb291f/1_eDd83lpg7ihAxJgoYkfOcw.webp)\n<figure>\n<figcaption>This type of thing!</figcaption>\n</figure>\n\nIn this example, for simplicity, lets say I have a product page, running an A/B activity in Target for all visitors. \n50% of visitors to this page will get a pop up that “encourages” them to make a purchase by saying something \nlike: *“n-number of people viewed this product yesterday!”* and the other 50% of visitors will get the default \nexperience of no such popup. The *n-number* used in the popup content will be a real number of unique visitors \nwho viewed that product page yesterday just as it is reflected in an Adobe Analytics Workspace table. \nThe number will change daily to reflect the previous day’s data relative to the current date; i.e. a \nvisitor on the 12th will see data from the 11th, a visitor on the 13th will see data from the 12th, etc.\n\nThe example I create will be trivial, but concepts will apply to showing *anything* from a workspace table in a Target offer!\n\n## General overview\n\nAs with *almost* everything I write about these days, for the sake of brevity, I have to assume some prior knowledge \nof the [Adobe Developer Console](https://developer.adobe.com/developer-console/), some programming experience, \nand familiarity with Target and Adobe Analytics terminology.\n\nHere are the steps:\n\n* Hack together the popup element using a placeholder number.\n* Save the code from above as a Target Offer. Note the offer ID after saving.\n* Build the activity in Target with the 2 experiences using the [form composer](https://experienceleague.adobe.com/docs/target/using/experiences/form-experience-composer.html?lang=en) and set the delivery content in the variant experience to be the offer I just saved above.\n* In workspace now, build a report that shows the number I want to display in the offer. Use the [Oberon debugger](https://developer.adobe.com/cja-apis/docs/endpoints/reporting/debugger/) to grab the parameters used to make that report as JSON.\n* Setup a developer console project that has access to the Target API and the Adobe Analytics API. I will need the API keys in the next step.\n* Write some NodeJS using the [Adobe AIO libraries](https://www.npmjs.com/search?q=adobe%20aio) to pull that number from workspace and update your Target offer to use that number.\n* Automate the NodeJS above to update the offer with new data every day (or however often you want it to update)\n* *Note: For this example lets assume its a desktop only audience. I would never willingly encourge anyone to put a popup on mobile!*\n\n---\n\n## Build the popup\n\nSince I will be serving a chunk of HTML as my Target offer, I need a self contained, complete piece of code that builds the \npopup, styles it, etc. You could simplify this part by just replacing some static text like a headline or CTA, \nbut I already said popup and my delete key is broken. I don’t remember the keyframes syntax for having things animate \ndirectionally in, so lets just have the popup fade in:\n\n```javascript\nconst popup = document.createElement('div');\npopup.id = 'popup';\nconst content = document.createElement('p');\nconst keyframes = document.createElement('style');\nkeyframes.innerText =\n  '#popup {font-weight: bold !important;height: 100px !important;width: 350px !important;background-color: #fff !important;border: 3px solid red !important;position: absolute !important;bottom: 0 !important;margin: 1em !important;padding: 1em !important;border-radius: 1em !important;-webkit-animation: popin 4s forwards !important;animation-name: popin 4s forwards !important;}@-webkit-keyframes popin {from {opacity: 0;}to {opacity: 1;}}@keyframes popup {from {opacity: 0;}to {opacity: 1;}}';\ndocument.querySelector('head').insertAdjacentElement('beforeend', keyframes);\nlet message = 'n people viewed this product yesterday!';\ncontent.innerText = message;\npopup.appendChild(content);\ndocument.querySelector('body').appendChild(popup);\n```\n\n![n number of people viewed](https://images.ctfassets.net/on47yk52ubpi/6NXOVx8Iv1YkEfzXiVsSVE/ddcb853ac246f7ae28fb0cd2b27ebcc2/1_d_7nt3bXF98bud9bwPeG8w.gif)\n<figure>\n<figcaption>An incredibly enticing popup box with placeholder content. Who are you to resist it?!</figcaption>\n</figure>\n\n## Save it as an offer\n\nNow that I have the popup I want to serve in one of my Target experiences, \nI need to save it as an offer. Once it is saved as an offer, I will be able to deliver it in any \nActivity and more easily interact with it via the Target API.\n\nSince I am technically delivering HTML in need to wrap this code in a `<script>` tag so it is valid HTML:\n![save as offer](https://images.ctfassets.net/on47yk52ubpi/6hwD3HxzfppywMRNNlG63X/0dbc6c41ded784fc5b7843434904f592/1_jQclFe_vk_L19eG8ccRYJw.webp)\n<figure>\n<figcaption>New HTML Offer</figcaption>\n</figure>\n\n![fake offer code](https://images.ctfassets.net/on47yk52ubpi/61fP41uUz2haec6Psdc9hH/ac43f41dd9ed00c448e43df0a7d2f8ee/1_Mxm-OiWKLPnEQwiXPCCQuQ.webp)\n<figure>\n<figcaption>Make sure the code your delivering is valid HTML</figcaption>\n</figure>\n\n![grab the offer id](https://images.ctfassets.net/on47yk52ubpi/2N45TpzFFe6BqcrJiZU54M/3e68a814c42c7b11b3a0eca89839e4dd/1__B06TB_Y1Pu3Es7j6sjjHw.webp)\n<figure>\n<figcaption>Grab the offer ID while you are here!</figcaption>\n</figure>\n\nOnce the offer is saved, bring up this info box by clicking the (i) icon in the modify column and save the Offer ID for later!\n\n## Build the Activity in Target\nIf you’ve never used the form composer, its a little difference than the VEC. \nYou need to have all the specifics of your Activity ready to go. [The official form composer docs are here](https://experienceleague.adobe.com/docs/target/using/experiences/form-experience-composer.html?lang=en).\n\n![form composer setup](https://images.ctfassets.net/on47yk52ubpi/MIMchv6VFEDvOHN1zemC7/49dbf7c0d32566dc11372b188c4b0047/1_vOKzHvOkgSAr-xc0GD1ElQ.webp)\n<figure>\n<figcaption>The setup for my popup offer experience in Target</figcaption>\n</figure>\n\nThat’s it in the Target UI until its time to activate the test!\n\n---\n\n## Getting the data I want to use in my Offer from Adobe Analytics\n\nThe first step to being able to pull the data I want via the API is to generate it from a report in workspace. \nWhile this is not *technically* necessary, Adobe’s Oberon debugging tool makes interacting with the reporting API **much, much** easier. \nHere’s what my desired data looks like in workspace, the number of unique visitors to my product page yesterday:\n\n![workspace setup data](https://images.ctfassets.net/on47yk52ubpi/4qBPqYz8ZxiC8Fwp2Nhqz2/0bfe5046a76fd2555d2ecbe69f5b2827/1_arBiuRigeG2U0Vy2VMLhug.webp)\n<figure>\n<figcaption>1,388 will change every day. Thus the number in the pop up will change every day!</figcaption>\n</figure>\n\nIn order to view (and steal) the underlying API query that made this report, I need to first enable the debugger. \nTo do so, make sure the project is saved and go to *Help > Enable Debugger*. \nEnabling the debugger will add this little bug guy to your freeform tables. \nClick it, and you can see the underlying JSON & XML queries the Adobe Analytics API used to generate the data for the table. \nDepending on how much work you have done on the table, you will also see historical snapshots of queries it has used.\n\n![enable debugger](https://images.ctfassets.net/on47yk52ubpi/5VnYOncJiVuPpjXPcebhPx/ff6502e88fa2f01199dc22e31afe0006/1_kJPPtqkeyVlhteJYYaMu4Q.webp)\n<figure>\n<figcaption>How to enable the debugger</figcaption>\n</figure>\n\n![oberon bug](https://images.ctfassets.net/on47yk52ubpi/5EGfYGHehMBVWNWFtFiyva/fc2b64be16a2d61dd5805db5567567de/1_AFq2k7pVu2MIEW2fjvMr3g.webp)\n<figure>\n<figcaption>Click the little bug fella in your panel</figcaption>\n</figure>\n\nThis is what I am looking for inside the debug view. \nI will use this chunk of JSON later on when I need to programmatically pull this data.\n\n![oberon json](https://images.ctfassets.net/on47yk52ubpi/3LVKr2P63ZnjvRAH4DWwum/d7cab2b8604e7456a37933042a9551b4/1_X9x755hhoK5lcxlHTZ3t6A.webp)\n<figure>\n<figcaption>This is the JSON that Workspace uses to query Adobe Analytics data! In the UI there will also be the response from the API just to the right of here where you will see the data represented.</figcaption>\n</figure>\n\nJumping ahead a little bit, when I make this call via the Node SDK, you can see that the data is the same as in workspace. \nThat is because I am doing the exact same thing workspace is doing!\n\n```javascript\nconst auth = require('@adobe/jwt-auth');\nconst aaSDK = require('@adobe/aio-lib-analytics');\nconst dotenv = require('dotenv');\n\n// get my env variables\ndotenv.config();\n\n// Adobe API Config vars\nconst config = {\n  clientId: process.env.clientId,\n  clientSecret: process.env.clientSecret,\n  technicalAccountId: process.env.technicalAccountId,\n  orgId: process.env.orgId,\n  metaScopes: ['ent_analytics_bulk_ingest_sdk'],\n  privateKey: process.env.privateKey.replace(/\\\\n/g, '\\n'), // make the PK readable as a string\n};\n\n// json query goes here, I left it out here to save space\nconst query = {}\n\n\nasync function getAAData() {\n  // get bearer token\n  let { access_token } = await auth(config);\n\n  //initialize sdk\n  const aaClient = await aaSDK.init(process.env.companyId, config.clientId, access_token);\n\n  // Query the data\n  const myReport = await aaClient.getReport(query);\n\n  console.log(JSON.stringify(myReport.obj.rows, null, 4));\n}\n\ngetAAData();\n```\n\n![code output](https://images.ctfassets.net/on47yk52ubpi/7m583CXdTSSElIfI8aQqot/be989732335a7052055ae3cf4f5249ee/1_q7TZUjU8IY2rmmnAVwGFfQ.webp)\n<figure>\n<figcaption>1388! The same number from workspace!</figcaption>\n</figure>\n\n## Making the query dynamic\n\nIn order to make my query dynamic and return the data from the previous day, I need to inject the previous date into it. \nAlthough the workspace date range says “Yesterday”, in the query you can see it uses actual dates instead of a keyword:\n\n```javascript\nglobalFilters: [\n    {\n      type: 'dateRange',\n      dateRange: '2022-12-13T00:00:00.000/2022-12-14T00:00:00.000',\n    },\n  ],\n```\n\nThis is good though, because that means I can just replace the hardcoded dates with whatever date range I want. \nIn this case, the dates of “today” and “yesterday”\n\n ```javascript\nconst today = new Date();\nconst todayDate = today.toISOString().split('T')[0];\nconst yesterday = today.setDate(today.getDate() - 1);\nconst yesterdayDate = new Date(yesterday).toISOString().split('T')[0];\nconst query = {\n  rsid: process.env.rsid,\n  globalFilters: [\n    {\n      type: 'dateRange',\n      dateRange: `${yesterdayDate}T00:00:00.000/${todayDate}T00:00:00.000`,\n    },\n  ],\n}\n  etc etc .........\n```\n\nThere’s probably a more elegant way to do this way a newer date library from NPM, \nbut this works. So now my report will always pull the previous day’s data, relative to \nthe current date. Exactly the data I want to use in my dynamic offer.\n\n**A note when automating: make sure you know the timezone of your server! Dates might be different if its using UTC.**\n\n![different data](https://images.ctfassets.net/on47yk52ubpi/4juJYuay1gamPWmHNwkx89/8d71d3ed102b35f9bd9edbeb0acbc071/1_O2hmfCedbg4zFwFwejprfA.webp)\n<figure>\n<figcaption>I continued writing this post the next day, thus my data has changed!</figcaption>\n</figure>\n\n## Updating the offer\n\nNow that I can get the data I need from Adobe Analytics. I want to take that data and put it into my offer programmatically. \nTo do this, I can use the [Target AIO Library](https://www.npmjs.com/package/@adobe/aio-lib-target) to get the offer, \nreplace the data, and update it. First lets get the offer:\n\n ```javascript\nconst auth = require('@adobe/jwt-auth');\nconst dotenv = require('dotenv');\nconst targetSDK = require('@adobe/aio-lib-target');\n\n// get my env variables\ndotenv.config();\n\n// Adobe API Config vars\nconst config = {\n  clientId: process.env.clientId,\n  clientSecret: process.env.clientSecret,\n  technicalAccountId: process.env.technicalAccountId,\n  orgId: process.env.orgId,\n  metaScopes: ['ent_analytics_bulk_ingest_sdk', 'ent_marketing_sdk'],\n  privateKey: process.env.privateKey.replace(/\\\\n/g, '\\n'), // make the PK readable as a string\n};\n\nasync function getTargetOffer() {\n  let { access_token } = await auth(config);\n  const targetClient = await targetSDK.init(process.env.tenant, config.clientId, access_token);\n  const offer = await targetClient.getOfferById(123456); // fake offer number\n  console.log(offer);\n}\n\ngetTargetOffer();\n```\n![aio get offer](https://images.ctfassets.net/on47yk52ubpi/3iTnQZtHZa7ul6dKfCpCFM/db02d0020659fbbe29576d61b5e5bc26/1_-71ZJ5X20ODZ_I4Y8Zc9lA.webp)\n\nThe contents of the offer (aka the code) can be found in the response under *obj.content*. \nI will be calling this offer, getting its current content, replacing the number that is \ncurrently in the message with the latest one from workspace, then calling the update function to update the content.\n\nThere’s a couple ways to do this, but the easiest is probably regex replace.\n The tricky part here is the content gets returned as a bunch of concatenated strings because Target is \n keeping the spacing that was present when I originally saved the offer. To make things a little easier on myself, \n I’m going to go open my offer in the Target UI, grab the code, and minify it. Then when I use the API, \n the offer content gets returned to me as a single string which I can use regex replace on:\n\n ![minified code from offer](https://images.ctfassets.net/on47yk52ubpi/31Epwr73YUm6LXbG2H02fL/579dd5df6067e27d57082bd79be6e33c/1_5NLaFzeETXbD1089Vg7H_Q.webp)\n <figure>\n<figcaption>Minified to a single string to make life a little easier. Be careful not to mixup quotation marks in the offer code</figcaption>\n</figure>\n\n```javascript\nasync function getTargetOffer() {\n  let { access_token } = await auth(config);\n  const targetClient = await targetSDK.init(process.env.tenant, config.clientId, access_token);\n  const offer = await targetClient.getOfferById(123456); // not the real offer ID\n  let currentOfferContent = offer.obj.content;\n  \n  // Im using \"700\" here just for illustrative purposes\n  let updatedOfferContent = currentOfferContent.replace(\n    'let message=\"n people viewed this product yesterday!\";',\n    `let message=\"700 people viewed this product yesterday!\";`\n  );\n  console.log(updatedOfferContent);\n}\n```\n\n![offer updated](https://images.ctfassets.net/on47yk52ubpi/7FmPvXkqTnqUL3oFh31D3s/3f79b30e56509e28e9ab8c8679f7c6e5/1_yH5_uVcIeDoRaH3jyWoYmw.webp)\n <figure>\n<figcaption>Finding and replacing the whole message string is the easiest way</figcaption>\n</figure>\n\nSo now that I have my updated offer content (the exact same offer code with just that number changed), I can call the updateOffer method with this new content.\n\n```javascript\nconst updateOffer = await targetClient.updateOffer(123456, { name: offer.obj.name, content: updatedOfferContent });\n```\n\nWhen using Target APIs, the UI is often slow to update. So if I were to go check in the offers UI I’d likely still see “n” instead of “700”. \nHowever, the delivery API uses the newest version when serving activities so the change would take effect almost immediately.\n\n![700 people gif](https://images.ctfassets.net/on47yk52ubpi/35K6AKBStZihcoU3rxJfKJ/081adffc03606e32c90b1404f851194a/1__uRqmCAh9ux8i6HVMh1ylA.gif)\n <figure>\n<figcaption>Wow!</figcaption>\n</figure>\n\n---\n\n## Putting it all together...\n\nSo now lets put it all together. Call Adobe Analytics for the data from yesterday, extract that number, and update the Target offer with that new number:\n\n```javascript\nconst auth = require('@adobe/jwt-auth');\nconst dotenv = require('dotenv');\nconst targetSDK = require('@adobe/aio-lib-target');\nconst aaSDK = require('@adobe/aio-lib-analytics');\n\n// get my env variables\ndotenv.config();\n\n// Adobe API Config vars\nconst config = {\n  clientId: process.env.clientId,\n  clientSecret: process.env.clientSecret,\n  technicalAccountId: process.env.technicalAccountId,\n  orgId: process.env.orgId,\n  metaScopes: ['ent_analytics_bulk_ingest_sdk', 'ent_marketing_sdk'],\n  privateKey: process.env.privateKey.replace(/\\\\n/g, '\\n'), // make the PK readable as a string\n};\nconst today = new Date();\nconst todayDate = today.toISOString().split('T')[0];\nconst yesterday = today.setDate(today.getDate() - 1);\nconst yesterdayDate = new Date(yesterday).toISOString().split('T')[0];\n\n// the query is truncated here, it may be longer in actuality\nconst query = {\n  rsid: process.env.rsid,\n  globalFilters: [\n    {\n      type: 'dateRange',\n      dateRange: `${yesterdayDate}T00:00:00.000/${todayDate}T00:00:00.000`,\n    },\n  ],\n  metricContainer: {\n    metrics: [\n      {\n        columnId: '0',\n        id: 'metrics/visitors',\n        sort: 'desc',\n      },\n    ],\n  },\n  dimension: 'variables/page',\n// etc \n// etc\n}\n\nasync function getAAData() {\n  // get bearer token\n  let { access_token } = await auth(config);\n\n  //initialize sdk\n  const aaClient = await aaSDK.init(process.env.companyId, config.clientId, access_token);\n\n  // Query the data\n  const myReport = await aaClient.getReport(query);\n  let { rows } = myReport.obj;\n\n  // the first number in the first data row\n  let number = rows[0].data.pop();\n  return number;\n}\n\nasync function updateTargetOffer() {\n  let { access_token } = await auth(config);\n  const targetClient = await targetSDK.init(process.env.tenant, config.clientId, access_token);\n  const offer = await targetClient.getOfferById(process.env.offerID); // not the real offer ID\n  const number = await getAAData();\n  let currentOfferContent = offer.obj.content;\n  let updatedOfferContent = currentOfferContent.replace(\n    /let message=\".+ people viewed this product yesterday!\"/g,\n    `let message=\"${number.toLocaleString('en-us')} people viewed this product yesterday!\";`\n  );\n  const updateOffer = await targetClient.updateOffer(process.env.offerID, { name: offer.obj.name, content: updatedOfferContent });\n  return updateOffer;\n}\n\nupdateTargetOffer();\n```\n\nA few things to call out in the code above:\n\n* Metascopes in the configuration; In addition to API setup in the developer console, you have to make sure you are using the correct metascopes in your API calls. [More on metascopes here](https://developer.adobe.com/developer-console/docs/guides/authentication/JWT/Scopes/).\n* The regex replacement for the message content is intentionally vague to account for punctuation in number formatting. Also, it is an actual regex now because after the first run, the message will have a number in it instead of *“n”*\n* The number string uses USA style formatting using the *toLocaleString* method. It would be cool to dynamically set this with Target geo profiling somehow…\n* Calling *updateOffer* requires the offer name for some reason even though you are already sending the ID…\n* I moved the offer ID to an environment variable to make this code more reusable. You could also move it to a command line argument.\n\n![updated offer code from api](https://images.ctfassets.net/on47yk52ubpi/1NUlRWMX1kuQfifEmljYnr/5372b421acffecf1d1f849e93b344545/1_YeEPYEnlFlPubE36yC6rfQ.webp)\n <figure>\n<figcaption>Actual, formatted number of unique visitors to a page in an offer and ready to be served via an Activity</figcaption>\n</figure>\n\n![working popup](https://images.ctfassets.net/on47yk52ubpi/2G9o1gc0y6MlFxMx9DFX3H/1bce0c185a940969d3a77204a765a503/1_Hz8qdbiWIV95i5wyPntVoQ.gif)\n<figure>\n<figcaption>A Target offer that uses real data!</figcaption>\n</figure>\n \n![updated offer code in target ui](https://images.ctfassets.net/on47yk52ubpi/7oNoiB9WCc99jUYgUdZjW3/a96ac93a679a1f2e1ee5c1457a1aadd5/1_S7gWx9CyeVmvHRprNRinjw.webp)\n<figure>\n<figcaption>Remember that the UI won’t update immediately, but it will update eventually!</figcaption>\n</figure>\n\n## Automation & Conclusion\n\nIn order for this setup actually useful, it needs to be automated to run every day so that the offer always shows the previous day’s data. \nSince the activity just serves the offer, there is no need to touch the activity once it is activated. It will just serve the latest version of the offer whatever that happens to be.\n\nThere are a few options for automating the offer update code daily. A cron job on a linux virtual machine or via an AWS Lambda\n with AWS Event Bridge are the two most obvious choices. There are plently of resources out there to help you learn about those!\n\nFollowing all the steps above and putting the code into an automation process will allow you to run a Target experience that shows an offer that shows real data!",
      "code": "var Component=(()=>{var p=Object.create;var o=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{for(var c in s)o(a,c,{get:s[c],enumerable:!0})},l=(a,s,c,n)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let t of h(s))!u.call(a,t)&&t!==c&&o(a,t,{get:()=>s[t],enumerable:!(n=d(s,t))||n.enumerable});return a};var f=(a,s,c)=>(c=a!=null?p(m(a)):{},l(s||!a||!a.__esModule?o(c,\"default\",{value:a,enumerable:!0}):c,a)),g=a=>l(o({},\"__esModule\",{value:!0}),a);var r=N((A,i)=>{i.exports=_jsx_runtime});var v={};k(v,{default:()=>b,frontmatter:()=>y});var e=f(r()),y={title:\"Using data from Adobe Analytics in Adobe Target Offers\",date:\"2022-12-16\",tags:[\"adobe analytics\",\"adobe target\",\"testing\"],draft:!1,summary:\"How to use data pulled from Adobe Analytics in an Adobe Target offer.\"};function w(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(c,{})})):c();function c(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",em:\"em\",strong:\"strong\",img:\"img\",ul:\"ul\",li:\"li\",hr:\"hr\",pre:\"pre\",code:\"code\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"do-social-proof-ctas-actually-work\",children:[(0,e.jsx)(n.a,{href:\"#do-social-proof-ctas-actually-work\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Do social proof CTAs actually work?\"]}),(0,e.jsxs)(n.p,{children:[\"I\\u2019m sure everyone has seen those popups on online stores that say something like \",(0,e.jsx)(n.em,{children:\"\\u201C15 people are viewing this product right now!\\u201D\"}),\" or \",(0,e.jsx)(n.em,{children:\"\\u201C105 other people from Michigan bought this yesterday!\\u201D\"}),\". I actually looked around for one in the wild to include a screenshot, but of course, when I need one, I can\\u2019t find one. Anyway, I\\u2019m going to build one of those in Target that uses \",(0,e.jsx)(n.strong,{children:\"real data\"}),\" pulled from Adobe Analytics.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"popupexample\",src:\"https://images.ctfassets.net/on47yk52ubpi/LX2R2PAXrJFZyJDVmeppD/48d92270accf82b3eb77bf992fcb291f/1_eDd83lpg7ihAxJgoYkfOcw.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"This type of thing!\"})}),(0,e.jsxs)(n.p,{children:[\"In this example, for simplicity, lets say I have a product page, running an A/B activity in Target for all visitors. 50% of visitors to this page will get a pop up that \\u201Cencourages\\u201D them to make a purchase by saying something like: \",(0,e.jsx)(n.em,{children:\"\\u201Cn-number of people viewed this product yesterday!\\u201D\"}),\" and the other 50% of visitors will get the default experience of no such popup. The \",(0,e.jsx)(n.em,{children:\"n-number\"}),\" used in the popup content will be a real number of unique visitors who viewed that product page yesterday just as it is reflected in an Adobe Analytics Workspace table. The number will change daily to reflect the previous day\\u2019s data relative to the current date; i.e. a visitor on the 12th will see data from the 11th, a visitor on the 13th will see data from the 12th, etc.\"]}),(0,e.jsxs)(n.p,{children:[\"The example I create will be trivial, but concepts will apply to showing \",(0,e.jsx)(n.em,{children:\"anything\"}),\" from a workspace table in a Target offer!\"]}),(0,e.jsxs)(n.h2,{id:\"general-overview\",children:[(0,e.jsx)(n.a,{href:\"#general-overview\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"General overview\"]}),(0,e.jsxs)(n.p,{children:[\"As with \",(0,e.jsx)(n.em,{children:\"almost\"}),\" everything I write about these days, for the sake of brevity, I have to assume some prior knowledge of the \",(0,e.jsx)(n.a,{href:\"https://developer.adobe.com/developer-console/\",children:\"Adobe Developer Console\"}),\", some programming experience, and familiarity with Target and Adobe Analytics terminology.\"]}),(0,e.jsx)(n.p,{children:\"Here are the steps:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Hack together the popup element using a placeholder number.\"}),(0,e.jsx)(n.li,{children:\"Save the code from above as a Target Offer. Note the offer ID after saving.\"}),(0,e.jsxs)(n.li,{children:[\"Build the activity in Target with the 2 experiences using the \",(0,e.jsx)(n.a,{href:\"https://experienceleague.adobe.com/docs/target/using/experiences/form-experience-composer.html?lang=en\",children:\"form composer\"}),\" and set the delivery content in the variant experience to be the offer I just saved above.\"]}),(0,e.jsxs)(n.li,{children:[\"In workspace now, build a report that shows the number I want to display in the offer. Use the \",(0,e.jsx)(n.a,{href:\"https://developer.adobe.com/cja-apis/docs/endpoints/reporting/debugger/\",children:\"Oberon debugger\"}),\" to grab the parameters used to make that report as JSON.\"]}),(0,e.jsx)(n.li,{children:\"Setup a developer console project that has access to the Target API and the Adobe Analytics API. I will need the API keys in the next step.\"}),(0,e.jsxs)(n.li,{children:[\"Write some NodeJS using the \",(0,e.jsx)(n.a,{href:\"https://www.npmjs.com/search?q=adobe%20aio\",children:\"Adobe AIO libraries\"}),\" to pull that number from workspace and update your Target offer to use that number.\"]}),(0,e.jsx)(n.li,{children:\"Automate the NodeJS above to update the offer with new data every day (or however often you want it to update)\"}),(0,e.jsx)(n.li,{children:(0,e.jsx)(n.em,{children:\"Note: For this example lets assume its a desktop only audience. I would never willingly encourge anyone to put a popup on mobile!\"})})]}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.h2,{id:\"build-the-popup\",children:[(0,e.jsx)(n.a,{href:\"#build-the-popup\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Build the popup\"]}),(0,e.jsx)(n.p,{children:\"Since I will be serving a chunk of HTML as my Target offer, I need a self contained, complete piece of code that builds the popup, styles it, etc. You could simplify this part by just replacing some static text like a headline or CTA, but I already said popup and my delete key is broken. I don\\u2019t remember the keyframes syntax for having things animate directionally in, so lets just have the popup fade in:\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" popup \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"document\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"createElement\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'div'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"popup\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"id\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'popup'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" content \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"document\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"createElement\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'p'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" keyframes \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"document\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"createElement\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'style'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"keyframes\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"innerText\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'#popup {font-weight: bold !important;height: 100px !important;width: 350px !important;background-color: #fff !important;border: 3px solid red !important;position: absolute !important;bottom: 0 !important;margin: 1em !important;padding: 1em !important;border-radius: 1em !important;-webkit-animation: popin 4s forwards !important;animation-name: popin 4s forwards !important;}@-webkit-keyframes popin {from {opacity: 0;}to {opacity: 1;}}@keyframes popup {from {opacity: 0;}to {opacity: 1;}}'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"document\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"querySelector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'head'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"insertAdjacentElement\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'beforeend'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" keyframes\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" message \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'n people viewed this product yesterday!'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"content\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"innerText\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"popup\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"appendChild\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"content\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token dom variable\",children:\"document\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"querySelector\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'body'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"appendChild\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"popup\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"n number of people viewed\",src:\"https://images.ctfassets.net/on47yk52ubpi/6NXOVx8Iv1YkEfzXiVsSVE/ddcb853ac246f7ae28fb0cd2b27ebcc2/1_d_7nt3bXF98bud9bwPeG8w.gif\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"An incredibly enticing popup box with placeholder content. Who are you to resist it?!\"})}),(0,e.jsxs)(n.h2,{id:\"save-it-as-an-offer\",children:[(0,e.jsx)(n.a,{href:\"#save-it-as-an-offer\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Save it as an offer\"]}),(0,e.jsx)(n.p,{children:\"Now that I have the popup I want to serve in one of my Target experiences, I need to save it as an offer. Once it is saved as an offer, I will be able to deliver it in any Activity and more easily interact with it via the Target API.\"}),(0,e.jsxs)(n.p,{children:[\"Since I am technically delivering HTML in need to wrap this code in a \",(0,e.jsx)(n.code,{children:\"<script>\"}),\" tag so it is valid HTML: \",(0,e.jsx)(n.img,{alt:\"save as offer\",src:\"https://images.ctfassets.net/on47yk52ubpi/6hwD3HxzfppywMRNNlG63X/0dbc6c41ded784fc5b7843434904f592/1_jQclFe_vk_L19eG8ccRYJw.webp\"})]}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"New HTML Offer\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"fake offer code\",src:\"https://images.ctfassets.net/on47yk52ubpi/61fP41uUz2haec6Psdc9hH/ac43f41dd9ed00c448e43df0a7d2f8ee/1_Mxm-OiWKLPnEQwiXPCCQuQ.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Make sure the code your delivering is valid HTML\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"grab the offer id\",src:\"https://images.ctfassets.net/on47yk52ubpi/2N45TpzFFe6BqcrJiZU54M/3e68a814c42c7b11b3a0eca89839e4dd/1__B06TB_Y1Pu3Es7j6sjjHw.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Grab the offer ID while you are here!\"})}),(0,e.jsx)(n.p,{children:\"Once the offer is saved, bring up this info box by clicking the (i) icon in the modify column and save the Offer ID for later!\"}),(0,e.jsxs)(n.h2,{id:\"build-the-activity-in-target\",children:[(0,e.jsx)(n.a,{href:\"#build-the-activity-in-target\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Build the Activity in Target\"]}),(0,e.jsxs)(n.p,{children:[\"If you\\u2019ve never used the form composer, its a little difference than the VEC. You need to have all the specifics of your Activity ready to go. \",(0,e.jsx)(n.a,{href:\"https://experienceleague.adobe.com/docs/target/using/experiences/form-experience-composer.html?lang=en\",children:\"The official form composer docs are here\"}),\".\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"form composer setup\",src:\"https://images.ctfassets.net/on47yk52ubpi/MIMchv6VFEDvOHN1zemC7/49dbf7c0d32566dc11372b188c4b0047/1_vOKzHvOkgSAr-xc0GD1ElQ.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"The setup for my popup offer experience in Target\"})}),(0,e.jsx)(n.p,{children:\"That\\u2019s it in the Target UI until its time to activate the test!\"}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.h2,{id:\"getting-the-data-i-want-to-use-in-my-offer-from-adobe-analytics\",children:[(0,e.jsx)(n.a,{href:\"#getting-the-data-i-want-to-use-in-my-offer-from-adobe-analytics\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Getting the data I want to use in my Offer from Adobe Analytics\"]}),(0,e.jsxs)(n.p,{children:[\"The first step to being able to pull the data I want via the API is to generate it from a report in workspace. While this is not \",(0,e.jsx)(n.em,{children:\"technically\"}),\" necessary, Adobe\\u2019s Oberon debugging tool makes interacting with the reporting API \",(0,e.jsx)(n.strong,{children:\"much, much\"}),\" easier. Here\\u2019s what my desired data looks like in workspace, the number of unique visitors to my product page yesterday:\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"workspace setup data\",src:\"https://images.ctfassets.net/on47yk52ubpi/4qBPqYz8ZxiC8Fwp2Nhqz2/0bfe5046a76fd2555d2ecbe69f5b2827/1_arBiuRigeG2U0Vy2VMLhug.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"1,388 will change every day. Thus the number in the pop up will change every day!\"})}),(0,e.jsxs)(n.p,{children:[\"In order to view (and steal) the underlying API query that made this report, I need to first enable the debugger. To do so, make sure the project is saved and go to \",(0,e.jsx)(n.em,{children:\"Help > Enable Debugger\"}),\". Enabling the debugger will add this little bug guy to your freeform tables. Click it, and you can see the underlying JSON & XML queries the Adobe Analytics API used to generate the data for the table. Depending on how much work you have done on the table, you will also see historical snapshots of queries it has used.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"enable debugger\",src:\"https://images.ctfassets.net/on47yk52ubpi/5VnYOncJiVuPpjXPcebhPx/ff6502e88fa2f01199dc22e31afe0006/1_kJPPtqkeyVlhteJYYaMu4Q.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"How to enable the debugger\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"oberon bug\",src:\"https://images.ctfassets.net/on47yk52ubpi/5EGfYGHehMBVWNWFtFiyva/fc2b64be16a2d61dd5805db5567567de/1_AFq2k7pVu2MIEW2fjvMr3g.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Click the little bug fella in your panel\"})}),(0,e.jsx)(n.p,{children:\"This is what I am looking for inside the debug view. I will use this chunk of JSON later on when I need to programmatically pull this data.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"oberon json\",src:\"https://images.ctfassets.net/on47yk52ubpi/3LVKr2P63ZnjvRAH4DWwum/d7cab2b8604e7456a37933042a9551b4/1_X9x755hhoK5lcxlHTZ3t6A.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"This is the JSON that Workspace uses to query Adobe Analytics data! In the UI there will also be the response from the API just to the right of here where you will see the data represented.\"})}),(0,e.jsx)(n.p,{children:\"Jumping ahead a little bit, when I make this call via the Node SDK, you can see that the data is the same as in workspace. That is because I am doing the exact same thing workspace is doing!\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" auth \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/jwt-auth'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" aaSDK \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/aio-lib-analytics'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" dotenv \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'dotenv'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// get my env variables\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dotenv\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Adobe API Config vars\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  clientId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  clientSecret\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientSecret\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  technicalAccountId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"technicalAccountId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  orgId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"orgId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  metaScopes\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'ent_analytics_bulk_ingest_sdk'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  privateKey\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"privateKey\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"replace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token regex\",children:[(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsxs)(n.span,{className:\"token language-regex regex-source\",children:[(0,e.jsx)(n.span,{className:\"token escape special-escape\",children:\"\\\\\\\\\"}),\"n\"]}),(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'\\\\n'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// make the PK readable as a string\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// json query goes here, I left it out here to save space\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" query \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getAAData\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// get bearer token\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" access_token \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"auth\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//initialize sdk\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" aaClient \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" aaSDK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"companyId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" access_token\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Query the data\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" myReport \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" aaClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"getReport\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token class-name console\",children:\"console\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"log\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token class-name known-class-name\",children:\"JSON\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"stringify\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"myReport\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"obj\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"rows\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword nil null\",children:\"null\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"4\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"getAAData\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"code output\",src:\"https://images.ctfassets.net/on47yk52ubpi/7m583CXdTSSElIfI8aQqot/be989732335a7052055ae3cf4f5249ee/1_q7TZUjU8IY2rmmnAVwGFfQ.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"1388! The same number from workspace!\"})}),(0,e.jsxs)(n.h2,{id:\"making-the-query-dynamic\",children:[(0,e.jsx)(n.a,{href:\"#making-the-query-dynamic\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Making the query dynamic\"]}),(0,e.jsx)(n.p,{children:\"In order to make my query dynamic and return the data from the previous day, I need to inject the previous date into it. Although the workspace date range says \\u201CYesterday\\u201D, in the query you can see it uses actual dates instead of a keyword:\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"globalFilters\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      type\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'dateRange'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      dateRange\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'2022-12-13T00:00:00.000/2022-12-14T00:00:00.000'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"This is good though, because that means I can just replace the hardcoded dates with whatever date range I want. In this case, the dates of \\u201Ctoday\\u201D and \\u201Cyesterday\\u201D\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" today \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Date\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" todayDate \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" today\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"toISOString\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"split\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'T'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" yesterday \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" today\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"setDate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"today\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"getDate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" yesterdayDate \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Date\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"yesterday\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"toISOString\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"split\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'T'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" query \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" rsid\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"rsid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" globalFilters\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     type\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'dateRange'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"     dateRange\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsxs)(n.span,{className:\"token template-string\",children:[(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"yesterdayDate\",(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\"T00:00:00.000/\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"todayDate\",(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\"T00:00:00.000\"}),(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"   \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" etc etc \",(0,e.jsx)(n.span,{className:\"token operator spread\",children:\"...\"}),(0,e.jsx)(n.span,{className:\"token operator spread\",children:\"...\"}),(0,e.jsx)(n.span,{className:\"token operator spread\",children:\"...\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"There\\u2019s probably a more elegant way to do this way a newer date library from NPM, but this works. So now my report will always pull the previous day\\u2019s data, relative to the current date. Exactly the data I want to use in my dynamic offer.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.strong,{children:\"A note when automating: make sure you know the timezone of your server! Dates might be different if its using UTC.\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"different data\",src:\"https://images.ctfassets.net/on47yk52ubpi/4juJYuay1gamPWmHNwkx89/8d71d3ed102b35f9bd9edbeb0acbc071/1_O2hmfCedbg4zFwFwejprfA.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"I continued writing this post the next day, thus my data has changed!\"})}),(0,e.jsxs)(n.h2,{id:\"updating-the-offer\",children:[(0,e.jsx)(n.a,{href:\"#updating-the-offer\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Updating the offer\"]}),(0,e.jsxs)(n.p,{children:[\"Now that I can get the data I need from Adobe Analytics. I want to take that data and put it into my offer programmatically. To do this, I can use the \",(0,e.jsx)(n.a,{href:\"https://www.npmjs.com/package/@adobe/aio-lib-target\",children:\"Target AIO Library\"}),\" to get the offer, replace the data, and update it. First lets get the offer:\"]}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" auth \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/jwt-auth'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" dotenv \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'dotenv'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" targetSDK \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/aio-lib-target'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// get my env variables\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dotenv\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Adobe API Config vars\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" clientId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" clientSecret\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientSecret\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" technicalAccountId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"technicalAccountId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" orgId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"orgId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" metaScopes\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'ent_analytics_bulk_ingest_sdk'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'ent_marketing_sdk'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" privateKey\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"privateKey\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"replace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token regex\",children:[(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsxs)(n.span,{className:\"token language-regex regex-source\",children:[(0,e.jsx)(n.span,{className:\"token escape special-escape\",children:\"\\\\\\\\\"}),\"n\"]}),(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'\\\\n'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// make the PK readable as a string\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getTargetOffer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" access_token \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"auth\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" targetClient \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetSDK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"tenant\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" access_token\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" offer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"getOfferById\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"123456\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// fake offer number\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\" \",(0,e.jsx)(n.span,{className:\"token class-name console\",children:\"console\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"log\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"offer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"getTargetOffer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"aio get offer\",src:\"https://images.ctfassets.net/on47yk52ubpi/3iTnQZtHZa7ul6dKfCpCFM/db02d0020659fbbe29576d61b5e5bc26/1_-71ZJ5X20ODZ_I4Y8Zc9lA.webp\"})}),(0,e.jsxs)(n.p,{children:[\"The contents of the offer (aka the code) can be found in the response under \",(0,e.jsx)(n.em,{children:\"obj.content\"}),\". I will be calling this offer, getting its current content, replacing the number that is currently in the message with the latest one from workspace, then calling the update function to update the content.\"]}),(0,e.jsx)(n.p,{children:\"There\\u2019s a couple ways to do this, but the easiest is probably regex replace. The tricky part here is the content gets returned as a bunch of concatenated strings because Target is keeping the spacing that was present when I originally saved the offer. To make things a little easier on myself, I\\u2019m going to go open my offer in the Target UI, grab the code, and minify it. Then when I use the API, the offer content gets returned to me as a single string which I can use regex replace on:\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"minified code from offer\",src:\"https://images.ctfassets.net/on47yk52ubpi/31Epwr73YUm6LXbG2H02fL/579dd5df6067e27d57082bd79be6e33c/1_5NLaFzeETXbD1089Vg7H_Q.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Minified to a single string to make life a little easier. Be careful not to mixup quotation marks in the offer code\"})}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getTargetOffer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" access_token \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"auth\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" targetClient \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetSDK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"tenant\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" access_token\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" offer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"getOfferById\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"123456\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// not the real offer ID\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" currentOfferContent \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" offer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"obj\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"content\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`  \n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:'// Im using \"700\" here just for illustrative purposes'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" updatedOfferContent \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" currentOfferContent\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"replace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:`'let message=\"n people viewed this product yesterday!\";'`}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token template-string\",children:[(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'let message=\"700 people viewed this product yesterday!\";'}),(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token class-name console\",children:\"console\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"log\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"updatedOfferContent\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"offer updated\",src:\"https://images.ctfassets.net/on47yk52ubpi/7FmPvXkqTnqUL3oFh31D3s/3f79b30e56509e28e9ab8c8679f7c6e5/1_yH5_uVcIeDoRaH3jyWoYmw.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Finding and replacing the whole message string is the easiest way\"})}),(0,e.jsx)(n.p,{children:\"So now that I have my updated offer content (the exact same offer code with just that number changed), I can call the updateOffer method with this new content.\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsx)(n.code,{className:\"language-javascript code-highlight\",children:(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" updateOffer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"updateOffer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"123456\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" offer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"obj\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" content\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" updatedOfferContent \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})})}),(0,e.jsx)(n.p,{children:\"When using Target APIs, the UI is often slow to update. So if I were to go check in the offers UI I\\u2019d likely still see \\u201Cn\\u201D instead of \\u201C700\\u201D. However, the delivery API uses the newest version when serving activities so the change would take effect almost immediately.\"}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"700 people gif\",src:\"https://images.ctfassets.net/on47yk52ubpi/35K6AKBStZihcoU3rxJfKJ/081adffc03606e32c90b1404f851194a/1__uRqmCAh9ux8i6HVMh1ylA.gif\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Wow!\"})}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.h2,{id:\"putting-it-all-together\",children:[(0,e.jsx)(n.a,{href:\"#putting-it-all-together\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Putting it all together...\"]}),(0,e.jsx)(n.p,{children:\"So now lets put it all together. Call Adobe Analytics for the data from yesterday, extract that number, and update the Target offer with that new number:\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"language-javascript code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" auth \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/jwt-auth'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" dotenv \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'dotenv'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" targetSDK \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/aio-lib-target'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" aaSDK \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"require\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'@adobe/aio-lib-analytics'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// get my env variables\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"dotenv\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"config\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Adobe API Config vars\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" config \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  clientId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  clientSecret\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientSecret\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  technicalAccountId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"technicalAccountId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  orgId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"orgId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  metaScopes\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'ent_analytics_bulk_ingest_sdk'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'ent_marketing_sdk'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  privateKey\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"privateKey\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"replace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token regex\",children:[(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsxs)(n.span,{className:\"token language-regex regex-source\",children:[(0,e.jsx)(n.span,{className:\"token escape special-escape\",children:\"\\\\\\\\\"}),\"n\"]}),(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'\\\\n'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// make the PK readable as a string\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" today \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Date\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" todayDate \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" today\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"toISOString\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"split\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'T'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" yesterday \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" today\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"setDate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"today\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"getDate\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"-\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"1\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" yesterdayDate \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"new\"}),\" \",(0,e.jsx)(n.span,{className:\"token class-name\",children:\"Date\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"yesterday\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"toISOString\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"split\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'T'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// the query is truncated here, it may be longer in actuality\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" query \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  rsid\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"rsid\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  globalFilters\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      type\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'dateRange'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      dateRange\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsxs)(n.span,{className:\"token template-string\",children:[(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"yesterdayDate\",(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\"T00:00:00.000/\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"todayDate\",(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\"T00:00:00.000\"}),(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  metricContainer\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    metrics\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        columnId\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'0'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        id\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'metrics/visitors'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        sort\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'desc'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  dimension\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'variables/page'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// etc \"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"// etc\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getAAData\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// get bearer token\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" access_token \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"auth\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"//initialize sdk\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" aaClient \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" aaSDK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"companyId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" access_token\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// Query the data\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" myReport \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" aaClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"getReport\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"query\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" rows \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" myReport\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"obj\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// the first number in the first data row\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" number \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" rows\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"data\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"pop\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" number\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"async\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"function\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"updateTargetOffer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" access_token \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"auth\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" targetClient \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetSDK\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"init\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"tenant\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" config\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"clientId\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" access_token\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" offer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"getOfferById\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"offerID\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),\" \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"// not the real offer ID\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" number \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"getAAData\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" currentOfferContent \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" offer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"obj\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"content\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"let\"}),\" updatedOfferContent \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" currentOfferContent\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"replace\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token regex\",children:[(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsxs)(n.span,{className:\"token language-regex regex-source\",children:['let message=\"',(0,e.jsx)(n.span,{className:\"token class-name charclass\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token number quantifier\",children:\"+\"}),' people viewed this product yesterday!\"']}),(0,e.jsx)(n.span,{className:\"token regex-delimiter\",children:\"/\"}),(0,e.jsx)(n.span,{className:\"token regex-flags\",children:\"g\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsxs)(n.span,{className:\"token template-string\",children:[(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'let message=\"'}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"${\"}),\"number\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"toLocaleString\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'en-us'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation interpolation-punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:' people viewed this product yesterday!\";'}),(0,e.jsx)(n.span,{className:\"token string template-punctuation\",children:\"`\"})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"const\"}),\" updateOffer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"await\"}),\" targetClient\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access function method\",children:\"updateOffer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"process\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"env\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"offerID\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\" name\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" offer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"obj\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),(0,e.jsx)(n.span,{className:\"token property-access\",children:\"name\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" content\",(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" updatedOfferContent \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token keyword control-flow\",children:\"return\"}),\" updateOffer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token function\",children:\"updateTargetOffer\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\";\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"A few things to call out in the code above:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[\"Metascopes in the configuration; In addition to API setup in the developer console, you have to make sure you are using the correct metascopes in your API calls. \",(0,e.jsx)(n.a,{href:\"https://developer.adobe.com/developer-console/docs/guides/authentication/JWT/Scopes/\",children:\"More on metascopes here\"}),\".\"]}),(0,e.jsxs)(n.li,{children:[\"The regex replacement for the message content is intentionally vague to account for punctuation in number formatting. Also, it is an actual regex now because after the first run, the message will have a number in it instead of \",(0,e.jsx)(n.em,{children:\"\\u201Cn\\u201D\"})]}),(0,e.jsxs)(n.li,{children:[\"The number string uses USA style formatting using the \",(0,e.jsx)(n.em,{children:\"toLocaleString\"}),\" method. It would be cool to dynamically set this with Target geo profiling somehow\\u2026\"]}),(0,e.jsxs)(n.li,{children:[\"Calling \",(0,e.jsx)(n.em,{children:\"updateOffer\"}),\" requires the offer name for some reason even though you are already sending the ID\\u2026\"]}),(0,e.jsx)(n.li,{children:\"I moved the offer ID to an environment variable to make this code more reusable. You could also move it to a command line argument.\"})]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"updated offer code from api\",src:\"https://images.ctfassets.net/on47yk52ubpi/1NUlRWMX1kuQfifEmljYnr/5372b421acffecf1d1f849e93b344545/1_YeEPYEnlFlPubE36yC6rfQ.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Actual, formatted number of unique visitors to a page in an offer and ready to be served via an Activity\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"working popup\",src:\"https://images.ctfassets.net/on47yk52ubpi/2G9o1gc0y6MlFxMx9DFX3H/1bce0c185a940969d3a77204a765a503/1_Hz8qdbiWIV95i5wyPntVoQ.gif\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"A Target offer that uses real data!\"})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"updated offer code in target ui\",src:\"https://images.ctfassets.net/on47yk52ubpi/7oNoiB9WCc99jUYgUdZjW3/a96ac93a679a1f2e1ee5c1457a1aadd5/1_S7gWx9CyeVmvHRprNRinjw.webp\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"Remember that the UI won\\u2019t update immediately, but it will update eventually!\"})}),(0,e.jsxs)(n.h2,{id:\"automation--conclusion\",children:[(0,e.jsx)(n.a,{href:\"#automation--conclusion\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Automation & Conclusion\"]}),(0,e.jsx)(n.p,{children:\"In order for this setup actually useful, it needs to be automated to run every day so that the offer always shows the previous day\\u2019s data. Since the activity just serves the offer, there is no need to touch the activity once it is activated. It will just serve the latest version of the offer whatever that happens to be.\"}),(0,e.jsx)(n.p,{children:\"There are a few options for automating the offer update code daily. A cron job on a linux virtual machine or via an AWS Lambda with AWS Event Bridge are the two most obvious choices. There are plently of resources out there to help you learn about those!\"}),(0,e.jsx)(n.p,{children:\"Following all the steps above and putting the code into an automation process will allow you to run a Target experience that shows an offer that shows real data!\"})]})}}var b=w;return g(v);})();\n;return Component;"
    },
    "_id": "blog/using-data-from-adobe-analytics-in-adobe-target-offers.mdx",
    "_raw": {
      "sourceFilePath": "blog/using-data-from-adobe-analytics-in-adobe-target-offers.mdx",
      "sourceFileName": "using-data-from-adobe-analytics-in-adobe-target-offers.mdx",
      "sourceFileDir": "blog",
      "contentType": "mdx",
      "flattenedPath": "blog/using-data-from-adobe-analytics-in-adobe-target-offers"
    },
    "type": "Blog",
    "readingTime": {
      "text": "14 min read",
      "minutes": 13.215,
      "time": 792900,
      "words": 2643
    },
    "slug": "using-data-from-adobe-analytics-in-adobe-target-offers",
    "toc": [
      {
        "value": "Do social proof CTAs actually work?",
        "url": "#do-social-proof-ctas-actually-work",
        "depth": 2
      },
      {
        "value": "General overview",
        "url": "#general-overview",
        "depth": 2
      },
      {
        "value": "Build the popup",
        "url": "#build-the-popup",
        "depth": 2
      },
      {
        "value": "Save it as an offer",
        "url": "#save-it-as-an-offer",
        "depth": 2
      },
      {
        "value": "Build the Activity in Target",
        "url": "#build-the-activity-in-target",
        "depth": 2
      },
      {
        "value": "Getting the data I want to use in my Offer from Adobe Analytics",
        "url": "#getting-the-data-i-want-to-use-in-my-offer-from-adobe-analytics",
        "depth": 2
      },
      {
        "value": "Making the query dynamic",
        "url": "#making-the-query-dynamic",
        "depth": 2
      },
      {
        "value": "Updating the offer",
        "url": "#updating-the-offer",
        "depth": 2
      },
      {
        "value": "Putting it all together...",
        "url": "#putting-it-all-together",
        "depth": 2
      },
      {
        "value": "Automation & Conclusion",
        "url": "#automation--conclusion",
        "depth": 2
      }
    ]
  },
  {
    "title": "Syncing Adobe Launch/Tags with Github - Part 2: The Github Push Webhook",
    "date": "2023-04-26T00:00:00.000Z",
    "tags": [
      "adobe launch",
      "adobe tags",
      "javascript",
      "github",
      "automation"
    ],
    "draft": false,
    "summary": "How to use Github to build, sync, & deploy custom code directly to Adobe Launch/Tags - Part 2",
    "body": {
      "raw": "\n## The Github push webhook\n\nAfter the setup that I mentioned in the [first post](https://www.perpetua.digital/blog/launch-github-sync-part-1) is completed,\nI can tap into the Github push webhook to kickoff the syncing between\nGithub and Launch. This webhook will notify my API that some file modifications have\noccurred in Github and that those changes that _may_ require updates to Launch components.\nI say _may_ here because the Github push webhook will notify me of _all_ file modifications in my\nrepository and it will be up to me to determine what, if anything, needs to be synced with Launch.\n\nThe Github push webhook also introduces the first layer of security in the form of a\n[Webhook secret](https://docs.github.com/en/webhooks-and-events/webhooks/securing-your-webhooks#setting-your-secret-token).\nThis allows me to verify calls made to the API. More on that later.\n\nSo what exactly is webhook? Off the top of my head, and by that, I mean according to ChatGPT, a webhook is:\n\n> a way for two applications to communicate with each other in real-time. It is a type of API (Application Programming Interface) that allows one application to send data to \\ another application automatically whenever a certain event occurs.\n>\n> Webhooks work by sending a notification to a URL endpoint that is specified by the receiving application. This notification typically contains a payload of data that describes the event that triggered the webhook.\n\nIn order to start receiving notifications from Github about file updates via the push webhook, I need to do 2 things:\n\n- Build and API endpoint for the webhook to send its POST requests to\n- Configure that endpoint as a webhook in my Github repo\n\nI'll start with building an endpoint...\n\n## My API for receiving Github push webhooks\n\nFortunately for me, going super in-depth about building and hosting API endpoints is\nbeyond the scope of this little blog I got going here. If you are new to such things, I\n_highly_ suggest reading about building APIs in [Flask](https://pythonbasics.org/flask-rest-api/)\nfor Python (what I used) or [Express](https://medium.com/makers-byte/building-a-restful-api-with-express-js-a-beginners-guide-dcb1a1e3520d) for Node.\nOnce built, you then need to host your endpoint server somewhere public so Github can access it.\nLots of options here, the most obvious (and easiest IMO) AWS\n[web hook gateways](https://medium.com/mindorks/building-webhook-is-easy-using-aws-lambda-and-api-gateway-56f5e5c3a596).\n\nBelow is the [Flask route](https://exploreflask.com/en/latest/views.html) for my endpoint that will\nreceive and handle pushes from Github. If you've never worked in Flask or made an API before, it might look a\nlittle complicated, and yes it is truncated for brevity, but it really only does a couple things:\n\n- `@verify_github_webhook_secret` is a Python decorator that makes sure any POST requests\n  to this route not only come from Github, but come from me, specifically.\n- `modified_data_element_files` is a `list` of all the data element files that have been updated\n  in this push. If there are _zero_ changed data element files, like if I updated a `README.md` file,\n  the entire flow stops here. No need to sync with Launch.\n- The `dict` called `data` contains all the information I will need about this push to look up the\n  _actual content_ of the files. The push webhook only says that contents was modified, but not\n  specifically what those modifications were.\n- Finally, if everything checks out, I invoke the next Lambda in the flow which will call the github\n  API to extract the specific file contents which will prepare them for the Launch API. _In my actual code\n  `FunctionName` is the name of the next lambda I call._\n\n```python\n@app.route(\"/github-webhook-handler\", methods=['POST'])\n@verify_github_webhook_secret\ndef github_webhook():\n    try:\n        try:\n            payload = request.get_json()\n            modified_files = payload['head_commit']['modified']\n            author_name = payload['head_commit']['author']['name']\n            owner = payload['head_commit']['author']['username']\n            repo = payload['repository']['name']\n            ref = payload['ref']\n        except Exception:\n            return make_response(jsonify(error='Error parsing github data from request'), 400)\n\n        # find modified data elements files\n        modified_data_element_files = [\n            file for file in modified_files if file.startswith(\"dataelements\")]\n\n        # the request was successful, no action needs to be taken\n        if len(modified_data_element_files) == 0:\n            return make_response(jsonify(message='No files in the data elements directory have been modified'), 204)\n\n        # everything is good - trigger the lambda - the lambda does the launch updating!\n        data = {\n            \"message\": \"OK\",\n            \"modified_data_element_files\": modified_data_element_files,\n            \"author_name\": author_name,\n            \"owner\": owner,\n            \"repo\": repo,\n            \"ref\": ref\n        }\n\n        # invoke the next lambda here\n        client = boto3.client('lambda')\n        response = client.invoke(\n            FunctionName='some fake name here',\n            InvocationType='Event',\n            Payload=json.dumps(data)\n        )\n        # return success\n        response_data = {\n            \"statusCode\": 200,\n            \"body\": data\n        }\n        return make_response(jsonify(response_data), 200)\n    except Exception as e:\n        return make_response(jsonify(error=f'Error {e}'), 500)\n```\n\nBy far, the easiest way to create and deploy AWS Lambdas and API Gateways is through the\n[Serverless](https://www.serverless.com/) framework. It takes care of the drudgery of uploading\npackages to AWS and has a nicer UI. Highly recommended.\n\nOnce I get this API deployed, I'm going to have a publicly reachable route to POST to.\nFirst task complete. It is this URL that I will then configure inside of Github.\n\nMy deployed API will have a route that will look _something_ like the URL below. Notice how the path `github-webhook-handler`\nis the path I defined in `@app.route` above.\n\n`https://fakedatahere.execute-api.aws-region-name-here.amazonaws.com/github-webhook-handler`\n\n---\n\n## Setting up a Push webhook on a Github repo\n\nNow that I have my endpoint URL all set up and running in \"the cloud\",\nI need to tell my Github repo to post to it on Push events. To do that,\nI go into my Repo and go to `Settings > Webhooks > Add Webhook`.\n\n![IMAGE OF ADD webhook SCREEN](https://images.ctfassets.net/on47yk52ubpi/3OVr7rQodGU65n9i6iZMiG/7f86e59fe320e74d868b34602e5ad2e9/Screenshot_2023-04-20_at_11.49.56_PM.png)\n\nThe endpoint URL I made goes in `payload url` and I need to [generate a random\nstring](https://www.random.org/strings/) for a secret and save it somewhere safe.\nAgain, my `Secret` value is used in the `@verify_github_webhook_secret` decorator to verify\nrequests that the API receives.\n\nOnce the webhook is setup, I can QA that it's working by doing some push events and\nchecking the **Recent Deliveries** section. If something is broken, like I pasted the wrong URL\nor there is an authentication error, it will show here.\n\n![IMAGE OF RECENT DELIVERIES](https://images.ctfassets.net/on47yk52ubpi/4x3o3ACbRyF7o2eq7xUFwp/8653cb21c4fe50e96a98b4be1bb4e14e/Screenshot_2023-04-20_at_11.51.55_PM.png)\n\n## In action\n\nSo there is not much to look at, but here is a recap of what happens in the first step of the *Github to Launch sync *flow when\nI update a file on Github that needs to be synced with a Launch component:\n\n1. I push to the `main` branch of my Github repo\n2. Github triggers the push webhook and sends a POST request to my API\n3. My API reads the data from the webhook request and determines if there are file changes that need to be updated in Launch.\n4. If changes need to be synced, the API gathers the information required to pull the actual file contents from Github (which takes place in the next step) and triggers the next lambda in the flow.\n\nHere is the response from the Push webhook showing my success message when I update my [host.js data element file.](https://github.com/perpetua-digital/launch-property/blob/main/data_elements/host.js)\n\n![recent delivery success](https://images.ctfassets.net/on47yk52ubpi/3WVlI9MZO586tSm2NsL9v5/47163aa6dbe67f5eebb3372f72aeaa9c/recentdeliverysuccess.png)\n\nI can't show the whole JSON response, but it should look familiar:\n\n```python\ndata = {\n            \"message\": \"OK\",\n            \"modified_data_element_files\": modified_data_element_files,\n            \"author_name\": author_name,\n            \"owner\": owner,\n            \"repo\": repo,\n            \"ref\": ref\n        }\n\n```\n\n## Next up\n\nSo I've been notified that a change has occurred that needs to be reflected in Launch.\nNext up, grab that actual contents of those file changes and prepare to send them to\n[the Launch API.](https://experienceleague.adobe.com/docs/experience-platform/tags/api/overview.html)\n",
      "code": "var Component=(()=>{var h=Object.create;var c=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var k=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),N=(a,s)=>{for(var t in s)c(a,t,{get:s[t],enumerable:!0})},o=(a,s,t,n)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let i of p(s))!u.call(a,i)&&i!==t&&c(a,i,{get:()=>s[i],enumerable:!(n=d(s,i))||n.enumerable});return a};var g=(a,s,t)=>(t=a!=null?h(m(a)):{},o(s||!a||!a.__esModule?c(t,\"default\",{value:a,enumerable:!0}):t,a)),b=a=>o(c({},\"__esModule\",{value:!0}),a);var r=k((v,l)=>{l.exports=_jsx_runtime});var I={};N(I,{default:()=>w,frontmatter:()=>f});var e=g(r()),f={title:\"Syncing Adobe Launch/Tags with Github - Part 2: The Github Push Webhook\",date:\"2023-04-26\",tags:[\"adobe launch\",\"adobe tags\",\"javascript\",\"github\",\"automation\"],draft:!1,summary:\"How to use Github to build, sync, & deploy custom code directly to Adobe Launch/Tags - Part 2\"};function y(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(t,{})})):t();function t(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",em:\"em\",blockquote:\"blockquote\",ul:\"ul\",li:\"li\",code:\"code\",pre:\"pre\",hr:\"hr\",img:\"img\",strong:\"strong\",ol:\"ol\"},a.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"the-github-push-webhook\",children:[(0,e.jsx)(n.a,{href:\"#the-github-push-webhook\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"The Github push webhook\"]}),(0,e.jsxs)(n.p,{children:[\"After the setup that I mentioned in the \",(0,e.jsx)(n.a,{href:\"https://www.perpetua.digital/blog/launch-github-sync-part-1\",children:\"first post\"}),\" is completed, I can tap into the Github push webhook to kickoff the syncing between Github and Launch. This webhook will notify my API that some file modifications have occurred in Github and that those changes that \",(0,e.jsx)(n.em,{children:\"may\"}),\" require updates to Launch components. I say \",(0,e.jsx)(n.em,{children:\"may\"}),\" here because the Github push webhook will notify me of \",(0,e.jsx)(n.em,{children:\"all\"}),\" file modifications in my repository and it will be up to me to determine what, if anything, needs to be synced with Launch.\"]}),(0,e.jsxs)(n.p,{children:[\"The Github push webhook also introduces the first layer of security in the form of a \",(0,e.jsx)(n.a,{href:\"https://docs.github.com/en/webhooks-and-events/webhooks/securing-your-webhooks#setting-your-secret-token\",children:\"Webhook secret\"}),\". This allows me to verify calls made to the API. More on that later.\"]}),(0,e.jsx)(n.p,{children:\"So what exactly is webhook? Off the top of my head, and by that, I mean according to ChatGPT, a webhook is:\"}),(0,e.jsxs)(n.blockquote,{children:[(0,e.jsx)(n.p,{children:\"a way for two applications to communicate with each other in real-time. It is a type of API (Application Programming Interface) that allows one application to send data to \\\\ another application automatically whenever a certain event occurs.\"}),(0,e.jsx)(n.p,{children:\"Webhooks work by sending a notification to a URL endpoint that is specified by the receiving application. This notification typically contains a payload of data that describes the event that triggered the webhook.\"})]}),(0,e.jsx)(n.p,{children:\"In order to start receiving notifications from Github about file updates via the push webhook, I need to do 2 things:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsx)(n.li,{children:\"Build and API endpoint for the webhook to send its POST requests to\"}),(0,e.jsx)(n.li,{children:\"Configure that endpoint as a webhook in my Github repo\"})]}),(0,e.jsx)(n.p,{children:\"I'll start with building an endpoint...\"}),(0,e.jsxs)(n.h2,{id:\"my-api-for-receiving-github-push-webhooks\",children:[(0,e.jsx)(n.a,{href:\"#my-api-for-receiving-github-push-webhooks\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"My API for receiving Github push webhooks\"]}),(0,e.jsxs)(n.p,{children:[\"Fortunately for me, going super in-depth about building and hosting API endpoints is beyond the scope of this little blog I got going here. If you are new to such things, I \",(0,e.jsx)(n.em,{children:\"highly\"}),\" suggest reading about building APIs in \",(0,e.jsx)(n.a,{href:\"https://pythonbasics.org/flask-rest-api/\",children:\"Flask\"}),\" for Python (what I used) or \",(0,e.jsx)(n.a,{href:\"https://medium.com/makers-byte/building-a-restful-api-with-express-js-a-beginners-guide-dcb1a1e3520d\",children:\"Express\"}),\" for Node. Once built, you then need to host your endpoint server somewhere public so Github can access it. Lots of options here, the most obvious (and easiest IMO) AWS \",(0,e.jsx)(n.a,{href:\"https://medium.com/mindorks/building-webhook-is-easy-using-aws-lambda-and-api-gateway-56f5e5c3a596\",children:\"web hook gateways\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"Below is the \",(0,e.jsx)(n.a,{href:\"https://exploreflask.com/en/latest/views.html\",children:\"Flask route\"}),\" for my endpoint that will receive and handle pushes from Github. If you've never worked in Flask or made an API before, it might look a little complicated, and yes it is truncated for brevity, but it really only does a couple things:\"]}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"@verify_github_webhook_secret\"}),\" is a Python decorator that makes sure any POST requests to this route not only come from Github, but come from me, specifically.\"]}),(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.code,{children:\"modified_data_element_files\"}),\" is a \",(0,e.jsx)(n.code,{children:\"list\"}),\" of all the data element files that have been updated in this push. If there are \",(0,e.jsx)(n.em,{children:\"zero\"}),\" changed data element files, like if I updated a \",(0,e.jsx)(n.code,{children:\"README.md\"}),\" file, the entire flow stops here. No need to sync with Launch.\"]}),(0,e.jsxs)(n.li,{children:[\"The \",(0,e.jsx)(n.code,{children:\"dict\"}),\" called \",(0,e.jsx)(n.code,{children:\"data\"}),\" contains all the information I will need about this push to look up the \",(0,e.jsx)(n.em,{children:\"actual content\"}),\" of the files. The push webhook only says that contents was modified, but not specifically what those modifications were.\"]}),(0,e.jsxs)(n.li,{children:[\"Finally, if everything checks out, I invoke the next Lambda in the flow which will call the github API to extract the specific file contents which will prepare them for the Launch API. \",(0,e.jsxs)(n.em,{children:[\"In my actual code \",(0,e.jsx)(n.code,{children:\"FunctionName\"}),\" is the name of the next lambda I call.\"]})]})]}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token punctuation annotation decorator\",children:[\"@app\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"route\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"/github-webhook-handler\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" methods\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'POST'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation annotation decorator\",children:\"@verify_github_webhook_secret\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"github_webhook\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"try\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            payload \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" request\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get_json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            modified_files \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'head_commit'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'modified'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            author_name \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'head_commit'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'author'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'name'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            owner \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'head_commit'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'author'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'username'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            repo \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'repository'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'name'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            ref \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" payload\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'ref'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" make_response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"jsonify\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"error\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Error parsing github data from request'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"400\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# find modified data elements files\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        modified_data_element_files \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"file\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"file\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" modified_files \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"file\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"startswith\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"dataelements\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# the request was successful, no action needs to be taken\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token builtin\",children:\"len\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"modified_data_element_files\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"0\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" make_response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"jsonify\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"message\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'No files in the data elements directory have been modified'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"204\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# everything is good - trigger the lambda - the lambda does the launch updating!\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"message\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"OK\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"modified_data_element_files\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" modified_data_element_files\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"author_name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" author_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"owner\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" owner\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"repo\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" repo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ref\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ref\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# invoke the next lambda here\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        client \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" boto3\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'lambda'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        response \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" client\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"invoke\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            FunctionName\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'some fake name here'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            InvocationType\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'Event'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            Payload\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"dumps\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# return success\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        response_data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"statusCode\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"200\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"body\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` data\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" make_response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"jsonify\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"response_data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"200\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"except\"}),\" Exception \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"as\"}),\" e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" make_response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"jsonify\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"error\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:\"f'Error \"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"e\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'\"})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"500\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"By far, the easiest way to create and deploy AWS Lambdas and API Gateways is through the \",(0,e.jsx)(n.a,{href:\"https://www.serverless.com/\",children:\"Serverless\"}),\" framework. It takes care of the drudgery of uploading packages to AWS and has a nicer UI. Highly recommended.\"]}),(0,e.jsx)(n.p,{children:\"Once I get this API deployed, I'm going to have a publicly reachable route to POST to. First task complete. It is this URL that I will then configure inside of Github.\"}),(0,e.jsxs)(n.p,{children:[\"My deployed API will have a route that will look \",(0,e.jsx)(n.em,{children:\"something\"}),\" like the URL below. Notice how the path \",(0,e.jsx)(n.code,{children:\"github-webhook-handler\"}),\" is the path I defined in \",(0,e.jsx)(n.code,{children:\"@app.route\"}),\" above.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:\"https://fakedatahere.execute-api.aws-region-name-here.amazonaws.com/github-webhook-handler\"})}),(0,e.jsx)(n.hr,{}),(0,e.jsxs)(n.h2,{id:\"setting-up-a-push-webhook-on-a-github-repo\",children:[(0,e.jsx)(n.a,{href:\"#setting-up-a-push-webhook-on-a-github-repo\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Setting up a Push webhook on a Github repo\"]}),(0,e.jsxs)(n.p,{children:['Now that I have my endpoint URL all set up and running in \"the cloud\", I need to tell my Github repo to post to it on Push events. To do that, I go into my Repo and go to ',(0,e.jsx)(n.code,{children:\"Settings > Webhooks > Add Webhook\"}),\".\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"IMAGE OF ADD webhook SCREEN\",src:\"https://images.ctfassets.net/on47yk52ubpi/3OVr7rQodGU65n9i6iZMiG/7f86e59fe320e74d868b34602e5ad2e9/Screenshot_2023-04-20_at_11.49.56_PM.png\"})}),(0,e.jsxs)(n.p,{children:[\"The endpoint URL I made goes in \",(0,e.jsx)(n.code,{children:\"payload url\"}),\" and I need to \",(0,e.jsx)(n.a,{href:\"https://www.random.org/strings/\",children:\"generate a random string\"}),\" for a secret and save it somewhere safe. Again, my \",(0,e.jsx)(n.code,{children:\"Secret\"}),\" value is used in the \",(0,e.jsx)(n.code,{children:\"@verify_github_webhook_secret\"}),\" decorator to verify requests that the API receives.\"]}),(0,e.jsxs)(n.p,{children:[\"Once the webhook is setup, I can QA that it's working by doing some push events and checking the \",(0,e.jsx)(n.strong,{children:\"Recent Deliveries\"}),\" section. If something is broken, like I pasted the wrong URL or there is an authentication error, it will show here.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"IMAGE OF RECENT DELIVERIES\",src:\"https://images.ctfassets.net/on47yk52ubpi/4x3o3ACbRyF7o2eq7xUFwp/8653cb21c4fe50e96a98b4be1bb4e14e/Screenshot_2023-04-20_at_11.51.55_PM.png\"})}),(0,e.jsxs)(n.h2,{id:\"in-action\",children:[(0,e.jsx)(n.a,{href:\"#in-action\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"In action\"]}),(0,e.jsx)(n.p,{children:\"So there is not much to look at, but here is a recap of what happens in the first step of the *Github to Launch sync *flow when I update a file on Github that needs to be synced with a Launch component:\"}),(0,e.jsxs)(n.ol,{children:[(0,e.jsxs)(n.li,{children:[\"I push to the \",(0,e.jsx)(n.code,{children:\"main\"}),\" branch of my Github repo\"]}),(0,e.jsx)(n.li,{children:\"Github triggers the push webhook and sends a POST request to my API\"}),(0,e.jsx)(n.li,{children:\"My API reads the data from the webhook request and determines if there are file changes that need to be updated in Launch.\"}),(0,e.jsx)(n.li,{children:\"If changes need to be synced, the API gathers the information required to pull the actual file contents from Github (which takes place in the next step) and triggers the next lambda in the flow.\"})]}),(0,e.jsxs)(n.p,{children:[\"Here is the response from the Push webhook showing my success message when I update my \",(0,e.jsx)(n.a,{href:\"https://github.com/perpetua-digital/launch-property/blob/main/data_elements/host.js\",children:\"host.js data element file.\"})]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"recent delivery success\",src:\"https://images.ctfassets.net/on47yk52ubpi/3WVlI9MZO586tSm2NsL9v5/47163aa6dbe67f5eebb3372f72aeaa9c/recentdeliverysuccess.png\"})}),(0,e.jsx)(n.p,{children:\"I can't show the whole JSON response, but it should look familiar:\"}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"language-python code-highlight\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"message\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"OK\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"modified_data_element_files\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" modified_data_element_files\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"author_name\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" author_name\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"owner\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" owner\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"repo\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" repo\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ref\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` ref\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`})]})}),(0,e.jsxs)(n.h2,{id:\"next-up\",children:[(0,e.jsx)(n.a,{href:\"#next-up\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Next up\"]}),(0,e.jsxs)(n.p,{children:[\"So I've been notified that a change has occurred that needs to be reflected in Launch. Next up, grab that actual contents of those file changes and prepare to send them to \",(0,e.jsx)(n.a,{href:\"https://experienceleague.adobe.com/docs/experience-platform/tags/api/overview.html\",children:\"the Launch API.\"})]})]})}}var w=y;return b(I);})();\n;return Component;"
    },
    "_id": "blog/launch-github-sync-part-2.mdx",
    "_raw": {
      "sourceFilePath": "blog/launch-github-sync-part-2.mdx",
      "sourceFileName": "launch-github-sync-part-2.mdx",
      "sourceFileDir": "blog",
      "contentType": "mdx",
      "flattenedPath": "blog/launch-github-sync-part-2"
    },
    "type": "Blog",
    "readingTime": {
      "text": "6 min read",
      "minutes": 5.95,
      "time": 357000,
      "words": 1190
    },
    "slug": "launch-github-sync-part-2",
    "toc": [
      {
        "value": "The Github push webhook",
        "url": "#the-github-push-webhook",
        "depth": 2
      },
      {
        "value": "My API for receiving Github push webhooks",
        "url": "#my-api-for-receiving-github-push-webhooks",
        "depth": 2
      },
      {
        "value": "Setting up a Push webhook on a Github repo",
        "url": "#setting-up-a-push-webhook-on-a-github-repo",
        "depth": 2
      },
      {
        "value": "In action",
        "url": "#in-action",
        "depth": 2
      },
      {
        "value": "Next up",
        "url": "#next-up",
        "depth": 2
      }
    ]
  }
]