{
  "title": "Syncing CMS images with Adobe Target Offers",
  "date": "2023-05-23T00:00:00.000Z",
  "tags": ["adobe target", "contentful", "webhooks", "cms"],
  "draft": false,
  "summary": "Using Webhooks to automatically create Adobe Target offers out of CMS content",
  "body": {
    "raw": "\n## Contentful\n\nI use [Contentful](https://www.contentful.com/) to host the images for this blog. It is easy to use, has lots of functionality, and the best part: it has an\nexcellent free tier. If you need to host any kind of content like images or blog posts, I highly suggest Contentful.\n\nI would like to have any image I upload to Contentful _automatically_ become an [offer](https://experienceleague.adobe.com/docs/target/using/experiences/offers/manage-content.html?lang=en) in Adobe Target. This way, if I want to\nuse an image on my site and in Target, I don't have to upload it in 2 places. To do this, I am going to tap into [Contentful Webhooks](https://www.contentful.com/developers/docs/concepts/webhooks/)\nto pass uploaded file info straight to Target to create (or update) an offer. Let's get started!\n\nIf you don't feel like reading, I don't blame you. Here's a video demo of what this post is all about:\n\n<ReactPlayer url=\"https://www.youtube.com/watch?v=yFu4tMYE59g\" />\n\nDepending on when you're reading this, there might still be a dog picture on the [about page](https://www.perpetua.digital/about)!\n\n## Uploading to Contentful\n\nI'm not going to go super deep into Contentful content management and publishing as there's a lot of good documentation out there\nand frankly, its not that hard. The only import thing to know here is that content (images in my case) are uploaded into the CMS,\ngiven metadata like titles and tags, then published. Published is the _key_ word here as content can be uploaded without being published\nand I only want to create a Target offer for published images.\n\n![image uploaded but not published](https://images.ctfassets.net/on47yk52ubpi/3YcAlmGpJKGYL7sZeUPsUB/370e042913ff4dfb5420e601e45085fb/uploadedimagenotpublished.png)\n\n<figure>\n  <figcaption>\n    This image of me and Sammy has been uploaded, but I still need to publish it\n  </figcaption>\n</figure>\n\n## Contentful Publish Webhook\n\nContentful offers a webhook for just about every action that can apply to a piece of content. Here, I am going to\nsetup a webhook to fire when an Asset (aka an image file) is published. This will apply to whether the asset is newly published\nor if I re-publish an existing asset.\n\nInside Contentful, go to _Settings > Webhooks > Add Webhook_. Since I only want to this webhook to fire when\nI publish an image, I'll set my trigger for _Specific Triggering Events_ and _Asset Publish_.\n\n![WEBHOOK SETUP IMAGE](https://images.ctfassets.net/on47yk52ubpi/4EI5kuN4hqEJxgaGy4pok1/b43279b9c091f987b717f362a4b4a89d/contentfulwebhooksetup.png)\n\n<figure>\n  <figcaption>This webhook will only fire when I publish an image</figcaption>\n</figure>\n\nThe webhook setup above will send data that looks like this:\n\n```json\n{\n  \"metadata\": {\n    \"tags\": []\n  },\n  \"sys\": {\n    \"type\": \"Asset\",\n    \"id\": \"abc123\",\n    \"space\": {\n      \"sys\": {\n        \"type\": \"Link\",\n        \"linkType\": \"Space\",\n        \"id\": \"abc123\"\n      }\n    },\n    \"environment\": {\n      \"sys\": {\n        \"id\": \"master\",\n        \"type\": \"Link\",\n        \"linkType\": \"Environment\"\n      }\n    },\n    \"createdBy\": {\n      \"sys\": {\n        \"type\": \"Link\",\n        \"linkType\": \"User\",\n        \"id\": \"abc123\"\n      }\n    },\n    \"updatedBy\": {\n      \"sys\": {\n        \"type\": \"Link\",\n        \"linkType\": \"User\",\n        \"id\": \"abc123\"\n      }\n    },\n    \"revision\": 3,\n    \"createdAt\": \"2023-05-16T12:43:26.894Z\",\n    \"updatedAt\": \"2023-05-16T12:50:26.041Z\"\n  },\n  \"fields\": {\n    \"title\": {\n      \"en-US\": \"johnandsammy\"\n    },\n    \"file\": {\n      \"en-US\": {\n        \"url\": \"//images.ctfassets.net/my/long/url/here/johnandsammy.png\",\n        \"details\": {\n          \"size\": 60519,\n          \"image\": {\n            \"width\": 657,\n            \"height\": 718\n          }\n        },\n        \"fileName\": \"johnandsammy.png\",\n        \"contentType\": \"image/png\"\n      }\n    }\n  }\n}\n```\n\nI will take this data, specifically the _title_ and _file url_ and use them to create [offers in Target](https://experienceleague.adobe.com/docs/target/using/experiences/offers/manage-content.html?lang=en).\nIt is important to note that I am creating _HTML Offers_ in Target and not [Target image offers](https://experienceleague.adobe.com/docs/target/using/experiences/offers/assets-working.html?lang=en).\n\nAs far as I can tell, you cannot upload image files as image offers to Target via the [Target API](http://developers.adobetarget.com/api/).\nI suspect you _may_ be able to do this in AEM, but I am not sure.\nEven if I could upload images with the API, I am on free developer tier of Adobe Target and don't have access to use image offers in activities anyway :)\n\n## Building an API endpoint\n\nThe final and most important part of the webhook setup is creating an endpoint for it to POST to when an image is published in my Contentful space.\nI'm not going to actually deploy this endpoint, but if you've read any of my other posts, you know I like to use\n[Serverless](https://www.serverless.com/) framework to build & deploy API Gateways to AWS Lambda.\nIf you haven't worked with Serverless before that sentence sounds a lot more complicated than this process actually is. Serverless has an OOTB Flask\nAPI template so I'll just use that and run my endpoint server locally and use [Ngrok](https://ngrok.com) to do some proof\nof concept testing. The same setup will apply if I had an actually deployed API endpoint. That is, once the API is built, I need to add the\nendpoint URL to the webhook settings in Contentful.\n\nMy webhook endpoint needs to do 2 things:\n\n- Accept POST data and verify that its an image publish request. _Technically_ I don't have to do this,\n  but its always good to never trust, always verify. In reality I would also bake into this some security\n  via a [personal access token](https://www.contentful.com/faq/personal-access-tokens/), but for just testing I don't need to do all that.\n- Collect the data from the Contentful payload and use it when calling the Target API to create or update an offer.\n  For full _CRUD_ capabilities I could also make an unpublish endpoint to delete offers from Target when images\n  are unpublished from Contentful.\n\n### Verify POST Data\n\nGiven the JSON payload above, these 2 tasks are actually relatively simple. After verifying the request\nheaders are of the correct type, I grab the file title and file url and create a string representing\na generic HTML img element. It's this `<img>` element that will become the content of my Target offer.\n\n```python\n@app.route(\"/contentful-asset-publish\", methods=['POST'])\ndef contentful():\n    data = request.get_json()\n    headers = request.headers\n\n    # was the request an asset publish double check\n    if headers.get(\"X-Contentful-Topic\") == \"ContentManagement.Asset.publish\":\n        if data['sys']['type'] == \"Asset\":\n            # get the url of the image\n            file_url = data['fields']['file']['en-US']['url']\n            file_title = data['fields']['title']['en-US']\n            image_element = f\"<img src='https://{file_url}' alt='{file_title}'>\"\n```\n\n### Talk to Target\n\nI'll spare you the drudgery of exchanging tokens ([thankfully Adobe is moving away from that](https://blog.developer.adobe.com/important-update-for-developers-using-adobe-apis-bf25110d3b4))\nand jump right in to where things get interesting. First, I'm going to grab _all_ the offers that exist in my Target instance.\nThe paradigm I'm setting up here is all based on matching the _file title_ from Contentful and the _offer name_ from Target.\nIf there is no match, create a new offer. If there is a match, just update the existing one with the new `<img>` element.\n\n```python\n# get all offers\njwt_token = get_jwt()\naccess_token = get_access_token(jwt_token)\noffers = requests.get(f\"https://mc.adobe.io/{os.environ.get('tenant')}/target/offers\", headers={\n    'authorization': f\"Bearer {access_token}\",\n    'cache-control': 'no-cache',\n    'Accept': 'application/vnd.adobe.target.v2+json',\n    'x-api-key': os.environ.get('client_id')\n})\noffers_dict = offers.json()\n\n# find by name=title lower?\noffer_matches = [item for item in offers_dict['offers']\n                    if item.get('name').lower() == file_title.lower()]\n\n# update if offer match on title\nif offer_matches:\n    # just grab whatever the first match is\n    offer_match = offer_matches.pop()\n    offer_id = offer_match.get('id')\n    update_url = f\"https://mc.adobe.io/{os.environ.get('tenant')}/target/offers/content/{offer_id}\"\n    update_headers = {\n        'authorization': f\"Bearer {access_token}\",\n        'cache-control': 'no-cache',\n        'content-type': 'application/vnd.adobe.target.v2+json',\n        'x-api-key': os.environ.get('client_id')\n    }\n    update_data = {\n        'name': offer_match.get('name'),\n        'content': image_element\n    }\n    update_offer = requests.put(\n        update_url, headers=update_headers, json=update_data)\n    pprint.pprint(update_offer.json())\n    message = \"UPDATE\"\n    print(message)\n\n# create if no offer match on title\nif not offer_matches:\n    create_url = f\"https://mc.adobe.io/{os.environ.get('tenant')}/target/offers/content\"\n    create_headers = {\n        'authorization': f\"Bearer {access_token}\",\n        'cache-control': 'no-cache',\n        'content-type': 'application/vnd.adobe.target.v2+json',\n        'x-api-key': os.environ.get('client_id')\n    }\n    create_data = {\n        'name': file_title,\n        'content': image_element\n    }\n    create_offer = requests.post(\n        create_url, headers=create_headers, json=create_data)\n    pprint.pprint(create_offer.json())\n    message = 'CREATE'\n    print(message)\n\nreturn make_response(jsonify({\"file_url\": file_url, \"file_title\": file_title, \"image_element\": image_element, \"message\": message}), 200)\n```\n\nThis is a sample response from my API when publishing an image and creating a new offer. I put the message in there as a sanity check for me\nbecause the Target API return is just the offer metadata but doesn't say whether it was created or updated.\n\n```javascript\n{\n  \"file_url\": \"https://contentfulcdn.com/my/asset/url/here.png\",\n  \"file_title\": \"my new image file\",\n  \"image_element\": \"<img src='https://contentfulcdn.com/my/asset/url/here.png' alt='my new image file'>\",\n  \"message\": \"CREATE\"\n}\n```\n\n![api created offers](https://images.ctfassets.net/on47yk52ubpi/7evKuXHifdGFJMXZK0BwXm/1c0b4176095f2af3358afd769bce7c46/apicreatedoffers.png)\n\n<figure>\n  <figcaption>\n    Offers created by the Contentful webhook will show my API technical account address instead of\n    my username and show Target Classic as their creation source.\n  </figcaption>\n</figure>\n\nI can now use these images uploaded to Contentful in any of my Target activities!\n\n## In Action\n\nCongrats on reaching the end. You're reward is the same video as the intro. Leave me a comment while you're down here!\n\n<ReactPlayer url=\"https://www.youtube.com/watch?v=yFu4tMYE59g\" />\n",
    "code": "var Component=(()=>{var p=Object.create;var l=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var h=Object.getOwnPropertyNames;var m=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var N=(a,s)=>()=>(s||a((s={exports:{}}).exports,s),s.exports),k=(a,s)=>{for(var t in s)l(a,t,{get:s[t],enumerable:!0})},i=(a,s,t,n)=>{if(s&&typeof s==\"object\"||typeof s==\"function\")for(let c of h(s))!u.call(a,c)&&c!==t&&l(a,c,{get:()=>s[c],enumerable:!(n=d(s,c))||n.enumerable});return a};var g=(a,s,t)=>(t=a!=null?p(m(a)):{},i(s||!a||!a.__esModule?l(t,\"default\",{value:a,enumerable:!0}):t,a)),f=a=>i(l({},\"__esModule\",{value:!0}),a);var r=N((T,o)=>{o.exports=_jsx_runtime});var _={};k(_,{default:()=>w,frontmatter:()=>y});var e=g(r()),y={title:\"Syncing CMS images with Adobe Target Offers\",date:\"2023-05-23\",tags:[\"adobe target\",\"contentful\",\"webhooks\",\"cms\"],draft:!1,summary:\"Using Webhooks to automatically create Adobe Target offers out of CMS content\"};function b(a={}){let{wrapper:s}=a.components||{};return s?(0,e.jsx)(s,Object.assign({},a,{children:(0,e.jsx)(t,{})})):t();function t(){let n=Object.assign({h2:\"h2\",a:\"a\",span:\"span\",p:\"p\",em:\"em\",img:\"img\",pre:\"pre\",code:\"code\",ul:\"ul\",li:\"li\",h3:\"h3\"},a.components),{ReactPlayer:c}=n;return c||I(\"ReactPlayer\",!0,\"20:1-20:66\"),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h2,{id:\"contentful\",children:[(0,e.jsx)(n.a,{href:\"#contentful\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Contentful\"]}),(0,e.jsxs)(n.p,{children:[\"I use \",(0,e.jsx)(n.a,{href:\"https://www.contentful.com/\",children:\"Contentful\"}),\" to host the images for this blog. It is easy to use, has lots of functionality, and the best part: it has an excellent free tier. If you need to host any kind of content like images or blog posts, I highly suggest Contentful.\"]}),(0,e.jsxs)(n.p,{children:[\"I would like to have any image I upload to Contentful \",(0,e.jsx)(n.em,{children:\"automatically\"}),\" become an \",(0,e.jsx)(n.a,{href:\"https://experienceleague.adobe.com/docs/target/using/experiences/offers/manage-content.html?lang=en\",children:\"offer\"}),\" in Adobe Target. This way, if I want to use an image on my site and in Target, I don't have to upload it in 2 places. To do this, I am going to tap into \",(0,e.jsx)(n.a,{href:\"https://www.contentful.com/developers/docs/concepts/webhooks/\",children:\"Contentful Webhooks\"}),\" to pass uploaded file info straight to Target to create (or update) an offer. Let's get started!\"]}),(0,e.jsx)(n.p,{children:\"If you don't feel like reading, I don't blame you. Here's a video demo of what this post is all about:\"}),(0,e.jsx)(c,{url:\"https://www.youtube.com/watch?v=yFu4tMYE59g\"}),(0,e.jsxs)(n.p,{children:[\"Depending on when you're reading this, there might still be a dog picture on the \",(0,e.jsx)(n.a,{href:\"https://www.perpetua.digital/about\",children:\"about page\"}),\"!\"]}),(0,e.jsxs)(n.h2,{id:\"uploading-to-contentful\",children:[(0,e.jsx)(n.a,{href:\"#uploading-to-contentful\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Uploading to Contentful\"]}),(0,e.jsxs)(n.p,{children:[\"I'm not going to go super deep into Contentful content management and publishing as there's a lot of good documentation out there and frankly, its not that hard. The only import thing to know here is that content (images in my case) are uploaded into the CMS, given metadata like titles and tags, then published. Published is the \",(0,e.jsx)(n.em,{children:\"key\"}),\" word here as content can be uploaded without being published and I only want to create a Target offer for published images.\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"image uploaded but not published\",src:\"https://images.ctfassets.net/on47yk52ubpi/3YcAlmGpJKGYL7sZeUPsUB/370e042913ff4dfb5420e601e45085fb/uploadedimagenotpublished.png\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:(0,e.jsx)(n.p,{children:\"This image of me and Sammy has been uploaded, but I still need to publish it\"})})}),(0,e.jsxs)(n.h2,{id:\"contentful-publish-webhook\",children:[(0,e.jsx)(n.a,{href:\"#contentful-publish-webhook\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Contentful Publish Webhook\"]}),(0,e.jsx)(n.p,{children:\"Contentful offers a webhook for just about every action that can apply to a piece of content. Here, I am going to setup a webhook to fire when an Asset (aka an image file) is published. This will apply to whether the asset is newly published or if I re-publish an existing asset.\"}),(0,e.jsxs)(n.p,{children:[\"Inside Contentful, go to \",(0,e.jsx)(n.em,{children:\"Settings > Webhooks > Add Webhook\"}),\". Since I only want to this webhook to fire when I publish an image, I'll set my trigger for \",(0,e.jsx)(n.em,{children:\"Specific Triggering Events\"}),\" and \",(0,e.jsx)(n.em,{children:\"Asset Publish\"}),\".\"]}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"WEBHOOK SETUP IMAGE\",src:\"https://images.ctfassets.net/on47yk52ubpi/4EI5kuN4hqEJxgaGy4pok1/b43279b9c091f987b717f362a4b4a89d/contentfulwebhooksetup.png\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:\"This webhook will only fire when I publish an image\"})}),(0,e.jsx)(n.p,{children:\"The webhook setup above will send data that looks like this:\"}),(0,e.jsx)(n.pre,{className:\"language-json\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-json\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"metadata\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"tags\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"sys\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"type\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Asset\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"abc123\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"space\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"sys\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"type\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Link\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"linkType\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Space\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"abc123\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"environment\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"sys\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"master\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"type\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Link\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"linkType\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Environment\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"createdBy\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"sys\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"type\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Link\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"linkType\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"User\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"abc123\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"updatedBy\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"sys\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"type\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Link\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"linkType\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"User\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"id\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"abc123\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"revision\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"3\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"createdAt\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2023-05-16T12:43:26.894Z\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"updatedAt\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"2023-05-16T12:50:26.041Z\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"fields\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"title\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"en-US\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"johnandsammy\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"file\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"en-US\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"url\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"//images.ctfassets.net/my/long/url/here/johnandsammy.png\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"details\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"size\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"60519\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"image\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"width\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"657\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"height\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"718\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"          \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"fileName\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"johnandsammy.png\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token property\",children:'\"contentType\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"image/png\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"      \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsxs)(n.p,{children:[\"I will take this data, specifically the \",(0,e.jsx)(n.em,{children:\"title\"}),\" and \",(0,e.jsx)(n.em,{children:\"file url\"}),\" and use them to create \",(0,e.jsx)(n.a,{href:\"https://experienceleague.adobe.com/docs/target/using/experiences/offers/manage-content.html?lang=en\",children:\"offers in Target\"}),\". It is important to note that I am creating \",(0,e.jsx)(n.em,{children:\"HTML Offers\"}),\" in Target and not \",(0,e.jsx)(n.a,{href:\"https://experienceleague.adobe.com/docs/target/using/experiences/offers/assets-working.html?lang=en\",children:\"Target image offers\"}),\".\"]}),(0,e.jsxs)(n.p,{children:[\"As far as I can tell, you cannot upload image files as image offers to Target via the \",(0,e.jsx)(n.a,{href:\"http://developers.adobetarget.com/api/\",children:\"Target API\"}),\". I suspect you \",(0,e.jsx)(n.em,{children:\"may\"}),\" be able to do this in AEM, but I am not sure. Even if I could upload images with the API, I am on free developer tier of Adobe Target and don't have access to use image offers in activities anyway :)\"]}),(0,e.jsxs)(n.h2,{id:\"building-an-api-endpoint\",children:[(0,e.jsx)(n.a,{href:\"#building-an-api-endpoint\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Building an API endpoint\"]}),(0,e.jsxs)(n.p,{children:[\"The final and most important part of the webhook setup is creating an endpoint for it to POST to when an image is published in my Contentful space. I'm not going to actually deploy this endpoint, but if you've read any of my other posts, you know I like to use \",(0,e.jsx)(n.a,{href:\"https://www.serverless.com/\",children:\"Serverless\"}),\" framework to build & deploy API Gateways to AWS Lambda. If you haven't worked with Serverless before that sentence sounds a lot more complicated than this process actually is. Serverless has an OOTB Flask API template so I'll just use that and run my endpoint server locally and use \",(0,e.jsx)(n.a,{href:\"https://ngrok.com\",children:\"Ngrok\"}),\" to do some proof of concept testing. The same setup will apply if I had an actually deployed API endpoint. That is, once the API is built, I need to add the endpoint URL to the webhook settings in Contentful.\"]}),(0,e.jsx)(n.p,{children:\"My webhook endpoint needs to do 2 things:\"}),(0,e.jsxs)(n.ul,{children:[(0,e.jsxs)(n.li,{children:[\"Accept POST data and verify that its an image publish request. \",(0,e.jsx)(n.em,{children:\"Technically\"}),\" I don't have to do this, but its always good to never trust, always verify. In reality I would also bake into this some security via a \",(0,e.jsx)(n.a,{href:\"https://www.contentful.com/faq/personal-access-tokens/\",children:\"personal access token\"}),\", but for just testing I don't need to do all that.\"]}),(0,e.jsxs)(n.li,{children:[\"Collect the data from the Contentful payload and use it when calling the Target API to create or update an offer. For full \",(0,e.jsx)(n.em,{children:\"CRUD\"}),\" capabilities I could also make an unpublish endpoint to delete offers from Target when images are unpublished from Contentful.\"]})]}),(0,e.jsxs)(n.h3,{id:\"verify-post-data\",children:[(0,e.jsx)(n.a,{href:\"#verify-post-data\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Verify POST Data\"]}),(0,e.jsxs)(n.p,{children:[\"Given the JSON payload above, these 2 tasks are actually relatively simple. After verifying the request headers are of the correct type, I grab the file title and file url and create a string representing a generic HTML img element. It's this \",(0,e.jsx)(n.code,{children:\"<img>\"}),\" element that will become the content of my Target offer.\"]}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsxs)(n.span,{className:\"token punctuation annotation decorator\",children:[\"@app\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"route\"]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"/contentful-asset-publish\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" methods\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'POST'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"def\"}),\" \",(0,e.jsx)(n.span,{className:\"token function\",children:\"contentful\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" request\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get_json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    headers \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" request\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),`headers\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# was the request an asset publish double check\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" headers\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"X-Contentful-Topic\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"ContentManagement.Asset.publish\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'sys'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'type'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"Asset\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# get the url of the image\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            file_url \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'fields'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'file'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'en-US'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'url'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            file_title \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'fields'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'title'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'en-US'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"            image_element \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:`f\"<img src='https://`}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"file_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\"' alt='\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"file_title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:`'>\"`})]}),`\n`]})]})}),(0,e.jsxs)(n.h3,{id:\"talk-to-target\",children:[(0,e.jsx)(n.a,{href:\"#talk-to-target\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"Talk to Target\"]}),(0,e.jsxs)(n.p,{children:[\"I'll spare you the drudgery of exchanging tokens (\",(0,e.jsx)(n.a,{href:\"https://blog.developer.adobe.com/important-update-for-developers-using-adobe-apis-bf25110d3b4\",children:\"thankfully Adobe is moving away from that\"}),\") and jump right in to where things get interesting. First, I'm going to grab \",(0,e.jsx)(n.em,{children:\"all\"}),\" the offers that exist in my Target instance. The paradigm I'm setting up here is all based on matching the \",(0,e.jsx)(n.em,{children:\"file title\"}),\" from Contentful and the \",(0,e.jsx)(n.em,{children:\"offer name\"}),\" from Target. If there is no match, create a new offer. If there is a match, just update the existing one with the new \",(0,e.jsx)(n.code,{children:\"<img>\"}),\" element.\"]}),(0,e.jsx)(n.pre,{className:\"language-python\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-python\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# get all offers\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"jwt_token \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" get_jwt\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"access_token \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" get_access_token\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"jwt_token\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"offers \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"https://mc.adobe.io/'}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"os\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"environ\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'tenant'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'/target/offers\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" headers\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'authorization'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"Bearer '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"access_token\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'cache-control'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'no-cache'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'Accept'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/vnd.adobe.target.v2+json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'x-api-key'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" os\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"environ\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'client_id'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"offers_dict \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" offers\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# find by name=title lower?\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"offer_matches \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),\"item \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"for\"}),\" item \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"in\"}),\" offers_dict\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"[\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'offers'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"                    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" item\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'name'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"lower\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),\" \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"==\"}),\" file_title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"lower\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"]\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# update if offer match on title\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" offer_matches\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token comment\",children:\"# just grab whatever the first match is\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    offer_match \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" offer_matches\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"pop\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    offer_id \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" offer_match\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'id'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    update_url \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"https://mc.adobe.io/'}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"os\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"environ\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'tenant'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:\"/target/offers/content/\"}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"offer_id\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    update_headers \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'authorization'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"Bearer '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"access_token\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'cache-control'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'no-cache'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'content-type'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/vnd.adobe.target.v2+json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'x-api-key'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" os\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"environ\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'client_id'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    update_data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'name'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" offer_match\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'name'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'content'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` image_element\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    update_offer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"put\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        update_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" headers\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"update_headers\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" json\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"update_data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    pprint\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"pprint\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"update_offer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    message \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"UPDATE\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token comment\",children:\"# create if no offer match on title\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"if\"}),\" \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"not\"}),\" offer_matches\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    create_url \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"https://mc.adobe.io/'}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"os\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"environ\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'tenant'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'/target/offers/content\"'})]}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    create_headers \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'authorization'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsxs)(n.span,{className:\"token string-interpolation\",children:[(0,e.jsx)(n.span,{className:\"token string\",children:'f\"Bearer '}),(0,e.jsxs)(n.span,{className:\"token interpolation\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),\"access_token\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"})]}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"'})]}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'cache-control'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'no-cache'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'content-type'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'application/vnd.adobe.target.v2+json'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'x-api-key'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" os\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"environ\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"get\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token string\",children:\"'client_id'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    create_data \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'name'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" file_title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'content'\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),` image_element\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    create_offer \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" requests\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"post\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"        create_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" headers\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"create_headers\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" json\",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\"create_data\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    pprint\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"pprint\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"create_offer\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\".\"}),\"json\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    message \",(0,e.jsx)(n.span,{className:\"token operator\",children:\"=\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:\"'CREATE'\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"    \",(0,e.jsx)(n.span,{className:\"token keyword\",children:\"print\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]}),(0,e.jsx)(n.span,{className:\"code-line\",children:`\n`}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token keyword\",children:\"return\"}),\" make_response\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),\"jsonify\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"(\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),(0,e.jsx)(n.span,{className:\"token string\",children:'\"file_url\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" file_url\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"file_title\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" file_title\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"image_element\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" image_element\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"message\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\":\"}),\" message\",(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),\" \",(0,e.jsx)(n.span,{className:\"token number\",children:\"200\"}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\")\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:\"This is a sample response from my API when publishing an image and creating a new offer. I put the message in there as a sanity check for me because the Target API return is just the offer metadata but doesn't say whether it was created or updated.\"}),(0,e.jsx)(n.pre,{className:\"language-javascript\",children:(0,e.jsxs)(n.code,{className:\"code-highlight language-javascript\",children:[(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"{\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"file_url\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"https://contentfulcdn.com/my/asset/url/here.png\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"file_title\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"my new image file\"'}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"image_element\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:`\"<img src='https://contentfulcdn.com/my/asset/url/here.png' alt='my new image file'>\"`}),(0,e.jsx)(n.span,{className:\"token punctuation\",children:\",\"}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[\"  \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"message\"'}),(0,e.jsx)(n.span,{className:\"token operator\",children:\":\"}),\" \",(0,e.jsx)(n.span,{className:\"token string\",children:'\"CREATE\"'}),`\n`]}),(0,e.jsxs)(n.span,{className:\"code-line\",children:[(0,e.jsx)(n.span,{className:\"token punctuation\",children:\"}\"}),`\n`]})]})}),(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:\"api created offers\",src:\"https://images.ctfassets.net/on47yk52ubpi/7evKuXHifdGFJMXZK0BwXm/1c0b4176095f2af3358afd769bce7c46/apicreatedoffers.png\"})}),(0,e.jsx)(\"figure\",{children:(0,e.jsx)(\"figcaption\",{children:(0,e.jsx)(n.p,{children:\"Offers created by the Contentful webhook will show my API technical account address instead of my username and show Target Classic as their creation source.\"})})}),(0,e.jsx)(n.p,{children:\"I can now use these images uploaded to Contentful in any of my Target activities!\"}),(0,e.jsxs)(n.h2,{id:\"in-action\",children:[(0,e.jsx)(n.a,{href:\"#in-action\",\"aria-hidden\":\"true\",tabIndex:\"-1\",children:(0,e.jsx)(n.span,{className:\"icon icon-link\"})}),\"In Action\"]}),(0,e.jsx)(n.p,{children:\"Congrats on reaching the end. You're reward is the same video as the intro. Leave me a comment while you're down here!\"}),(0,e.jsx)(c,{url:\"https://www.youtube.com/watch?v=yFu4tMYE59g\"})]})}}var w=b;function I(a,s,t){throw new Error(\"Expected \"+(s?\"component\":\"object\")+\" `\"+a+\"` to be defined: you likely forgot to import, pass, or provide it.\"+(t?\"\\nIt\\u2019s referenced in your code at `\"+t+\"` in `/Users/john/Desktop/code/perpetuadigitalwebsite/_mdx_bundler_entry_point-b3a2a9cf-53d0-4d8c-be6e-1bb227283742.mdx`\":\"\"))}return f(_);})();\n;return Component;"
  },
  "_id": "blog/syncing-cms-content-and-adobe-target-offers.mdx",
  "_raw": {
    "sourceFilePath": "blog/syncing-cms-content-and-adobe-target-offers.mdx",
    "sourceFileName": "syncing-cms-content-and-adobe-target-offers.mdx",
    "sourceFileDir": "blog",
    "contentType": "mdx",
    "flattenedPath": "blog/syncing-cms-content-and-adobe-target-offers"
  },
  "type": "Blog",
  "readingTime": {
    "text": "7 min read",
    "minutes": 6.7,
    "time": 402000,
    "words": 1340
  },
  "slug": "syncing-cms-content-and-adobe-target-offers",
  "toc": [
    {
      "value": "Contentful",
      "url": "#contentful",
      "depth": 2
    },
    {
      "value": "Uploading to Contentful",
      "url": "#uploading-to-contentful",
      "depth": 2
    },
    {
      "value": "Contentful Publish Webhook",
      "url": "#contentful-publish-webhook",
      "depth": 2
    },
    {
      "value": "Building an API endpoint",
      "url": "#building-an-api-endpoint",
      "depth": 2
    },
    {
      "value": "Verify POST Data",
      "url": "#verify-post-data",
      "depth": 3
    },
    {
      "value": "Talk to Target",
      "url": "#talk-to-target",
      "depth": 3
    },
    {
      "value": "In Action",
      "url": "#in-action",
      "depth": 2
    }
  ]
}
